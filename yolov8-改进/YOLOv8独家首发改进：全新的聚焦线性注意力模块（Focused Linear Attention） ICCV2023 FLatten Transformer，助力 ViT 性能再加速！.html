<div id="article_content" class="article_content clearfix">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/kdoc_html_views-1a98987dfd.css">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-044f2cf1dc.css">
                <div id="content_views" class="htmledit_views">
                    <p>&nbsp;ğŸ’¡ğŸ’¡ğŸ’¡<strong>æœ¬æ–‡ç‹¬å®¶æ”¹è¿›ï¼šå…¨æ–°çš„èšç„¦çº¿æ€§æ³¨æ„åŠ›æ¨¡å—ï¼ˆFocused Linear Attentionï¼‰ï¼Œæ—¢é«˜æ•ˆåˆå…·æœ‰å¾ˆå¼ºçš„æ¨¡å‹è¡¨è¾¾èƒ½åŠ›ï¼Œè§£å†³è§†è§‰Transformerè®¡ç®—é‡è¿‡å¤§çš„é—®é¢˜ï¼Œæœ€ç»ˆå¼•å…¥åˆ°YOLOv8ï¼Œåšåˆ°äºŒæ¬¡åˆ›æ–°ï¼›</strong></p> 
<p>æ¨èæŒ‡æ•°ï¼š5é¢—æ˜Ÿ</p> 
<p>ğŸ’¡ğŸ’¡ğŸ’¡Yolov8é­”æœ¯å¸ˆï¼Œç‹¬å®¶é¦–å‘åˆ›æ–°ï¼ˆåŸåˆ›ï¼‰ï¼Œé€‚ç”¨äº<a href="https://so.csdn.net/so/search?q=Yolov5&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=Yolov5&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;Yolov5\&quot;}&quot;}" data-tit="Yolov5" data-pretit="yolov5">Yolov5</a>ã€Yolov7ã€Yolov8ç­‰å„ä¸ªYoloç³»åˆ—ï¼Œä¸“æ æ–‡ç« æä¾›æ¯ä¸€æ­¥æ­¥éª¤å’Œæºç ï¼Œè½»æ¾å¸¦ä½ ä¸Šæ‰‹é­”æ”¹ç½‘ç»œ</p> 
<p>ğŸ’¡ğŸ’¡ğŸ’¡é‡ç‚¹ï¼šé€šè¿‡æœ¬ä¸“æ çš„é˜…è¯»ï¼Œåç»­ä½ ä¹Ÿå¯ä»¥è‡ªå·±é­”æ”¹ç½‘ç»œï¼Œåœ¨ç½‘ç»œä¸åŒä½ç½®ï¼ˆBackboneã€headã€detectã€lossç­‰ï¼‰è¿›è¡Œé­”æ”¹ï¼Œå®ç°åˆ›æ–°ï¼ï¼ï¼</p> 
<p>ä¸“æ ä»‹ç»ï¼š</p> 
<p>https://blog.csdn.net/m0_63774211/category_12289773.html</p> 
<p>âœ¨âœ¨âœ¨åŸåˆ›é­”æ”¹ç½‘ç»œã€å¤ç°å‰æ²¿è®ºæ–‡ï¼Œç»„åˆä¼˜åŒ–åˆ›æ–°</p> 
<p>ğŸš€ğŸš€ğŸš€å°ç›®æ ‡ã€é®æŒ¡ç‰©ã€éš¾æ ·æœ¬æ€§èƒ½æå‡</p> 
<p>ğŸ‰ğŸ‰ğŸ‰æŒç»­æ›´æ–°ä¸­ï¼Œå®šæœŸæ›´æ–°ä¸åŒæ•°æ®é›†æ¶¨ç‚¹æƒ…å†µ<br> &nbsp;</p> 
<h2><a name="t0"></a>1.FLatten Transformerä»‹ç»</h2> 
<p><img alt="" height="191" src="https://img-blog.csdnimg.cn/5b8e2ac443c041a48122d2f673d9f5f8.png" width="1072"></p> 
<p>æ‘˜è¦ï¼šåœ¨Transformeræ¨¡å‹åº”ç”¨äºè§†è§‰é¢†åŸŸçš„è¿‡ç¨‹ä¸­ï¼Œé™ä½è‡ªæ³¨æ„åŠ›çš„è®¡ç®—å¤æ‚åº¦æ˜¯ä¸€ä¸ªé‡è¦çš„ç ”ç©¶æ–¹å‘ã€‚çº¿æ€§æ³¨æ„åŠ›é€šè¿‡ä¸¤ä¸ªç‹¬ç«‹çš„æ˜ å°„å‡½æ•°æ¥è¿‘ä¼¼Softmaxæ“ä½œï¼Œå…·æœ‰çº¿æ€§å¤æ‚åº¦ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³è§†è§‰Transformerè®¡ç®—é‡è¿‡å¤§çš„é—®é¢˜ã€‚ç„¶è€Œï¼Œç›®å‰çš„çº¿æ€§æ³¨æ„åŠ›æ–¹æ³•æ•´ä½“æ€§èƒ½ä¸ä½³ï¼Œéš¾ä»¥å®é™…åº”ç”¨ã€‚æœ¬æ–‡æ·±å…¥åˆ†æäº†ç°æœ‰çº¿æ€§æ³¨æ„åŠ›æ–¹æ³•çš„ç¼ºé™·ï¼Œå¹¶æå‡ºäº†ä¸€ä¸ªå…¨æ–°çš„<strong>èšç„¦çš„çº¿æ€§æ³¨æ„åŠ›æ¨¡å—ï¼ˆFocused Linear Attentionï¼‰</strong>ï¼ŒåŒæ—¶å…·æœ‰é«˜æ•ˆæ€§å’Œå¾ˆå¼ºçš„æ¨¡å‹è¡¨è¾¾èƒ½åŠ›ã€‚</p> 
<p></p> 
<p>æå‡ºäº†ä¸€ç§æ–°å‹çº¿æ€§<a href="https://so.csdn.net/so/search?q=%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%A8%A1%E5%9D%97&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%A8%A1%E5%9D%97&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;æ³¨æ„åŠ›æ¨¡å—\&quot;}&quot;}" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%A8%A1%E5%9D%97&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;æ³¨æ„åŠ›æ¨¡å—\&quot;}&quot;}" data-tit="æ³¨æ„åŠ›æ¨¡å—" data-pretit="æ³¨æ„åŠ›æ¨¡å—">æ³¨æ„åŠ›æ¨¡å—</a>ï¼Œå³èšç„¦çš„çº¿æ€§æ³¨æ„åŠ›ã€‚è¯¥æ¨¡å—å€ŸåŠ©èšç„¦å‡½æ•°è·å¾—æ›´åŠ èšç„¦çš„æ³¨æ„åŠ›åˆ†å¸ƒï¼Œå€ŸåŠ©DWCæ¨¡å—ä¿æŒç‰¹å¾å¤šæ ·æ€§ï¼Œæ—¢é«˜æ•ˆåˆå…·æœ‰å¾ˆå¼ºçš„æ¨¡å‹è¡¨è¾¾èƒ½åŠ›ã€‚æ€»ä½“æ¥è¯´ï¼Œè¯¥æ¨¡å—å…·æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜åŠ¿ï¼š</p> 
<p>(1)&nbsp;<strong>è®¡ç®—å¤æ‚åº¦ä½</strong>ã€‚é€šè¿‡æ”¹å˜è‡ªæ³¨æ„åŠ›æœºåˆ¶çš„çŸ©é˜µä¹˜æ³•é¡ºåºï¼Œæœ¬æ–‡æå‡ºçš„æ¨¡å—èƒ½å¤Ÿå°†è®¡ç®—å¤æ‚åº¦é™ä½ä¸ºçº¿æ€§ã€‚æ­¤å¤–ï¼Œä¸åŒäºä»¥å‰ä¸€äº›çº¿æ€§æ³¨æ„åŠ›æ¨¡å—è®¾è®¡çš„å¤æ‚æ ¸å‡½æ•°ï¼Œæœ¬æ–‡ä½¿ç”¨çš„èšç„¦å‡½æ•°å’ŒDWCçš„è®¡ç®—å¼€é”€å¾ˆå°ã€‚</p> 
<p>(2)&nbsp;<strong>æ¨¡å‹è¡¨è¾¾èƒ½åŠ›å¼º</strong>ã€‚ä»¥å‰çš„çº¿æ€§æ³¨æ„åŠ›æ¨¡å—çš„æ€§èƒ½é€šå¸¸ä¸å¦‚Softmaxæ³¨æ„åŠ›æœºåˆ¶ã€‚ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨èšç„¦å‡½æ•°å’ŒDWCè§£å†³ä¸¤ä¸ªæ€§èƒ½ç“¶é¢ˆåï¼Œæœ¬æ–‡æå‡ºçš„èšç„¦çš„çº¿æ€§æ³¨æ„åŠ›å¯ä»¥è·å¾—æ¯”Softmaxæ³¨æ„åŠ›æœºåˆ¶æ›´å¥½çš„æ€§èƒ½ã€‚</p> 
<p>(3)&nbsp;<strong>èƒ½å¤Ÿé‡‡ç”¨æ›´å¤§çš„æ„Ÿå—é‡</strong>ã€‚å¾—ç›Šäºçº¿æ€§è®¡ç®—å¤æ‚åº¦ï¼Œæœ¬æ–‡çš„æ¨¡å—å¯ä»¥è‡ªç„¶åœ°é‡‡ç”¨æ›´å¤§çš„æ„Ÿå—é‡ï¼Œè€Œä¸ä¼šå¢åŠ æ¨¡å‹è®¡ç®—é‡ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†Swin Transformerçš„window sizeç”±7æ‰©å¤§ä¸º56ï¼Œå³ç›´æ¥é‡‡ç”¨å…¨å±€è‡ªæ³¨æ„åŠ›ï¼Œè€Œå®Œå…¨ä¸å¼•å…¥é¢å¤–è®¡ç®—é‡ã€‚</p> 
<p>(4)&nbsp;<strong>åº”ç”¨çš„çµæ´»æ€§å¼º</strong>ã€‚æœ¬æ–‡æå‡ºçš„æ¨¡å—æ˜¯å¸¸ç”¨çš„Softmaxæ³¨æ„åŠ›çš„ä¸€ä¸ªæ›´ä¼˜çš„æ›¿ä»£ï¼Œ å¯ä»¥ä½œä¸ºä¸€ä¸ªæ’ä»¶æ¨¡å—åº”ç”¨äºå„ç§å„æ ·çš„ViTæ¨¡å‹ã€‚</p> 
<p><img alt="" height="686" src="https://img-blog.csdnimg.cn/00e3817a11c349b591fb97926a06a679.png" width="700"></p> 
<p>&nbsp;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæœ¬æ–‡åŸºäºDeiT-tinyæ¨¡å‹ç»™å‡ºäº†æ³¨æ„åŠ›æƒé‡åˆ†å¸ƒçš„å¯è§†åŒ–ç»“æœã€‚å¯ä»¥çœ‹åˆ°ï¼ŒSoftmaxæ³¨æ„åŠ›èƒ½å¤Ÿäº§ç”Ÿè¾ƒä¸ºé›†ä¸­ã€å°–é”çš„æ³¨æ„åŠ›æƒé‡åˆ†å¸ƒï¼Œèƒ½å¤Ÿæ›´å¥½åœ°èšç„¦äºå‰æ™¯ç‰©ä½“ï¼›è€Œçº¿æ€§æ³¨æ„åŠ›çš„åˆ†å¸ƒåˆ™ååˆ†å¹³å‡ï¼Œè¿™ä½¿å¾—è¾“å‡ºçš„ç‰¹å¾æ¥è¿‘æ‰€æœ‰ç‰¹å¾çš„å¹³å‡å€¼ï¼Œæ— æ³•èšç„¦äºæ›´æœ‰ä¿¡æ¯é‡çš„ç‰¹å¾ã€‚</p> 
<p><img alt="" height="710" src="https://img-blog.csdnimg.cn/8b3ada29807545beaf7fd7dac467c451.png" width="663"></p> 
<p></p> 
<p>è¯¥æ–¹æ³•åœ¨ImageNetä¸Šä½¿DeiTã€PVTã€PVT-v2ã€Swin Transformerã€CSwin Transformerç­‰æ¨¡å‹æ¶æ„å–å¾—äº†<strong>æ˜¾è‘—çš„æ€§èƒ½æå‡</strong>ï¼Œèƒ½å¤Ÿå°†æ¨¡å‹<strong>åœ¨CPUç«¯åŠ é€Ÿçº¦2.0å€</strong>ï¼Œ<strong>åœ¨GPUç«¯åŠ é€Ÿçº¦1.5å€</strong>ã€‚</p> 
<p><img alt="" height="718" src="https://img-blog.csdnimg.cn/459d8dc5f29e4594b44341013832f440.png" width="782"></p> 
<h2><a name="t1"></a>2.FocusedLinearAttentionå¼•å…¥åˆ°YOLOv8</h2> 
<h3><a name="t2"></a><a name="t2"></a>2.1 æ–°å»ºFocusedLinearAttentionåŠ å…¥ultralytics/nn/attention/FocusedLinearAttention.py</h3> 
<pre data-index="0" class="set-code-hide" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:1086px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import torch</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import torch.nn <span class="hljs-keyword">as</span> nn</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">from</span> einops import rearrange</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">class</span> FocusedLinearAttention(nn.Module):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    r<span class="hljs-string">""</span><span class="hljs-string"><span class="hljs-string">" Window based multi-head self attention (W-MSA) module with relative position bias.</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">    It supports both of shifted and non-shifted window.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string"></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">    Args:</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        dim (int): Number of input channels.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        window_size (tuple[int]): The height and width of the window.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        num_heads (int): Number of attention heads.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        qkv_bias (bool, optional):  If True, add a learnable bias to query, key, value. Default: True</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        qk_scale (float | None, optional): Override default qk scale of head_dim ** -0.5 if set</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        attn_drop (float, optional): Dropout ratio of attention weight. Default: 0.0</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        proj_drop (float, optional): Dropout ratio of output. Default: 0.0</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">    "</span><span class="hljs-string">""</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def __init__(<span class="hljs-keyword">self</span>, dim, window_<span class="hljs-keyword">size</span><span class="hljs-operator">=</span>[<span class="hljs-number">20</span>, <span class="hljs-number">20</span>], num_heads<span class="hljs-operator">=</span><span class="hljs-number">8</span>, qkv_bias<span class="hljs-operator">=</span><span class="hljs-keyword">True</span>, qk_scale<span class="hljs-operator">=</span>None, attn_drop<span class="hljs-operator">=</span><span class="hljs-number">0</span>., proj_drop<span class="hljs-operator">=</span><span class="hljs-number">0</span>.,</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                 focusing_factor<span class="hljs-operator">=</span><span class="hljs-number">3</span>, kernel_<span class="hljs-keyword">size</span><span class="hljs-operator">=</span><span class="hljs-number">5</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">super</span>().__init__()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        device <span class="hljs-operator">=</span> torch.device(<span class="hljs-string">"cuda:0"</span> <span class="hljs-keyword">if</span> torch.cuda.<span class="hljs-keyword">is</span>_available() <span class="hljs-keyword">else</span> <span class="hljs-string">"cpu"</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.dim <span class="hljs-operator">=</span> dim</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.num_heads <span class="hljs-operator">=</span> num_heads</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        head_dim <span class="hljs-operator">=</span> dim <span class="hljs-operator">/</span><span class="hljs-operator">/</span> num_heads</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.focusing_factor <span class="hljs-operator">=</span> focusing_factor</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.qkv <span class="hljs-operator">=</span> nn.Linear(dim, dim <span class="hljs-operator">*</span> <span class="hljs-number">3</span>, bias<span class="hljs-operator">=</span>qkv_bias)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.attn_drop <span class="hljs-operator">=</span> nn.Dropout(attn_drop)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.proj <span class="hljs-operator">=</span> nn.Linear(dim, dim)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.proj_drop <span class="hljs-operator">=</span> nn.Dropout(proj_drop)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.window_<span class="hljs-keyword">size</span> <span class="hljs-operator">=</span> window_<span class="hljs-keyword">size</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.positional_encoding <span class="hljs-operator">=</span> nn.Parameter(torch.<span class="hljs-literal">zeros</span>(<span class="hljs-keyword">size</span><span class="hljs-operator">=</span>(<span class="hljs-number">1</span>, window_<span class="hljs-keyword">size</span>[<span class="hljs-number">0</span>] <span class="hljs-operator">*</span> window_<span class="hljs-keyword">size</span>[<span class="hljs-number">1</span>], dim)))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.softmax <span class="hljs-operator">=</span> nn.Softmax(dim<span class="hljs-operator">=</span>-<span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.dwc <span class="hljs-operator">=</span> nn.Conv<span class="hljs-number">2</span>d(<span class="hljs-keyword">in</span>_channels<span class="hljs-operator">=</span>head_dim, out_channels<span class="hljs-operator">=</span>head_dim, kernel_<span class="hljs-keyword">size</span><span class="hljs-operator">=</span>kernel_<span class="hljs-keyword">size</span>,</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                             groups<span class="hljs-operator">=</span>head_dim, padding<span class="hljs-operator">=</span>kernel_<span class="hljs-keyword">size</span> <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-number">2</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.scale <span class="hljs-operator">=</span> nn.Parameter(torch.<span class="hljs-literal">zeros</span>(<span class="hljs-keyword">size</span><span class="hljs-operator">=</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, dim)))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def forward(<span class="hljs-keyword">self</span>, x, mask<span class="hljs-operator">=</span>None):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-string">""</span><span class="hljs-string"><span class="hljs-string">"</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        Args:</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">            x: input features with shape of (num_windows*B, N, C)</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">            mask: (0/-inf) mask with shape of (num_windows, Wh*Ww, Wh*Ww) or None</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        "</span><span class="hljs-string">""</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        # flatten: [B, C, H, W] -<span class="hljs-operator">&gt;</span> [B, C, HW]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        # transpose: [B, C, HW] -<span class="hljs-operator">&gt;</span> [B, HW, C]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="50"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x <span class="hljs-operator">=</span> x.flatten(<span class="hljs-number">2</span>).transpose(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="51"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        B, N, C <span class="hljs-operator">=</span> x.shape</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="52"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        qkv <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.qkv(x).reshape(B, N, <span class="hljs-number">3</span>, C).permute(<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="53"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        q, k, v <span class="hljs-operator">=</span> qkv.unbind(<span class="hljs-number">0</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="54"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        k <span class="hljs-operator">=</span> k <span class="hljs-operator">+</span> <span class="hljs-keyword">self</span>.positional_encoding[:, :k.shape[<span class="hljs-number">1</span>], :]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="55"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        focusing_factor <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.focusing_factor</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="56"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        kernel_<span class="hljs-keyword">function</span> <span class="hljs-operator">=</span> nn.ReLU()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="57"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        q <span class="hljs-operator">=</span> kernel_<span class="hljs-keyword">function</span>(q) <span class="hljs-operator">+</span> <span class="hljs-number">1</span>e-<span class="hljs-number">6</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="58"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        k <span class="hljs-operator">=</span> kernel_<span class="hljs-keyword">function</span>(k) <span class="hljs-operator">+</span> <span class="hljs-number">1</span>e-<span class="hljs-number">6</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="59"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        scale <span class="hljs-operator">=</span> nn.Softplus()(<span class="hljs-keyword">self</span>.scale)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="60"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        q <span class="hljs-operator">=</span> q <span class="hljs-operator">/</span> scale</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="61"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        k <span class="hljs-operator">=</span> k <span class="hljs-operator">/</span> scale</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="62"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        q_norm <span class="hljs-operator">=</span> q.norm(dim<span class="hljs-operator">=</span>-<span class="hljs-number">1</span>, keepdim<span class="hljs-operator">=</span><span class="hljs-keyword">True</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="63"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        k_norm <span class="hljs-operator">=</span> k.norm(dim<span class="hljs-operator">=</span>-<span class="hljs-number">1</span>, keepdim<span class="hljs-operator">=</span><span class="hljs-keyword">True</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="64"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> float(focusing_factor) <span class="hljs-operator">&lt;=</span> <span class="hljs-number">6</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="65"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            q <span class="hljs-operator">=</span> q <span class="hljs-operator">**</span> focusing_factor</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="66"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            k <span class="hljs-operator">=</span> k <span class="hljs-operator">**</span> focusing_factor</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="67"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">else</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="68"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            q <span class="hljs-operator">=</span> (q <span class="hljs-operator">/</span> q.max(dim<span class="hljs-operator">=</span>-<span class="hljs-number">1</span>, keepdim<span class="hljs-operator">=</span><span class="hljs-keyword">True</span>)[<span class="hljs-number">0</span>]) <span class="hljs-operator">**</span> focusing_factor</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="69"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            k <span class="hljs-operator">=</span> (k <span class="hljs-operator">/</span> k.max(dim<span class="hljs-operator">=</span>-<span class="hljs-number">1</span>, keepdim<span class="hljs-operator">=</span><span class="hljs-keyword">True</span>)[<span class="hljs-number">0</span>]) <span class="hljs-operator">**</span> focusing_factor</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="70"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        q <span class="hljs-operator">=</span> (q <span class="hljs-operator">/</span> q.norm(dim<span class="hljs-operator">=</span>-<span class="hljs-number">1</span>, keepdim<span class="hljs-operator">=</span><span class="hljs-keyword">True</span>)) <span class="hljs-operator">*</span> q_norm</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="71"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        k <span class="hljs-operator">=</span> (k <span class="hljs-operator">/</span> k.norm(dim<span class="hljs-operator">=</span>-<span class="hljs-number">1</span>, keepdim<span class="hljs-operator">=</span><span class="hljs-keyword">True</span>)) <span class="hljs-operator">*</span> k_norm</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="72"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        q, k, v <span class="hljs-operator">=</span> (rearrange(x, <span class="hljs-string">"b n (h c) -&gt; (b h) n c"</span>, h<span class="hljs-operator">=</span><span class="hljs-keyword">self</span>.num_heads) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> [q, k, v])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="73"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="74"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        i, j, c, d <span class="hljs-operator">=</span> q.shape[-<span class="hljs-number">2</span>], k.shape[-<span class="hljs-number">2</span>], k.shape[-<span class="hljs-number">1</span>], v.shape[-<span class="hljs-number">1</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="75"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="76"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        z <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-operator">/</span> (torch.einsum(<span class="hljs-string">"b i c, b c -&gt; b i"</span>, q, k.<span class="hljs-keyword">sum</span>(dim<span class="hljs-operator">=</span><span class="hljs-number">1</span>)) <span class="hljs-operator">+</span> <span class="hljs-number">1</span>e-<span class="hljs-number">6</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="77"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> i <span class="hljs-operator">*</span> j <span class="hljs-operator">*</span> (c <span class="hljs-operator">+</span> d) <span class="hljs-operator">&gt;</span> c <span class="hljs-operator">*</span> d <span class="hljs-operator">*</span> (i <span class="hljs-operator">+</span> j):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="78"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            kv <span class="hljs-operator">=</span> torch.einsum(<span class="hljs-string">"b j c, b j d -&gt; b c d"</span>, k, v)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="79"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            x <span class="hljs-operator">=</span> torch.einsum(<span class="hljs-string">"b i c, b c d, b i -&gt; b i d"</span>, q, kv, z)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="80"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">else</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="81"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            qk <span class="hljs-operator">=</span> torch.einsum(<span class="hljs-string">"b i c, b j c -&gt; b i j"</span>, q, k)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="82"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            x <span class="hljs-operator">=</span> torch.einsum(<span class="hljs-string">"b i j, b j d, b i -&gt; b i d"</span>, qk, v, z)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="83"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="84"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        num <span class="hljs-operator">=</span> int(v.shape[<span class="hljs-number">1</span>] <span class="hljs-operator">**</span> <span class="hljs-number">0.5</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="85"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="86"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        feature_map <span class="hljs-operator">=</span> rearrange(v, <span class="hljs-string">"b (w h) c -&gt; b c w h"</span>, w<span class="hljs-operator">=</span>num, h<span class="hljs-operator">=</span>num)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="87"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        feature_map <span class="hljs-operator">=</span> rearrange(<span class="hljs-keyword">self</span>.dwc(feature_map), <span class="hljs-string">"b c w h -&gt; b (w h) c"</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="88"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x <span class="hljs-operator">=</span> x <span class="hljs-operator">+</span> feature_map</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="89"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x <span class="hljs-operator">=</span> rearrange(x, <span class="hljs-string">"(b h) n c -&gt; b n (h c)"</span>, h<span class="hljs-operator">=</span><span class="hljs-keyword">self</span>.num_heads)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="90"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.proj(x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="91"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.proj_drop(x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="92"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x <span class="hljs-operator">=</span> rearrange(x, <span class="hljs-string">"b (w h) c -&gt; b c w h"</span>, b<span class="hljs-operator">=</span>B, c<span class="hljs-operator">=</span><span class="hljs-keyword">self</span>.dim, w<span class="hljs-operator">=</span>num, h<span class="hljs-operator">=</span>num)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="93"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> x</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<h3><a name="t3"></a>2.2 æ³¨å†Œultralytics/nn/tasks.py</h3> 
<pre data-index="1" class="set-code-show" name="code">FocusedLinearAttentionæ³¨å†Œ</pre> 
<pre data-index="2" class="set-code-show" name="code"><code class="hljs language-typescript"><span class="hljs-keyword">from</span> ultralytics.<span class="hljs-property">nn</span>.<span class="hljs-property">attention</span>.<span class="hljs-property">FocusedLinearAttention</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">FocusedLinearAttention</span></code><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<p>ä¿®æ”¹def parse_model(d, ch, verbose=True): &nbsp;# model_dict, input_channels(3)</p> 
<pre data-index="3" class="set-code-show" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        elif m <span class="hljs-keyword">is</span> FocusedLinearAttention:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            args <span class="hljs-operator">=</span> {<span class="hljs-operator">*</span>args}</div></div></li></ol></code><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<h3><a name="t4"></a>2.3&nbsp;yolov8_FocusedLinearAttention.yaml</h3> 
<pre data-index="4" class="set-code-hide" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:1052px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># Ultralytics YOLO ğŸš€, GPL-<span class="hljs-number">3.0</span> license</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># YOLOv<span class="hljs-number">8</span> <span class="hljs-keyword">object</span> detection model <span class="hljs-keyword">with</span> P<span class="hljs-number">3</span>-P<span class="hljs-number">5</span> outputs. <span class="hljs-keyword">For</span> <span class="hljs-keyword">Usage</span> examples see https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>docs.ultralytics.com<span class="hljs-operator">/</span>tasks<span class="hljs-operator">/</span>detect</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># Parameters</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">nc: <span class="hljs-number">1</span>  # <span class="hljs-keyword">number</span> <span class="hljs-keyword">of</span> classes</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">scales: # model compound scaling constants, i.e. <span class="hljs-string">'model=yolov8n.yaml'</span> will <span class="hljs-keyword">call</span> yolov<span class="hljs-number">8</span>.yaml <span class="hljs-keyword">with</span> scale <span class="hljs-string">'n'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  # [depth, width, max_channels]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  n: [<span class="hljs-number">0.33</span>, <span class="hljs-number">0.25</span>, <span class="hljs-number">1024</span>]  # YOLOv<span class="hljs-number">8</span>n summary: <span class="hljs-number">225</span> layers,  <span class="hljs-number">3157200</span> parameters,  <span class="hljs-number">3157184</span> gradients,   <span class="hljs-number">8.9</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  s: [<span class="hljs-number">0.33</span>, <span class="hljs-number">0.50</span>, <span class="hljs-number">1024</span>]  # YOLOv<span class="hljs-number">8</span>s summary: <span class="hljs-number">225</span> layers, <span class="hljs-number">11166560</span> parameters, <span class="hljs-number">11166544</span> gradients,  <span class="hljs-number">28.8</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  m: [<span class="hljs-number">0.67</span>, <span class="hljs-number">0.75</span>, <span class="hljs-number">768</span>]   # YOLOv<span class="hljs-number">8</span>m summary: <span class="hljs-number">295</span> layers, <span class="hljs-number">25902640</span> parameters, <span class="hljs-number">25902624</span> gradients,  <span class="hljs-number">79.3</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  l: [<span class="hljs-number">1.00</span>, <span class="hljs-number">1.00</span>, <span class="hljs-number">512</span>]   # YOLOv<span class="hljs-number">8</span>l summary: <span class="hljs-number">365</span> layers, <span class="hljs-number">43691520</span> parameters, <span class="hljs-number">43691504</span> gradients, <span class="hljs-number">165.7</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  x: [<span class="hljs-number">1.00</span>, <span class="hljs-number">1.25</span>, <span class="hljs-number">512</span>]   # YOLOv<span class="hljs-number">8</span>x summary: <span class="hljs-number">365</span> layers, <span class="hljs-number">68229648</span> parameters, <span class="hljs-number">68229632</span> gradients, <span class="hljs-number">258.5</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># YOLOv<span class="hljs-number">8.0</span>n backbone</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">backbone:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  # [<span class="hljs-keyword">from</span>, repeats, module, args]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">64</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">0</span>-P<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">2</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">128</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">1</span>-P<span class="hljs-number">2</span><span class="hljs-operator">/</span><span class="hljs-number">4</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">128</span>, <span class="hljs-keyword">True</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">256</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">3</span>-P<span class="hljs-number">3</span><span class="hljs-operator">/</span><span class="hljs-number">8</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">256</span>, <span class="hljs-keyword">True</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">512</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">5</span>-P<span class="hljs-number">4</span><span class="hljs-operator">/</span><span class="hljs-number">16</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">512</span>, <span class="hljs-keyword">True</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">1024</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">7</span>-P<span class="hljs-number">5</span><span class="hljs-operator">/</span><span class="hljs-number">32</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">1024</span>, <span class="hljs-keyword">True</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, SPPF, [<span class="hljs-number">1024</span>, <span class="hljs-number">5</span>]]  # <span class="hljs-number">9</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, FocusedLinearAttention, [<span class="hljs-number">256</span>]]  # <span class="hljs-number">10</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># YOLOv<span class="hljs-number">8.0</span>n head</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">head:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, nn.Upsample, [None, <span class="hljs-number">2</span>, <span class="hljs-string">'nearest'</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[-<span class="hljs-number">1</span>, <span class="hljs-number">6</span>], <span class="hljs-number">1</span>, Concat, [<span class="hljs-number">1</span>]]  # cat backbone P<span class="hljs-number">4</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">512</span>]]  # <span class="hljs-number">13</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, nn.Upsample, [None, <span class="hljs-number">2</span>, <span class="hljs-string">'nearest'</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[-<span class="hljs-number">1</span>, <span class="hljs-number">4</span>], <span class="hljs-number">1</span>, Concat, [<span class="hljs-number">1</span>]]  # cat backbone P<span class="hljs-number">3</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">256</span>]]  # <span class="hljs-number">16</span> (P<span class="hljs-number">3</span><span class="hljs-operator">/</span><span class="hljs-number">8</span>-small)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">256</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[-<span class="hljs-number">1</span>, <span class="hljs-number">13</span>], <span class="hljs-number">1</span>, Concat, [<span class="hljs-number">1</span>]]  # cat head P<span class="hljs-number">4</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">512</span>]]  # <span class="hljs-number">19</span> (P<span class="hljs-number">4</span><span class="hljs-operator">/</span><span class="hljs-number">16</span>-medium)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">512</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[-<span class="hljs-number">1</span>, <span class="hljs-number">10</span>], <span class="hljs-number">1</span>, Concat, [<span class="hljs-number">1</span>]]  # cat head P<span class="hljs-number">5</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">1024</span>]]  # <span class="hljs-number">22</span> (P<span class="hljs-number">5</span><span class="hljs-operator">/</span><span class="hljs-number">32</span>-large)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[<span class="hljs-number">16</span>, <span class="hljs-number">19</span>, <span class="hljs-number">22</span>], <span class="hljs-number">1</span>, Detect, [nc]]  # Detect(P<span class="hljs-number">3</span>, P<span class="hljs-number">4</span>, P<span class="hljs-number">5</span>)</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<h3><a name="t5"></a>2.4 æŠ¥é”™è§£å†³</h3> 
<pre data-index="5" class="set-code-show" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:875px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">raise</span> EinopsError(message <span class="hljs-operator">+</span> <span class="hljs-string">"\n {}"</span>.<span class="hljs-keyword">format</span>(e))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">einops.EinopsError:  <span class="hljs-keyword">Error</span> while processing rearrange-reduction pattern <span class="hljs-string">"b (w h) c -&gt; b c w h"</span>.</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-keyword">Input</span> tensor shape: torch.<span class="hljs-keyword">Size</span>([<span class="hljs-number">128</span>, <span class="hljs-number">294</span>, <span class="hljs-number">32</span>]). Additional info: {<span class="hljs-string">'w'</span>: <span class="hljs-number">17</span>, <span class="hljs-string">'h'</span>: <span class="hljs-number">17</span>}.</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> Shape mismatch, <span class="hljs-number">294</span> !<span class="hljs-operator">=</span> <span class="hljs-number">289</span></div></div></li></ol></code><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<p>å¯¹ç­–:</p> 
<p>ä¿®æ”¹ultralytics/models/yolo/detect/train.py</p> 
<pre data-index="6" class="set-code-show" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:1069px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def build_dataset(<span class="hljs-keyword">self</span>, img_path, <span class="hljs-keyword">mode</span><span class="hljs-operator">=</span><span class="hljs-string">'train'</span>, batch<span class="hljs-operator">=</span>None):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-string">""</span><span class="hljs-string"><span class="hljs-string">"</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        Build YOLO Dataset.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string"></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        Args:</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">            img_path (str): Path to the folder containing images.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">            mode (str): `train` mode or `val` mode, users are able to customize different augmentations for each mode.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">            batch (int, optional): Size of batches, this is for `rect`. Defaults to None.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        "</span><span class="hljs-string">""</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        gs <span class="hljs-operator">=</span> max(int(<span class="hljs-keyword">de</span>_parallel(<span class="hljs-keyword">self</span>.model).stride.m<span class="hljs-type">ax()</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.model <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>), <span class="hljs-number">32</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">     </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> build_yolo_dataset(<span class="hljs-keyword">self</span>.args, img_path, batch, <span class="hljs-keyword">self</span>.<span class="hljs-keyword">data</span>, <span class="hljs-keyword">mode</span><span class="hljs-operator">=</span><span class="hljs-keyword">mode</span>, rect<span class="hljs-operator">=</span><span class="hljs-keyword">mode</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-string">'val'</span>, stride<span class="hljs-operator">=</span>gs)</div></div></li></ol></code><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<p>ä¿®æ”¹ä¸ºï¼š</p> 
<pre data-index="7" class="set-code-show" name="code"><code class="hljs language-cobol"><span class="hljs-keyword">return</span> build_yolo_dataset(<span class="hljs-keyword">self</span>.args, img_path, batch, <span class="hljs-keyword">self</span>.<span class="hljs-keyword">data</span>, <span class="hljs-keyword">mode</span><span class="hljs-operator">=</span><span class="hljs-keyword">mode</span>, rect<span class="hljs-operator">=</span>(<span class="hljs-keyword">False</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">mode</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-string">'val'</span> <span class="hljs-keyword">else</span> <span class="hljs-keyword">False</span>), stride<span class="hljs-operator">=</span>gs)</code><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<p></p>
                </div><div data-report-view="{&quot;mod&quot;:&quot;1585297308_001&quot;,&quot;spm&quot;:&quot;1001.2101.3001.6548&quot;,&quot;dest&quot;:&quot;https://cv2023.blog.csdn.net/article/details/134315674&quot;,&quot;extend1&quot;:&quot;pc&quot;,&quot;ab&quot;:&quot;new&quot;}"><div></div></div>
        </div>