<div id="article_content" class="article_content clearfix">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/kdoc_html_views-1a98987dfd.css">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-dc4a025e85.css">
                <div id="content_views" class="htmledit_views">
                    <h2><a name="t0"></a>ğŸ†ğŸ†ğŸ†ğŸ†ğŸ†ğŸ†ğŸ†ğŸ†Yolov8é­”æœ¯å¸ˆğŸ†ğŸ†ğŸ†ğŸ†ğŸ†ğŸ†ğŸ†ğŸ†</h2> 
<h2><a name="t1"></a><a name="t1"></a><strong>ğŸŒŸğŸŒŸğŸŒŸ</strong>é­”æ”¹ç½‘ç»œå’Œå¤ç°<a href="https://so.csdn.net/so/search?q=cvpr&amp;spm=1001.2101.3001.7020" title="cvpr">cvpr</a>ç­‰å‰æ²¿è®ºæ–‡ï¼Œç»„åˆä¼˜åŒ–</h2> 
<h2><a name="t2"></a><a name="t2"></a>ğŸš€ğŸš€ğŸš€åœ¨å¤šä¸ªæ•°æ®é›†è¿›è¡ŒéªŒè¯mAPæ¶¨ç‚¹æ˜æ˜¾ï¼Œå°¤å…¶æ˜¯å°ç›®æ ‡ã€é®æŒ¡ç‰©ç²¾åº¦æå‡æ˜æ˜¾ï¼›</h2> 
<h2><a name="t3"></a>1.Lionä¼˜åŒ–å™¨ä»‹ç»</h2> 
<p><img alt="" height="494" src="https://img-blog.csdnimg.cn/ae278fd0003e462c831ca606d80b1b6e.png" width="1051"></p> 
<p>è®ºæ–‡ï¼š<a href="https://arxiv.org/abs/2302.06675" title="https://arxiv.org/abs/2302.06675">https://arxiv.org/abs/2302.06675</a></p> 
<p>ä»£ç ï¼š<a href="https://github.com/google/automl/tree/master/lion" title="automl/lion at master Â· google/automl Â· GitHub">automl/lion at master Â· google/automl Â· GitHub</a></p> 
<h3><a name="t4"></a>&nbsp;<strong>1.1&nbsp;&nbsp;ç®€å•ã€å†…å­˜é«˜æ•ˆã€è¿è¡Œé€Ÿåº¦æ›´å¿«</strong></h3> 
<p>1ï¼‰ä¸ <a href="https://so.csdn.net/so/search?q=AdamW&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=AdamW&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;AdamW\&quot;}&quot;}" data-tit="AdamW" data-pretit="adamw">AdamW</a> å’Œå„ç§è‡ªé€‚åº”ä¼˜åŒ–å™¨éœ€è¦åŒæ—¶ä¿å­˜ä¸€é˜¶å’ŒäºŒé˜¶çŸ©ç›¸æ¯”ï¼ŒLion åªéœ€è¦åŠ¨é‡ï¼Œå°†é¢å¤–çš„å†…å­˜å ç”¨å‡åŠï¼›</p> 
<p>2ï¼‰ç”±äº Lion çš„ç®€å•æ€§ï¼ŒLion åœ¨æˆ‘ä»¬çš„å®éªŒä¸­å…·æœ‰æ›´å¿«çš„è¿è¡Œæ—¶é—´ï¼ˆstep/sï¼‰ï¼Œé€šå¸¸æ¯” AdamW å’Œ Adafactor æé€Ÿ 2-15%ï¼›</p> 
<p>&nbsp;<img alt="" height="241" src="https://img-blog.csdnimg.cn/bc3acd097ce14e9f9462b36ae9fb64eb.png" width="276">â€‹&nbsp; &nbsp; &nbsp;&nbsp;<img alt="" height="242" src="https://img-blog.csdnimg.cn/122d8c1391194ead914f41655db5abf5.png" width="351">â€‹</p> 
<h3><a name="t5"></a>&nbsp;1.2 Lionä¼˜åŒ–å™¨åœ¨å„ç§æ¨¡å‹ã€ä»»åŠ¡å’Œé¢†åŸŸä¸Šçš„ä¼˜è¶Šæ€§èƒ½</h3> 
<p><strong>1.2.1&nbsp; å›¾åƒåˆ†ç±»</strong></p> 
<ul><li>Lion åœ¨ ImageNet ä¸Šä»å¤´å¼€å§‹è®­ç»ƒæˆ–åœ¨ ImageNet-21K ä¸Šé¢„è®­ç»ƒçš„å„ç§ç½‘ç»œæ¨¡å‹ä¸Šä¼˜äº AdamWã€‚</li><li><img alt="" height="715" src="https://img-blog.csdnimg.cn/fdc5fdc1f6b94d6f8fba534edbfc6c5d.png" width="705">â€‹</li></ul> 
<p>&nbsp; &nbsp; &nbsp;Lion åœ¨ JFT-300M ä¸ŠèŠ‚çœäº†é«˜è¾¾ 5 å€çš„é¢„è®­ç»ƒæˆæœ¬ã€‚</p> 
<p><img alt="" height="208" src="https://img-blog.csdnimg.cn/f11e6bae19734b468745fa85936de8ac.png" width="540">â€‹</p> 
<h3><a name="t6"></a>1.3&nbsp; Lion è¶…å‚æ•°å’Œæ‰¹é‡å¤§å°é€‰æ‹©</h3> 
<p>1)é€šè¿‡å¯¹ Lion çš„åˆ†æè¡¨æ˜ï¼Œå®ƒçš„æ€§èƒ½å¢ç›Šéšç€è®­ç»ƒæ‰¹é‡çš„å¢åŠ è€Œå¢åŠ ã€‚å®ƒ<strong>è¿˜éœ€è¦æ¯”Adamæ›´å°çš„å­¦ä¹ ç‡ï¼Œå› ä¸ºç¬¦å·å‡½æ•°äº§ç”Ÿçš„æ›´æ–°èŒƒæ•°æ›´å¤§</strong>ã€‚</p> 
<p>2)ä¼˜åŒ–å™¨çš„å¦ä¸€ä¸ªæ½œåœ¨é™åˆ¶â€”â€”æ‰¹é‡å¤§å°ï¼ˆbatch sizeï¼‰ã€‚é€šè¿‡å®éªŒï¼Œ<strong>è®ºæ–‡æŒ‡å‡º Lion åœ¨å°batch_sizeï¼ˆå°äº64ï¼‰çš„æ—¶å€™æ•ˆæœä¸å¦‚AdamWã€‚</strong></p> 
<p><img alt="" height="238" src="https://img-blog.csdnimg.cn/7d65612ec4174d939415100285c1696d.png" width="944">â€‹</p> 
<h2><a name="t7"></a>2.&nbsp;Lionä¼˜åŒ–å™¨å¯¼å…¥Yolov8</h2> 
<h2><a name="t8"></a>2.1 ä¿®æ”¹ultralytics/yolo/engine/trainer.py</h2> 
<p>åŠ å…¥ä»¥ä¸‹ä»£ç </p> 
<p>ä¿®æ”¹def build_optimizer(model, name='Adam', lr=0.001, momentum=0.9, decay=1e-5):å‡½æ•°</p> 
<div> 
 <pre data-index="0"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:968px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> name <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-string">'Adam'</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            optimizer <span class="hljs-operator">=</span> torch.optim.Adam(g[<span class="hljs-number">2</span>], lr<span class="hljs-operator">=</span>lr, betas<span class="hljs-operator">=</span>(momentum, <span class="hljs-number">0.999</span>))  # adjust beta<span class="hljs-number">1</span> <span class="hljs-keyword">to</span> momentum</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        elif name <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-string">'AdamW'</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            optimizer <span class="hljs-operator">=</span> torch.optim.AdamW(g[<span class="hljs-number">2</span>], lr<span class="hljs-operator">=</span>lr, betas<span class="hljs-operator">=</span>(momentum, <span class="hljs-number">0.999</span>), weight_decay<span class="hljs-operator">=</span><span class="hljs-number">0.0</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        elif name <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-string">'RMSProp'</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            optimizer <span class="hljs-operator">=</span> torch.optim.RMSprop(g[<span class="hljs-number">2</span>], lr<span class="hljs-operator">=</span>lr, momentum<span class="hljs-operator">=</span>momentum)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        elif name <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-string">'SGD'</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            optimizer <span class="hljs-operator">=</span> torch.optim.SGD(g[<span class="hljs-number">2</span>], lr<span class="hljs-operator">=</span>lr, momentum<span class="hljs-operator">=</span>momentum, nesterov<span class="hljs-operator">=</span><span class="hljs-keyword">True</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        elif name <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-string">'Lion'</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            optimizer <span class="hljs-operator">=</span> torch.optim.Lion(g[<span class="hljs-number">2</span>], lr<span class="hljs-operator">=</span>lr, betas<span class="hljs-operator">=</span>(momentum, <span class="hljs-number">0.999</span>), weight_decay<span class="hljs-operator">=</span><span class="hljs-number">0.0</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">else</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">raise</span> NotImplementedError(f<span class="hljs-string">'Optimizer {name} not implemented.'</span>)</div></div></li></ol></code><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
</div> 
<h3><a name="t9"></a>2.2 å°†lion.pyåŠ å…¥ç¯å¢ƒä¸‹</h3> 
<p>è·¯å¾„å¦‚ä¸‹ï¼šyolov5\Lib\site-packages\torch\optim</p> 
<p><img alt="" height="312" src="https://img-blog.csdnimg.cn/2a407129379e40399978bf37dacff0eb.png" width="619">â€‹</p> 
<p>&nbsp;ä¿®æ”¹__init__.py</p> 
<pre data-index="1"><code class="hljs language-typescript"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">from</span> .<span class="hljs-property">asgd</span> <span class="hljs-keyword">import</span> <span class="hljs-variable constant_">ASGD</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">from</span> .<span class="hljs-property">sgd</span> <span class="hljs-keyword">import</span> <span class="hljs-variable constant_">SGD</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">from</span> .<span class="hljs-property">lion</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">Lion</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">from</span> .<span class="hljs-property">radam</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">RAdam</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">from</span> .<span class="hljs-property">rprop</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">Rprop</span></div></div></li></ol></code><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<p>&nbsp;lion.pyä»£ç å¦‚ä¸‹ï¼š</p> 
<pre data-index="2" class="set-code-hide" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># Copyright <span class="hljs-number">2023</span> Google Research. <span class="hljs-literal">All</span> Rights Reserved.</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">#</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># Licensed under the Apache License, Version <span class="hljs-number">2.0</span> (the <span class="hljs-string">"License"</span>);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># you may <span class="hljs-keyword">not</span> <span class="hljs-keyword">use</span> this <span class="hljs-keyword">file</span> except <span class="hljs-keyword">in</span> compliance <span class="hljs-keyword">with</span> the License.</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># You may obtain a <span class="hljs-keyword">copy</span> <span class="hljs-keyword">of</span> the License <span class="hljs-keyword">at</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">#</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">#     http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>www.apache.org<span class="hljs-operator">/</span>licenses<span class="hljs-operator">/</span>LICENSE-<span class="hljs-number">2.0</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">#</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># Unless required <span class="hljs-keyword">by</span> applicable law <span class="hljs-keyword">or</span> agreed <span class="hljs-keyword">to</span> <span class="hljs-keyword">in</span> writing, software</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># distributed under the License <span class="hljs-keyword">is</span> distributed <span class="hljs-keyword">on</span> an <span class="hljs-string">"AS IS"</span> BASIS,</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># WITHOUT WARRANTIES <span class="hljs-keyword">OR</span> CONDITIONS <span class="hljs-keyword">OF</span> <span class="hljs-keyword">ANY</span> KIND, either express <span class="hljs-keyword">or</span> implied.</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># See the License <span class="hljs-keyword">for</span> the specific language governing permissions <span class="hljs-keyword">and</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># limitations under the License.</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">""</span><span class="hljs-string">"PyTorch implementation of the Lion optimizer."</span><span class="hljs-string">""</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import torch</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">from</span> torch.optim.optimizer import Optimizer</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">class</span> Lion(Optimizer):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  r<span class="hljs-string">""</span><span class="hljs-string">"Implements Lion algorithm."</span><span class="hljs-string">""</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  def __init__(<span class="hljs-keyword">self</span>, params, lr<span class="hljs-operator">=</span><span class="hljs-number">1</span>e-<span class="hljs-number">4</span>, betas<span class="hljs-operator">=</span>(<span class="hljs-number">0.9</span>, <span class="hljs-number">0.99</span>), weight_decay<span class="hljs-operator">=</span><span class="hljs-number">0.0</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-string">""</span><span class="hljs-string"><span class="hljs-string">"Initialize the hyperparameters.</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string"></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">    Args:</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">      params (iterable): iterable of parameters to optimize or dicts defining</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        parameter groups</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">      lr (float, optional): learning rate (default: 1e-4)</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">      betas (Tuple[float, float], optional): coefficients used for computing</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        running averages of gradient and its square (default: (0.9, 0.99))</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">      weight_decay (float, optional): weight decay coefficient (default: 0)</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">    "</span><span class="hljs-string">""</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-number">0.0</span> <span class="hljs-operator">&lt;=</span> lr:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">      <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">'Invalid learning rate: {}'</span>.<span class="hljs-keyword">format</span>(lr))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-number">0.0</span> <span class="hljs-operator">&lt;=</span> betas[<span class="hljs-number">0</span>] <span class="hljs-operator">&lt;</span> <span class="hljs-number">1.0</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">      <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">'Invalid beta parameter at index 0: {}'</span>.<span class="hljs-keyword">format</span>(betas[<span class="hljs-number">0</span>]))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-number">0.0</span> <span class="hljs-operator">&lt;=</span> betas[<span class="hljs-number">1</span>] <span class="hljs-operator">&lt;</span> <span class="hljs-number">1.0</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">      <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">'Invalid beta parameter at index 1: {}'</span>.<span class="hljs-keyword">format</span>(betas[<span class="hljs-number">1</span>]))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    defaults <span class="hljs-operator">=</span> dict(lr<span class="hljs-operator">=</span>lr, betas<span class="hljs-operator">=</span>betas, weight_decay<span class="hljs-operator">=</span>weight_decay)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">super</span>().__init__(params, defaults)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  @torch.<span class="hljs-keyword">no</span>_grad()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  def step(<span class="hljs-keyword">self</span>, closure<span class="hljs-operator">=</span>None):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-string">""</span><span class="hljs-string"><span class="hljs-string">"Performs a single optimization step.</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string"></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">    Args:</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">      closure (callable, optional): A closure that reevaluates the model</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="50"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        and returns the loss.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="51"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string"></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="52"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">    Returns:</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="53"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">      the loss.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="54"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">    "</span><span class="hljs-string">""</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="55"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    loss <span class="hljs-operator">=</span> None</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="56"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> closure <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> None:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="57"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">      <span class="hljs-keyword">with</span> torch.enable_grad():</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="58"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        loss <span class="hljs-operator">=</span> closure()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="59"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="60"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">for</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.param_groups:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="61"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">      <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> <span class="hljs-keyword">group</span>[<span class="hljs-string">'params'</span>]:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="62"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> p.grad <span class="hljs-keyword">is</span> None:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="63"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">          <span class="hljs-keyword">continue</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="64"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="65"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        # <span class="hljs-keyword">Perform</span> stepweight decay</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="66"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        p.<span class="hljs-keyword">data</span>.mul_(<span class="hljs-number">1</span><span class="hljs-operator"> - </span><span class="hljs-keyword">group</span>[<span class="hljs-string">'lr'</span>] <span class="hljs-operator">*</span> <span class="hljs-keyword">group</span>[<span class="hljs-string">'weight_decay'</span>])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="67"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="68"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        grad <span class="hljs-operator">=</span> p.grad</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="69"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        state <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.state[p]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="70"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        # State initialization</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="71"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> len(state) <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-number">0</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="72"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">          # Exponential moving average <span class="hljs-keyword">of</span> gradient <span class="hljs-keyword">values</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="73"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">          state[<span class="hljs-string">'exp_avg'</span>] <span class="hljs-operator">=</span> torch.<span class="hljs-literal">zeros</span>_like(p)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="74"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="75"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        exp_avg <span class="hljs-operator">=</span> state[<span class="hljs-string">'exp_avg'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="76"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        beta<span class="hljs-number">1</span>, beta<span class="hljs-number">2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">group</span>[<span class="hljs-string">'betas'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="77"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="78"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        # Weight update</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="79"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        update <span class="hljs-operator">=</span> exp_avg <span class="hljs-operator">*</span> beta<span class="hljs-number">1</span> <span class="hljs-operator">+</span> grad <span class="hljs-operator">*</span> (<span class="hljs-number">1</span><span class="hljs-operator"> - </span>beta<span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="80"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        p.<span class="hljs-keyword">add</span>_(torch.<span class="hljs-keyword">sign</span>(update), alpha<span class="hljs-operator">=</span>-<span class="hljs-keyword">group</span>[<span class="hljs-string">'lr'</span>])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="81"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        # Decay the momentum running average coefficient</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="82"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        exp_avg.mul_(beta<span class="hljs-number">2</span>).<span class="hljs-keyword">add</span>_(grad, alpha<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator"> - </span>beta<span class="hljs-number">2</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="83"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="84"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> loss</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<p></p> 
<h3><a name="t10"></a>2.3ä¿®æ”¹ultralytics/yolo/cfg/default.yaml</h3> 
<pre data-index="3"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">batch: <span class="hljs-number">32</span>  # <span class="hljs-keyword">number</span> <span class="hljs-keyword">of</span> images per batch (-<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> AutoBatch)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">optimizer: Lion  # optimizer <span class="hljs-keyword">to</span> <span class="hljs-keyword">use</span>, choices<span class="hljs-operator">=</span>[<span class="hljs-string">'SGD'</span>, <span class="hljs-string">'Adam'</span>, <span class="hljs-string">'AdamW'</span>, <span class="hljs-string">'RMSProp'</span>, <span class="hljs-string">'Lion'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">lr<span class="hljs-number">0</span>: <span class="hljs-number">0.0001</span>  # <span class="hljs-keyword">initial</span> learning rate (i.e. SGD<span class="hljs-operator">=</span><span class="hljs-number">1</span>E-<span class="hljs-number">2</span>, Adam<span class="hljs-operator">=</span><span class="hljs-number">1</span>E-<span class="hljs-number">3</span> ,Lion<span class="hljs-operator">=</span><span class="hljs-number">1</span>E-<span class="hljs-number">4</span>)</div></div></li></ol></code><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<div></div> 
<div>
  ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ 
</div> 
<div>
  ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ 
</div> 
<div>
  ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ 
</div> 
<div></div> 
<div> 
 <h2><a name="t11"></a>3.&nbsp;Lionä¼˜åŒ–å™¨å¯¼å…¥Yolov8</h2> 
 <h2><a name="t12"></a>3.1 ä¿®æ”¹utils/torch_utils.py</h2> 
 <p>åŠ å…¥ä»¥ä¸‹ä»£ç </p> 
 <pre data-index="4" class="set-code-hide" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">class</span> Lion(Optimizer):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  r<span class="hljs-string">""</span><span class="hljs-string">"Implements Lion algorithm."</span><span class="hljs-string">""</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  def __init__(<span class="hljs-keyword">self</span>, params, lr<span class="hljs-operator">=</span><span class="hljs-number">1</span>e-<span class="hljs-number">4</span>, betas<span class="hljs-operator">=</span>(<span class="hljs-number">0.9</span>, <span class="hljs-number">0.99</span>), weight_decay<span class="hljs-operator">=</span><span class="hljs-number">0.0</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-string">""</span><span class="hljs-string"><span class="hljs-string">"Initialize the hyperparameters.</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string"></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">    Args:</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">      params (iterable): iterable of parameters to optimize or dicts defining</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        parameter groups</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">      lr (float, optional): learning rate (default: 1e-4)</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">      betas (Tuple[float, float], optional): coefficients used for computing</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        running averages of gradient and its square (default: (0.9, 0.99))</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">      weight_decay (float, optional): weight decay coefficient (default: 0)</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">    "</span><span class="hljs-string">""</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-number">0.0</span> <span class="hljs-operator">&lt;=</span> lr:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">      <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">'Invalid learning rate: {}'</span>.<span class="hljs-keyword">format</span>(lr))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-number">0.0</span> <span class="hljs-operator">&lt;=</span> betas[<span class="hljs-number">0</span>] <span class="hljs-operator">&lt;</span> <span class="hljs-number">1.0</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">      <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">'Invalid beta parameter at index 0: {}'</span>.<span class="hljs-keyword">format</span>(betas[<span class="hljs-number">0</span>]))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-number">0.0</span> <span class="hljs-operator">&lt;=</span> betas[<span class="hljs-number">1</span>] <span class="hljs-operator">&lt;</span> <span class="hljs-number">1.0</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">      <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">'Invalid beta parameter at index 1: {}'</span>.<span class="hljs-keyword">format</span>(betas[<span class="hljs-number">1</span>]))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    defaults <span class="hljs-operator">=</span> dict(lr<span class="hljs-operator">=</span>lr, betas<span class="hljs-operator">=</span>betas, weight_decay<span class="hljs-operator">=</span>weight_decay)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">super</span>().__init__(params, defaults)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  @torch.<span class="hljs-keyword">no</span>_grad()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  def step(<span class="hljs-keyword">self</span>, closure<span class="hljs-operator">=</span>None):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-string">""</span><span class="hljs-string"><span class="hljs-string">"Performs a single optimization step.</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string"></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">    Args:</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">      closure (callable, optional): A closure that reevaluates the model</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">        and returns the loss.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string"></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">    Returns:</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">      the loss.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">    "</span><span class="hljs-string">""</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    loss <span class="hljs-operator">=</span> None</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> closure <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> None:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">      <span class="hljs-keyword">with</span> torch.enable_grad():</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        loss <span class="hljs-operator">=</span> closure()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">for</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.param_groups:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">      <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> <span class="hljs-keyword">group</span>[<span class="hljs-string">'params'</span>]:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> p.grad <span class="hljs-keyword">is</span> None:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">          <span class="hljs-keyword">continue</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        # <span class="hljs-keyword">Perform</span> stepweight decay</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        p.<span class="hljs-keyword">data</span>.mul_(<span class="hljs-number">1</span><span class="hljs-operator"> - </span><span class="hljs-keyword">group</span>[<span class="hljs-string">'lr'</span>] <span class="hljs-operator">*</span> <span class="hljs-keyword">group</span>[<span class="hljs-string">'weight_decay'</span>])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        grad <span class="hljs-operator">=</span> p.grad</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="50"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        state <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.state[p]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="51"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        # State initialization</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="52"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> len(state) <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-number">0</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="53"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">          # Exponential moving average <span class="hljs-keyword">of</span> gradient <span class="hljs-keyword">values</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="54"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">          state[<span class="hljs-string">'exp_avg'</span>] <span class="hljs-operator">=</span> torch.<span class="hljs-literal">zeros</span>_like(p)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="55"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="56"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        exp_avg <span class="hljs-operator">=</span> state[<span class="hljs-string">'exp_avg'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="57"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        beta<span class="hljs-number">1</span>, beta<span class="hljs-number">2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">group</span>[<span class="hljs-string">'betas'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="58"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="59"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        # Weight update</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="60"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        update <span class="hljs-operator">=</span> exp_avg <span class="hljs-operator">*</span> beta<span class="hljs-number">1</span> <span class="hljs-operator">+</span> grad <span class="hljs-operator">*</span> (<span class="hljs-number">1</span><span class="hljs-operator"> - </span>beta<span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="61"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        p.<span class="hljs-keyword">add</span>_(torch.<span class="hljs-keyword">sign</span>(update), alpha<span class="hljs-operator">=</span>-<span class="hljs-keyword">group</span>[<span class="hljs-string">'lr'</span>])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="62"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        # Decay the momentum running average coefficient</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="63"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        exp_avg.mul_(beta<span class="hljs-number">2</span>).<span class="hljs-keyword">add</span>_(grad, alpha<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator"> - </span>beta<span class="hljs-number">2</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="64"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="65"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> loss</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
 <p>ä¿®æ”¹def smart_optimizer(model, name='Adam', lr=0.001, momentum=0.9, decay=1e-5):å‡½æ•°</p> 
 <pre data-index="5"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> name <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-string">'Adam'</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        optimizer <span class="hljs-operator">=</span> torch.optim.Adam(g[<span class="hljs-number">2</span>], lr<span class="hljs-operator">=</span>lr, betas<span class="hljs-operator">=</span>(momentum, <span class="hljs-number">0.999</span>))  # adjust beta<span class="hljs-number">1</span> <span class="hljs-keyword">to</span> momentum</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    elif name <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-string">'AdamW'</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        optimizer <span class="hljs-operator">=</span> torch.optim.AdamW(g[<span class="hljs-number">2</span>], lr<span class="hljs-operator">=</span>lr, betas<span class="hljs-operator">=</span>(momentum, <span class="hljs-number">0.999</span>), weight_decay<span class="hljs-operator">=</span><span class="hljs-number">0.0</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    elif name <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-string">'RMSProp'</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        optimizer <span class="hljs-operator">=</span> torch.optim.RMSprop(g[<span class="hljs-number">2</span>], lr<span class="hljs-operator">=</span>lr, momentum<span class="hljs-operator">=</span>momentum)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    elif name <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-string">'SGD'</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        optimizer <span class="hljs-operator">=</span> torch.optim.SGD(g[<span class="hljs-number">2</span>], lr<span class="hljs-operator">=</span>lr, momentum<span class="hljs-operator">=</span>momentum, nesterov<span class="hljs-operator">=</span><span class="hljs-keyword">True</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    elif name <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-string">'Lion'</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        optimizer <span class="hljs-operator">=</span> Lion(g[<span class="hljs-number">2</span>], lr<span class="hljs-operator">=</span>lr, betas<span class="hljs-operator">=</span>(momentum, <span class="hljs-number">0.999</span>), weight_decay<span class="hljs-operator">=</span><span class="hljs-number">0.0</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">else</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">raise</span> NotImplementedError(f<span class="hljs-string">'Optimizer {name} not implemented.'</span>)</div></div></li></ol></code><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
 <h3><a name="t13"></a>3.2 ä¿®æ”¹train.py</h3> 
 <p>ä¿®æ”¹def parse_opt(known=False):</p> 
 <pre data-index="6" class="set-code-hide" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:1111px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> parser <span class="hljs-operator">=</span> argparse.ArgumentParser()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--weights'</span>, <span class="hljs-keyword">type</span><span class="hljs-operator">=</span>str, <span class="hljs-keyword">default</span><span class="hljs-operator">=</span>ROOT <span class="hljs-operator">/</span> <span class="hljs-string">'weights/yolov5s.pt'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'initial weights path'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--cfg'</span>, <span class="hljs-keyword">type</span><span class="hljs-operator">=</span>str, <span class="hljs-keyword">default</span><span class="hljs-operator">=</span><span class="hljs-string">'models/yolov5s.yaml'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'model.yaml path'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--data'</span>, <span class="hljs-keyword">type</span><span class="hljs-operator">=</span>str, <span class="hljs-keyword">default</span><span class="hljs-operator">=</span>ROOT <span class="hljs-operator">/</span> <span class="hljs-string">'data/crack.yaml'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'dataset.yaml path'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--hyp'</span>, <span class="hljs-keyword">type</span><span class="hljs-operator">=</span>str, <span class="hljs-keyword">default</span><span class="hljs-operator">=</span>ROOT <span class="hljs-operator">/</span> <span class="hljs-string">'data/hyps/hyp.scratch-low.yaml'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'hyperparameters path'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--epochs'</span>, <span class="hljs-keyword">type</span><span class="hljs-operator">=</span>int, <span class="hljs-keyword">default</span><span class="hljs-operator">=</span><span class="hljs-number">100</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'total training epochs'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--batch-size'</span>, <span class="hljs-keyword">type</span><span class="hljs-operator">=</span>int, <span class="hljs-keyword">default</span><span class="hljs-operator">=</span><span class="hljs-number">64</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'total batch size for all GPUs, -1 for autobatch'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--imgsz'</span>, <span class="hljs-string">'--img'</span>, <span class="hljs-string">'--img-size'</span>, <span class="hljs-keyword">type</span><span class="hljs-operator">=</span>int, <span class="hljs-keyword">default</span><span class="hljs-operator">=</span><span class="hljs-number">640</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'train, val image size (pixels)'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--rect'</span>, action<span class="hljs-operator">=</span><span class="hljs-string">'store_true'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'rectangular training'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--resume'</span>, nargs<span class="hljs-operator">=</span><span class="hljs-string">'?'</span>, const<span class="hljs-operator">=</span><span class="hljs-keyword">True</span>, <span class="hljs-keyword">default</span><span class="hljs-operator">=</span><span class="hljs-keyword">False</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'resume most recent training'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--nosave'</span>, action<span class="hljs-operator">=</span><span class="hljs-string">'store_true'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'only save final checkpoint'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--noval'</span>, action<span class="hljs-operator">=</span><span class="hljs-string">'store_true'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'only validate final epoch'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--noautoanchor'</span>, action<span class="hljs-operator">=</span><span class="hljs-string">'store_true'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'disable AutoAnchor'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--noplots'</span>, action<span class="hljs-operator">=</span><span class="hljs-string">'store_true'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'save no plot files'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--evolve'</span>, <span class="hljs-keyword">type</span><span class="hljs-operator">=</span>int, nargs<span class="hljs-operator">=</span><span class="hljs-string">'?'</span>, const<span class="hljs-operator">=</span><span class="hljs-number">300</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'evolve hyperparameters for x generations'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--bucket'</span>, <span class="hljs-keyword">type</span><span class="hljs-operator">=</span>str, <span class="hljs-keyword">default</span><span class="hljs-operator">=</span><span class="hljs-string">''</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'gsutil bucket'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--cache'</span>, <span class="hljs-keyword">type</span><span class="hljs-operator">=</span>str, nargs<span class="hljs-operator">=</span><span class="hljs-string">'?'</span>, const<span class="hljs-operator">=</span><span class="hljs-string">'ram'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'image --cache ram/disk'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--image-weights'</span>, action<span class="hljs-operator">=</span><span class="hljs-string">'store_true'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'use weighted image selection for training'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--device'</span>, <span class="hljs-keyword">default</span><span class="hljs-operator">=</span><span class="hljs-string">'1'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'cuda device, i.e. 0 or 0,1,2,3 or cpu'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--multi-scale'</span>, action<span class="hljs-operator">=</span><span class="hljs-string">'store_true'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'vary img-size +/- 50%%'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--single-cls'</span>, action<span class="hljs-operator">=</span><span class="hljs-string">'store_true'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'train multi-class data as single-class'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--optimizer'</span>, <span class="hljs-keyword">type</span><span class="hljs-operator">=</span>str, choices<span class="hljs-operator">=</span>[<span class="hljs-string">'SGD'</span>, <span class="hljs-string">'Adam'</span>, <span class="hljs-string">'AdamW'</span>,<span class="hljs-string">'Lion'</span>], <span class="hljs-keyword">default</span><span class="hljs-operator">=</span><span class="hljs-string">'Lion'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'optimizer'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--sync-bn'</span>, action<span class="hljs-operator">=</span><span class="hljs-string">'store_true'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'use SyncBatchNorm, only available in DDP mode'</span>)</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
 <h3><a name="t14"></a>3.3ä¿®æ”¹data/hyps/hyp.scratch-low.yaml</h3> 
 <pre data-index="7"><code class="hljs language-cobol">lr<span class="hljs-number">0</span>: <span class="hljs-number">0.0001</span>  # <span class="hljs-keyword">initial</span> learning rate (SGD<span class="hljs-operator">=</span><span class="hljs-number">1</span>E-<span class="hljs-number">2</span>, Adam<span class="hljs-operator">=</span><span class="hljs-number">1</span>E-<span class="hljs-number">3</span>,LION<span class="hljs-operator">=</span><span class="hljs-number">1</span>E-<span class="hljs-number">4</span>)</code><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
 <h3><a name="t15"></a>3.4ä¿®æ”¹utils/loggers/clearml/hpo.py</h3> 
 <pre data-index="8"><code class="hljs language-cobol">parser.<span class="hljs-keyword">add</span>_argument(<span class="hljs-string">'--optimizer'</span>, <span class="hljs-keyword">type</span><span class="hljs-operator">=</span>str, choices<span class="hljs-operator">=</span>[<span class="hljs-string">'SGD'</span>, <span class="hljs-string">'Adam'</span>, <span class="hljs-string">'AdamW'</span>,<span class="hljs-string">'Lion'</span>], <span class="hljs-keyword">default</span><span class="hljs-operator">=</span><span class="hljs-string">'Lion'</span>, help<span class="hljs-operator">=</span><span class="hljs-string">'optimizer'</span>)</code><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
</div> 
<div></div> 
<h2><a name="t16"></a>4.æ€»ç»“</h2> 
<p>&nbsp; &nbsp; æœ¬æ–‡ä»‹ç»äº† Google æ–°æå‡ºçš„ä¼˜åŒ–å™¨ Lionï¼Œå®ƒé€šè¿‡å¤§é‡ç®—åŠ›æœç´¢å¹¶ç»“åˆäººå·¥å¹²é¢„å¾—å‡ºï¼Œç›¸æ¯”ä¸»æµçš„ AdamWï¼Œæœ‰ç€é€Ÿåº¦æ›´å¿«ä¸”æ›´çœå†…å­˜çš„ç‰¹ç‚¹ï¼Œå¹¶ä¸”å¤§é‡å®éªŒç»“æœæ˜¾ç¤ºï¼Œå®ƒåœ¨å¤šæ•°ä»»åŠ¡ä¸Šéƒ½æœ‰ç€ä¸é€Šè‰²äºç”šè‡³ä¼˜äº AdamW çš„è¡¨ç°ã€‚</p>
                </div><div data-report-view="{&quot;mod&quot;:&quot;1585297308_001&quot;,&quot;spm&quot;:&quot;1001.2101.3001.6548&quot;,&quot;dest&quot;:&quot;https://cv2023.blog.csdn.net/article/details/130222697&quot;,&quot;extend1&quot;:&quot;pc&quot;,&quot;ab&quot;:&quot;new&quot;}"><div></div></div>
        </div>