<div id="article_content" class="article_content clearfix">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/kdoc_html_views-1a98987dfd.css">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-dc4a025e85.css">
                <div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="" style="margin: 0px 0px 2px; padding-left: 24px;"><a href="#1.%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA%28Data%20Augmentation%29" target="_self">1.数据增强(Data Augmentation)</a></p> 
<p id="" style="margin: 0px 0px 2px; padding-left: 24px;"><a href="#t1" target="_self">2.自动生成图片和xml文件</a></p> 
<p id="" style="margin: 0px 0px 2px 48px; padding-left: 24px;"><a href="#t2" target="_self">2.1 Gamma变化数据增强</a></p> 
<p id="" style="margin: 0px 0px 2px 48px; padding-left: 24px;"><a href="#t3" target="_self">2.2 滤波类数据增强: GaussianBlur、medianBlur、blur</a></p> 
<p id="" style="margin: 0px 0px 2px 48px; padding-left: 24px;"><a href="#t4" target="_self">2.3&nbsp; 缩放类数据增强</a></p> 
<p id="" style="margin: 0px 0px 2px 48px; padding-left: 24px;"><a href="#t5" target="_self">2.4翻转类数据增强</a></p> 
<p id="" style="margin: 0px 0px 2px 48px; padding-left: 24px;"><a href="#t6" target="_self">2.5 任意角度旋转数据增强</a></p> 
<hr id="hr-toc"> 
<h3><a name="t0"></a>&nbsp;🏆🏆🏆🏆🏆🏆🏆Yolov5/Yolov7魔术师🏆🏆🏆🏆🏆🏆🏆<br> 🌟🌟🌟魔改网络和复现cvpr等前沿论文，组合优化<br> 🍉🍉🍉独家首创，可直接作为创新点使用<br> 🚀🚀🚀在多个数据集进行验证mAP涨点明显，尤其是小目标、遮挡物精度提升明显；&nbsp;<br> 🌰 🌰 🌰🌰 🌰 🌰🌰 🌰 🌰🌰 🌰 🌰🌰 🌰 🌰🌰 🌰 🌰</h3> 
<h2><a name="t1"></a>1.小样本目标检测介绍&nbsp; &nbsp; &nbsp;&nbsp;</h2> 
<p>&nbsp;&nbsp;小样本目标检测方法主要基于传统的经典成熟的目标检测方法，借鉴小样本学习框架，构建针对目标检测的小样本解决方案。现有的方法主要可以分为六种：</p> 
<p>（1）基于度量学习（metric learning）的方法<br> （2）<span style="color:#fe2c24;"><strong>基于数据增强的方法</strong></span><br> （3）基于模型结构的方法<br> （4）基于微调（fine-tune）的方法<br> （5）基于元学习的方法<br> （6）基于集成的方法</p> 
<h3><a name="t2"></a>1.1 小样本目标检测现有的问题</h3> 
<p>１、依赖于传统的目标检测领域中经典成熟的方法，但是后续的推理速度缓慢，不能满足实时性需求。</p> 
<p>２、现有的方法泛化性能差强人意，随小样本类别增加，效果下降明显</p> 
<h3 id="1.%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA(Data%20Augmentation)"><a name="t3"></a>1.2 <a href="https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;数据增强\&quot;}&quot;}" data-tit="数据增强" data-pretit="数据增强">数据增强</a>(Data Augmentation)</h3> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;数据增强（也叫数据扩增）的目的是为了扩充数据和提升模型的泛化能力。有效的数据扩充不仅能扩充训练样本数量，还能增加训练样本的多样性，一方面可避免过拟合，另一方面又会带来模型性能的提升。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;数据增强（Data Augmentation）是一种使用少量数据通过先验知识产生更多的相似生成数据来扩展训练数据集的方法。 数据增强方法常用于解决现实业务中的小样本问题。</p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;数据增强几种常用方法有: 图像水平/竖直翻转、随机抠取、尺度变换和旋转。其中尺度变换（scaling）、旋转（rotating）等方法用来增加卷积卷积神经网络对物体尺度和方向上的鲁棒性。</p> 
<p><img alt="" height="518" src="https://img-blog.csdnimg.cn/1d4f11e963eb43d8b685121df8b9dcfa.png" width="1200"></p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;小样本学习主要问题是样本量过少，从而导致样本多样性不足以刻画完整样本分布，可以通过样本增强来提升样本多样性；基于数据增强的方法是利用辅助数据集或者辅助信息增强目标数据集中进行数据扩充 或特征增强，使模型能更好拟合。数据扩充可以是无标签或者合成带标签数据；特征增强是在原样本的特征空间中添加便于分类的特征，增加特征多样性；</p> 
<h2 id="2.%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E5%9B%BE%E7%89%87%E5%92%8Cxml%E6%96%87%E4%BB%B6"><a name="t4"></a>2.自动生成图片和xml文件</h2> 
<h3 id="2.1%20Gamma%E5%8F%98%E5%8C%96%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA"><a name="t5"></a>2.1 <a href="https://so.csdn.net/so/search?q=Gamma&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=Gamma&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;Gamma\&quot;}&quot;}" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=Gamma&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;Gamma\&quot;}&quot;}" data-tit="Gamma" data-pretit="gamma">Gamma</a>变化数据增强</h3> 
<p>通过&nbsp;aa和gg两个变化调整gamma变化的程度</p> 
<pre data-index="0" class="set-code-hide" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># -<span class="hljs-operator">*</span>- coding: utf-<span class="hljs-number">8</span> -<span class="hljs-operator">*</span>-</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">""</span><span class="hljs-string"><span class="hljs-string">"</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">Created on Fri Jun 01 15:24:21 2018</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string"></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">@author: AI&amp;CV</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">"</span><span class="hljs-string">""</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import cv<span class="hljs-number">2</span>  </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import numpy <span class="hljs-keyword">as</span> np </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import xml.etree.ElementTree <span class="hljs-keyword">as</span> ET</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import os</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">from</span> skimage import  exposure</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">xmlpath <span class="hljs-operator">=</span> <span class="hljs-string">'./VOC2007/Annotations/'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">imgpath <span class="hljs-operator">=</span> <span class="hljs-string">'./VOC2007/JPEGImages/'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">hist_imgpath <span class="hljs-operator">=</span> <span class="hljs-string">'./VOC2007/gammma/'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">hist_xmlpath <span class="hljs-operator">=</span> <span class="hljs-string">'./xmlgammma/'</span> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> os.listdir(imgpath):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    a, b <span class="hljs-operator">=</span> os.path.splitext(i) </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    img <span class="hljs-operator">=</span> cv<span class="hljs-number">2</span>.imread(imgpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'.jpg'</span>,<span class="hljs-number">0</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">   #################</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    w <span class="hljs-operator">=</span> img.shape[<span class="hljs-number">1</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    h <span class="hljs-operator">=</span> img.shape[<span class="hljs-number">0</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    img<span class="hljs-number">2</span> <span class="hljs-operator">=</span> np.<span class="hljs-literal">zeros</span>([h, w], img.dtype)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    aa<span class="hljs-operator">=</span><span class="hljs-number">1.1</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    gg<span class="hljs-operator">=</span><span class="hljs-number">5</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    img<span class="hljs-number">1</span> <span class="hljs-operator">=</span> cv<span class="hljs-number">2</span>.addWeighted(img, aa, img<span class="hljs-number">2</span>, <span class="hljs-number">1</span>-aa, gg)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    ########################</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    #img<span class="hljs-number">1</span> <span class="hljs-operator">=</span> exposure.adjust_gamma(img,<span class="hljs-number">0.9</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    #img<span class="hljs-number">1</span><span class="hljs-operator">=</span> exposure.adjust_log(img)   #对数调整</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    cv<span class="hljs-number">2</span>.imwrite(hist_imgpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'_gamma'</span><span class="hljs-operator">+</span> str(<span class="hljs-number">1</span>) <span class="hljs-operator">+</span><span class="hljs-string">'_'</span><span class="hljs-operator">+</span> str(<span class="hljs-number">9</span>)<span class="hljs-operator">+</span><span class="hljs-string">'.jpg'</span>,img<span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">   </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    tree <span class="hljs-operator">=</span> ET.parse(xmlpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'.xml'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    root <span class="hljs-operator">=</span> tree.getroot()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">for</span> <span class="hljs-keyword">file</span><span class="hljs-number">1</span> <span class="hljs-keyword">in</span> root.findall(<span class="hljs-string">'filename'</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            #filename<span class="hljs-operator">=</span>str(<span class="hljs-keyword">file</span><span class="hljs-number">1</span>.find(<span class="hljs-string">'filename'</span>).text)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">file</span><span class="hljs-number">1</span>.text <span class="hljs-operator">=</span> str(a <span class="hljs-operator">+</span> <span class="hljs-string">'_gamma'</span><span class="hljs-operator">+</span> str(<span class="hljs-number">1</span>) <span class="hljs-operator">+</span><span class="hljs-string">'_'</span><span class="hljs-operator">+</span> str(<span class="hljs-number">9</span>)<span class="hljs-operator">+</span><span class="hljs-string">'.jpg'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    tree.<span class="hljs-keyword">write</span>(hist_xmlpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'_gamma'</span><span class="hljs-operator">+</span> str(<span class="hljs-number">1</span>) <span class="hljs-operator">+</span><span class="hljs-string">'_'</span><span class="hljs-operator">+</span> str(<span class="hljs-number">9</span>) <span class="hljs-operator">+</span><span class="hljs-string">'.xml'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    print( str(a) <span class="hljs-operator">+</span> <span class="hljs-string">'.xml has been gamma  '</span>)</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h3 id="2.2%20%E6%BB%A4%E6%B3%A2%E7%B1%BB%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA%3A%20GaussianBlur%E3%80%81medianBlur%E3%80%81blur"><a name="t6"></a>2.2 <a href="https://so.csdn.net/so/search?q=%E6%BB%A4%E6%B3%A2&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=%E6%BB%A4%E6%B3%A2&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;滤波\&quot;}&quot;}" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=%E6%BB%A4%E6%B3%A2&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;滤波\&quot;}&quot;}" data-tit="滤波" data-pretit="滤波">滤波</a>类数据增强: GaussianBlur、medianBlur、blur</h3> 
<pre data-index="1" class="set-code-hide" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># -<span class="hljs-operator">*</span>- coding: utf-<span class="hljs-number">8</span> -<span class="hljs-operator">*</span>-</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">""</span><span class="hljs-string"><span class="hljs-string">"</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">Created on Fri Jun 01 15:24:21 2018</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string"></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">@author: AI&amp;CV</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">"</span><span class="hljs-string">""</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import cv<span class="hljs-number">2</span>  </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import numpy <span class="hljs-keyword">as</span> np </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import xml.etree.ElementTree <span class="hljs-keyword">as</span> ET</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import os</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">from</span> skimage import  exposure</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">xmlpath <span class="hljs-operator">=</span> <span class="hljs-string">'./Annotations/'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">imgpath <span class="hljs-operator">=</span> <span class="hljs-string">'./JPEGImages/'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">blur_imgpath <span class="hljs-operator">=</span> <span class="hljs-string">'./motionblur/'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">blur_xmlpath <span class="hljs-operator">=</span> <span class="hljs-string">'./xmlmotion/'</span> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> os.listdir(imgpath):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    a, b <span class="hljs-operator">=</span> os.path.splitext(i) </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    img <span class="hljs-operator">=</span> cv<span class="hljs-number">2</span>.imread(imgpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'.jpg'</span>,<span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    #img<span class="hljs-number">1</span> <span class="hljs-operator">=</span> cv<span class="hljs-number">2</span>.bilateralFilter(img,<span class="hljs-number">15,15,2,4</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    img<span class="hljs-number">1</span> <span class="hljs-operator">=</span> cv<span class="hljs-number">2</span>.blur(img,(<span class="hljs-number">3,3</span>));</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    #img<span class="hljs-number">1</span> <span class="hljs-operator">=</span> cv<span class="hljs-number">2</span>.GaussianBlur(img,(<span class="hljs-number">3,3</span>),<span class="hljs-number">3</span>); #(<span class="hljs-number">9,9</span>),<span class="hljs-number">5</span><span class="hljs-keyword">and</span><span class="hljs-number">3</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    #img<span class="hljs-number">1</span> <span class="hljs-operator">=</span> cv<span class="hljs-number">2</span>.medianBlur(img,<span class="hljs-number">3</span>);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    cv<span class="hljs-number">2</span>.imwrite(blur_imgpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'_blur_'</span><span class="hljs-operator">+</span>str(<span class="hljs-number">3</span>) <span class="hljs-operator">+</span><span class="hljs-string">'.jpg'</span>,img<span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    tree <span class="hljs-operator">=</span> ET.parse(xmlpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'.xml'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    root <span class="hljs-operator">=</span> tree.getroot()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">for</span> <span class="hljs-keyword">file</span><span class="hljs-number">1</span> <span class="hljs-keyword">in</span> root.findall(<span class="hljs-string">'filename'</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            #filename<span class="hljs-operator">=</span>str(<span class="hljs-keyword">file</span><span class="hljs-number">1</span>.find(<span class="hljs-string">'filename'</span>).text)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">file</span><span class="hljs-number">1</span>.text <span class="hljs-operator">=</span> str(a <span class="hljs-operator">+</span> <span class="hljs-string">'_blur_'</span> <span class="hljs-operator">+</span>str(<span class="hljs-number">3</span>)<span class="hljs-operator">+</span><span class="hljs-string">'.jpg'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    tree.<span class="hljs-keyword">write</span>(blur_xmlpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'_blur_'</span> <span class="hljs-operator">+</span>str(<span class="hljs-number">3</span>) <span class="hljs-operator">+</span><span class="hljs-string">'.xml'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    print( str(a) <span class="hljs-operator">+</span> <span class="hljs-string">'.xml has been gamma  '</span>)</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h3 id="2.3%C2%A0%20%E7%BC%A9%E6%94%BE%E7%B1%BB%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA"><a name="t7"></a>2.3&nbsp; 缩放类数据增强</h3> 
<pre data-index="2" class="set-code-hide" name="code"><code class="hljs language-python"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"># -*- coding: utf-8 -*-</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string"><span class="hljs-string">"""</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">Created on Mon Apr 09 09:48:50 2018</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string"></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">@author: AI&amp;CV</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">"""</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> cv2</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> math</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> xml.etree.ElementTree <span class="hljs-keyword">as</span> ET</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> os</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">      </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">xmlpath = <span class="hljs-string">'./Annotations/'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">imgpath = <span class="hljs-string">'./JPEGImages/'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">resize_imgpath = <span class="hljs-string">'./resize/'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">rotated_xmlpath = <span class="hljs-string">'./resizexml/'</span> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> os.listdir(imgpath):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        a, b = os.path.splitext(i)                            <span class="hljs-comment">#分离出文件名a</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        img = cv2.imread(imgpath + a + <span class="hljs-string">'.jpg'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        w = img.shape[<span class="hljs-number">1</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        h = img.shape[<span class="hljs-number">0</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        scale_h=<span class="hljs-number">0.98</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        scale_w=<span class="hljs-number">0.98</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        resize_img=cv2.resize(img, (<span class="hljs-built_in">int</span>(w*scale_w), <span class="hljs-built_in">int</span>(h*scale_h)), interpolation=cv2.INTER_CUBIC)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        cv2.imwrite(resize_imgpath + a + <span class="hljs-string">'_'</span>+ <span class="hljs-built_in">str</span>(<span class="hljs-number">98</span>) +<span class="hljs-string">'.jpg'</span>,resize_img)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-comment">#print str(i) + ' has been rotated for '+ st12°'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        tree = ET.parse(xmlpath + a + <span class="hljs-string">'.xml'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        root = tree.getroot()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">for</span> file1 <span class="hljs-keyword">in</span> root.findall(<span class="hljs-string">'filename'</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-comment">#filename=str(file1.find('filename').text)</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            file1.text = <span class="hljs-built_in">str</span>(a + <span class="hljs-string">'_'</span>+ <span class="hljs-built_in">str</span>(<span class="hljs-number">98</span>)+<span class="hljs-string">'.jpg'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">           </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">       </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">for</span> box <span class="hljs-keyword">in</span> root.<span class="hljs-built_in">iter</span>(<span class="hljs-string">'bndbox'</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            xmin = <span class="hljs-built_in">float</span>(box.find(<span class="hljs-string">'xmin'</span>).text)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            ymin = <span class="hljs-built_in">float</span>(box.find(<span class="hljs-string">'ymin'</span>).text)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            xmax = <span class="hljs-built_in">float</span>(box.find(<span class="hljs-string">'xmax'</span>).text)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            ymax = <span class="hljs-built_in">float</span>(box.find(<span class="hljs-string">'ymax'</span>).text)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            x=<span class="hljs-built_in">int</span>(xmin*scale_h)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            y=<span class="hljs-built_in">int</span>(ymin*scale_w)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            x1=<span class="hljs-built_in">int</span>(xmax*scale_h)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            y1=<span class="hljs-built_in">int</span>(ymax*scale_w)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            cv2.rectangle(resize_img, (x, y), (x1, y1), [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>], <span class="hljs-number">2</span>)   <span class="hljs-comment">#可在该步骤测试新画的框位置是否正确</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="50"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-comment"># cv2.imshow('xmlbnd',rotated_img)</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="51"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-comment"># cv2.waitKey(200)</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="52"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            box.find(<span class="hljs-string">'xmin'</span>).text = <span class="hljs-built_in">str</span>(x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="53"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            box.find(<span class="hljs-string">'ymin'</span>).text = <span class="hljs-built_in">str</span>(y)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="54"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            box.find(<span class="hljs-string">'xmax'</span>).text = <span class="hljs-built_in">str</span>(x1)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="55"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            box.find(<span class="hljs-string">'ymax'</span>).text = <span class="hljs-built_in">str</span>(y1)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="56"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-comment">#cv2.imwrite("E:/test/VOC07/3/" + a + "_" + str(1000) +".jpg",resize_img)</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="57"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        tree.write(rotated_xmlpath + a + <span class="hljs-string">'_'</span>+ <span class="hljs-built_in">str</span>(<span class="hljs-number">98</span>) +<span class="hljs-string">'.xml'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="58"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-built_in">print</span> (<span class="hljs-built_in">str</span>(a) + <span class="hljs-string">'.xml has been rotated for '</span>+ <span class="hljs-built_in">str</span>(<span class="hljs-number">98</span>))</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h3 id="2.4%E7%BF%BB%E8%BD%AC%E7%B1%BB%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA"><a name="t8"></a>2.4翻转类数据增强</h3> 
<pre data-index="3" class="set-code-hide" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># -<span class="hljs-operator">*</span>- coding: utf-<span class="hljs-number">8</span> -<span class="hljs-operator">*</span>-</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">""</span><span class="hljs-string"><span class="hljs-string">"</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">Created on Sun Apr 08 18:27:53 2018</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string"></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">@author: AI&amp;CV</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">"</span><span class="hljs-string">""</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import cv<span class="hljs-number">2</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import math</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import numpy <span class="hljs-keyword">as</span> np</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import xml.etree.ElementTree <span class="hljs-keyword">as</span> ET</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import os</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">def GetUDFlipLoc(h, xmin, ymin, xmax, ymax):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    H<span class="hljs-operator">=</span>h </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    NewXmin<span class="hljs-operator">=</span>xmin</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    NewYmin<span class="hljs-operator">=</span>H-ymax</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    NewXmax<span class="hljs-operator">=</span>xmax</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    NewYmax<span class="hljs-operator">=</span>H-ymin</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> NewXmin,NewYmin,NewXmax,NewYmax</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">xmlpath <span class="hljs-operator">=</span> <span class="hljs-string">'./Annotations/'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">imgpath <span class="hljs-operator">=</span> <span class="hljs-string">'./JPEGImages/'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">rotated_imgpath <span class="hljs-operator">=</span> <span class="hljs-string">'./motionblur/'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">rotated_xmlpath <span class="hljs-operator">=</span> <span class="hljs-string">'./xmlmotion/'</span> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> os.listdir(imgpath):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    a, b <span class="hljs-operator">=</span> os.path.splitext(i)                            </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        #img <span class="hljs-operator">=</span> cv<span class="hljs-number">2</span>.imread(imgpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'.jpg'</span>,<span class="hljs-number">0</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    img <span class="hljs-operator">=</span> cv<span class="hljs-number">2</span>.imread(imgpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'.bmp'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    w <span class="hljs-operator">=</span> img.shape[<span class="hljs-number">1</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    h <span class="hljs-operator">=</span> img.shape[<span class="hljs-number">0</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    UDFlipIm<span class="hljs-operator">=</span>cv<span class="hljs-number">2</span>.flip(img,<span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    cv<span class="hljs-number">2</span>.imwrite(rotated_imgpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'_flip'</span> <span class="hljs-operator">+</span><span class="hljs-string">'.bmp'</span>,UDFlipIm)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    tree <span class="hljs-operator">=</span> ET.parse(xmlpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'.xml'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    root <span class="hljs-operator">=</span> tree.getroot()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">for</span> <span class="hljs-keyword">file</span><span class="hljs-number">1</span> <span class="hljs-keyword">in</span> root.findall(<span class="hljs-string">'filename'</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            #filename<span class="hljs-operator">=</span>str(<span class="hljs-keyword">file</span><span class="hljs-number">1</span>.find(<span class="hljs-string">'filename'</span>).text)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">file</span><span class="hljs-number">1</span>.text <span class="hljs-operator">=</span> str(a <span class="hljs-operator">+</span> <span class="hljs-string">'_flip'</span><span class="hljs-operator">+</span><span class="hljs-string">'.bmp'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">for</span> box <span class="hljs-keyword">in</span> root.iter(<span class="hljs-string">'bndbox'</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            xmin <span class="hljs-operator">=</span> int(box.find(<span class="hljs-string">'xmin'</span>).text)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            ymin <span class="hljs-operator">=</span> int(box.find(<span class="hljs-string">'ymin'</span>).text)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            xmax <span class="hljs-operator">=</span> int(box.find(<span class="hljs-string">'xmax'</span>).text)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="50"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            ymax <span class="hljs-operator">=</span> int(box.find(<span class="hljs-string">'ymax'</span>).text)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="51"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            NewXmin, NewYmin, NewXmax, NewYmax <span class="hljs-operator">=</span> GetUDFlipLoc(h, xmin, ymin, xmax, ymax)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="52"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            box.find(<span class="hljs-string">'xmin'</span>).text <span class="hljs-operator">=</span> str(NewXmin)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="53"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            box.find(<span class="hljs-string">'ymin'</span>).text <span class="hljs-operator">=</span> str(NewYmin)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="54"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            box.find(<span class="hljs-string">'xmax'</span>).text <span class="hljs-operator">=</span> str(NewXmax)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="55"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            box.find(<span class="hljs-string">'ymax'</span>).text <span class="hljs-operator">=</span> str(NewYmax)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="56"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        #cv<span class="hljs-number">2</span>.imwrite(<span class="hljs-string">"E:/test/VOC07/3/"</span> <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">"_"</span> <span class="hljs-operator">+</span> str(angle) <span class="hljs-operator">+</span><span class="hljs-string">".jpg"</span>,rotated_img)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="57"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        tree.<span class="hljs-keyword">write</span>(rotated_xmlpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'_flip'</span> <span class="hljs-operator">+</span><span class="hljs-string">'.xml'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="58"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        print (str(a) <span class="hljs-operator">+</span> <span class="hljs-string">'.xml has been flip for '</span><span class="hljs-operator">+</span> <span class="hljs-string">'_flip'</span><span class="hljs-operator">+</span><span class="hljs-string">'°'</span>)</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h3 id="2.5%20%E4%BB%BB%E6%84%8F%E8%A7%92%E5%BA%A6%E6%97%8B%E8%BD%AC%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%BC%BA"><a name="t9"></a>2.5 任意角度旋转数据增强</h3> 
<pre data-index="4" class="set-code-hide" name="code"><code class="hljs language-cobol"><ol class="hljs-ln hundred" style="width:1281px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># -<span class="hljs-operator">*</span>- coding: utf-<span class="hljs-number">8</span> -<span class="hljs-operator">*</span>-</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">""</span><span class="hljs-string"><span class="hljs-string">"</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">Created on Sun Apr 08 18:27:53 2018</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string"></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">@author: AI&amp;CV</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-string">"</span><span class="hljs-string">""</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import cv<span class="hljs-number">2</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import math</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import numpy <span class="hljs-keyword">as</span> np</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import xml.etree.ElementTree <span class="hljs-keyword">as</span> ET</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import os</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">def rotate_image(src, angle, scale<span class="hljs-operator">=</span><span class="hljs-number">1</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    w <span class="hljs-operator">=</span> src.shape[<span class="hljs-number">1</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    h <span class="hljs-operator">=</span> src.shape[<span class="hljs-number">0</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # 角度变弧度</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    rangle <span class="hljs-operator">=</span> np.deg<span class="hljs-number">2</span>rad(angle)  # angle <span class="hljs-keyword">in</span> radians</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # now calculate new image width <span class="hljs-keyword">and</span> height</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    nw <span class="hljs-operator">=</span> (abs(np.sin(rangle) <span class="hljs-operator">*</span> h) <span class="hljs-operator">+</span> abs(np.cos(rangle) <span class="hljs-operator">*</span> w)) <span class="hljs-operator">*</span> scale</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    nh <span class="hljs-operator">=</span> (abs(np.cos(rangle) <span class="hljs-operator">*</span> h) <span class="hljs-operator">+</span> abs(np.sin(rangle) <span class="hljs-operator">*</span> w)) <span class="hljs-operator">*</span> scale</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # ask OpenCV <span class="hljs-keyword">for</span> the rotation matrix</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    rot_mat <span class="hljs-operator">=</span> cv<span class="hljs-number">2</span>.getRotationMatrix<span class="hljs-number">2</span>D((nw <span class="hljs-operator">*</span> <span class="hljs-number">0.5</span>, nh <span class="hljs-operator">*</span> <span class="hljs-number">0.5</span>), angle, scale)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # calculate the <span class="hljs-keyword">move</span> <span class="hljs-keyword">from</span> the old center <span class="hljs-keyword">to</span> the new center combined</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # <span class="hljs-keyword">with</span> the rotation</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    rot_<span class="hljs-keyword">move</span> <span class="hljs-operator">=</span> np.dot(rot_mat, np.array([(nw<span class="hljs-operator"> - </span>w) <span class="hljs-operator">*</span> <span class="hljs-number">0.5</span>, (nh<span class="hljs-operator"> - </span>h) <span class="hljs-operator">*</span> <span class="hljs-number">0.5</span>, <span class="hljs-number">0</span>]))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # the <span class="hljs-keyword">move</span> only affects the translation, so update the translation</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # part <span class="hljs-keyword">of</span> the transform</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    rot_mat[<span class="hljs-number">0</span>, <span class="hljs-number">2</span>] <span class="hljs-operator">+</span><span class="hljs-operator">=</span> rot_<span class="hljs-keyword">move</span>[<span class="hljs-number">0</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    rot_mat[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>] <span class="hljs-operator">+</span><span class="hljs-operator">=</span> rot_<span class="hljs-keyword">move</span>[<span class="hljs-number">1</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    dst <span class="hljs-operator">=</span> cv<span class="hljs-number">2</span>.warpAffine(src, rot_mat, (int(math.ceil(nw)), int(math.ceil(nh))), flags<span class="hljs-operator">=</span>cv<span class="hljs-number">2</span>.INTER_LANCZOS<span class="hljs-number">4</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # 仿射变换</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> dst</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># 对应修改xml文件</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">def rotate_xml(src, xmin, ymin, xmax, ymax, angle, scale<span class="hljs-operator">=</span><span class="hljs-number">1</span>.):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    w <span class="hljs-operator">=</span> src.shape[<span class="hljs-number">1</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    h <span class="hljs-operator">=</span> src.shape[<span class="hljs-number">0</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    rangle <span class="hljs-operator">=</span> np.deg<span class="hljs-number">2</span>rad(angle)  # angle <span class="hljs-keyword">in</span> radians</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # now calculate new image width <span class="hljs-keyword">and</span> height</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # 获取旋转后图像的长和宽</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    nw <span class="hljs-operator">=</span> (abs(np.sin(rangle)<span class="hljs-operator">*</span>h) <span class="hljs-operator">+</span> abs(np.cos(rangle)<span class="hljs-operator">*</span>w))<span class="hljs-operator">*</span>scale</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    nh <span class="hljs-operator">=</span> (abs(np.cos(rangle)<span class="hljs-operator">*</span>h) <span class="hljs-operator">+</span> abs(np.sin(rangle)<span class="hljs-operator">*</span>w))<span class="hljs-operator">*</span>scale</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # ask OpenCV <span class="hljs-keyword">for</span> the rotation matrix</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    rot_mat <span class="hljs-operator">=</span> cv<span class="hljs-number">2</span>.getRotationMatrix<span class="hljs-number">2</span>D((nw<span class="hljs-operator">*</span><span class="hljs-number">0.5</span>, nh<span class="hljs-operator">*</span><span class="hljs-number">0.5</span>), angle, scale)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # calculate the <span class="hljs-keyword">move</span> <span class="hljs-keyword">from</span> the old center <span class="hljs-keyword">to</span> the new center combined</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # <span class="hljs-keyword">with</span> the rotation</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    rot_<span class="hljs-keyword">move</span> <span class="hljs-operator">=</span> np.dot(rot_mat, np.array([(nw-w)<span class="hljs-operator">*</span><span class="hljs-number">0.5</span>, (nh-h)<span class="hljs-operator">*</span><span class="hljs-number">0.5,0</span>]))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="50"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # the <span class="hljs-keyword">move</span> only affects the translation, so update the translation</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="51"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # part <span class="hljs-keyword">of</span> the transform</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="52"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    rot_mat[<span class="hljs-number">0</span>, <span class="hljs-number">2</span>] <span class="hljs-operator">+</span><span class="hljs-operator">=</span> rot_<span class="hljs-keyword">move</span>[<span class="hljs-number">0</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="53"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    rot_mat[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>] <span class="hljs-operator">+</span><span class="hljs-operator">=</span> rot_<span class="hljs-keyword">move</span>[<span class="hljs-number">1</span>]                                   # rot_mat是最终的旋转矩阵</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="54"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # point<span class="hljs-number">1</span> <span class="hljs-operator">=</span> np.dot(rot_mat, np.array([xmin, ymin, <span class="hljs-number">1</span>]))          #这种新画出的框大一圈</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="55"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # point<span class="hljs-number">2</span> <span class="hljs-operator">=</span> np.dot(rot_mat, np.array([xmax, ymin, <span class="hljs-number">1</span>]))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="56"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # point<span class="hljs-number">3</span> <span class="hljs-operator">=</span> np.dot(rot_mat, np.array([xmax, ymax, <span class="hljs-number">1</span>]))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="57"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # point<span class="hljs-number">4</span> <span class="hljs-operator">=</span> np.dot(rot_mat, np.array([xmin, ymax, <span class="hljs-number">1</span>]))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="58"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    point<span class="hljs-number">1</span> <span class="hljs-operator">=</span> np.dot(rot_mat, np.array([(xmin<span class="hljs-operator">+</span>xmax)<span class="hljs-operator">/</span><span class="hljs-number">2</span>, ymin, <span class="hljs-number">1</span>]))   # 获取原始矩形的四个中点，然后将这四个点转换到旋转后的坐标系下</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="59"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    point<span class="hljs-number">2</span> <span class="hljs-operator">=</span> np.dot(rot_mat, np.array([xmax, (ymin<span class="hljs-operator">+</span>ymax)<span class="hljs-operator">/</span><span class="hljs-number">2</span>, <span class="hljs-number">1</span>]))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="60"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    point<span class="hljs-number">3</span> <span class="hljs-operator">=</span> np.dot(rot_mat, np.array([(xmin<span class="hljs-operator">+</span>xmax)<span class="hljs-operator">/</span><span class="hljs-number">2</span>, ymax, <span class="hljs-number">1</span>]))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="61"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    point<span class="hljs-number">4</span> <span class="hljs-operator">=</span> np.dot(rot_mat, np.array([xmin, (ymin<span class="hljs-operator">+</span>ymax)<span class="hljs-operator">/</span><span class="hljs-number">2</span>, <span class="hljs-number">1</span>]))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="62"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    concat <span class="hljs-operator">=</span> np.vstack((point<span class="hljs-number">1</span>, point<span class="hljs-number">2</span>, point<span class="hljs-number">3</span>, point<span class="hljs-number">4</span>))            # 合并np.array</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="63"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    # 改变array类型</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="64"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    concat <span class="hljs-operator">=</span> concat.astype(np.int<span class="hljs-number">32</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="65"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    rx, ry, rw, <span class="hljs-keyword">rh</span> <span class="hljs-operator">=</span> cv<span class="hljs-number">2</span>.boundingRect(concat)                        #rx,ry,为新的外接框左上角坐标，rw为框宽度，<span class="hljs-keyword">rh</span>为高度，新的xmax<span class="hljs-operator">=</span>rx<span class="hljs-operator">+</span>rw,新的ymax<span class="hljs-operator">=</span>ry<span class="hljs-operator">+</span><span class="hljs-keyword">rh</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="66"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> rx, ry, rw, <span class="hljs-keyword">rh</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="67"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="68"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># 使图像旋转<span class="hljs-number">60,90,120,150,210,240,300</span>度</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="69"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="70"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">xmlpath <span class="hljs-operator">=</span> <span class="hljs-string">'./Annotations/'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="71"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">imgpath <span class="hljs-operator">=</span> <span class="hljs-string">'./JPEGImages/'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="72"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">rotated_imgpath <span class="hljs-operator">=</span> <span class="hljs-string">'./rotate/'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="73"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">rotated_xmlpath <span class="hljs-operator">=</span> <span class="hljs-string">'./rotatexml/'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="74"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">#<span class="hljs-keyword">for</span> angle <span class="hljs-keyword">in</span> (<span class="hljs-number">90,270</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="75"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">for</span> angle <span class="hljs-keyword">in</span> (<span class="hljs-number">5,10</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="76"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> os.listdir(imgpath):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="77"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        a, b <span class="hljs-operator">=</span> os.path.splitext(i)                            #分离出文件名a</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="78"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        #img <span class="hljs-operator">=</span> cv<span class="hljs-number">2</span>.imread(imgpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'.jpg'</span>,<span class="hljs-number">0</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="79"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        img <span class="hljs-operator">=</span> cv<span class="hljs-number">2</span>.imread(imgpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'.jpg'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="80"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        rotated_img <span class="hljs-operator">=</span> rotate_image(img,angle)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="81"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        cv<span class="hljs-number">2</span>.imwrite(rotated_imgpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'_'</span><span class="hljs-operator">+</span> str(angle) <span class="hljs-operator">+</span><span class="hljs-string">'.jpg'</span>,rotated_img)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="82"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        #print str(i) <span class="hljs-operator">+</span> <span class="hljs-string">' has been rotated for '</span><span class="hljs-operator">+</span> str(angle)<span class="hljs-operator">+</span><span class="hljs-string">'°'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="83"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        tree <span class="hljs-operator">=</span> ET.parse(xmlpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'.xml'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="84"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        root <span class="hljs-operator">=</span> tree.getroot()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="85"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="86"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">for</span> <span class="hljs-keyword">file</span><span class="hljs-number">1</span> <span class="hljs-keyword">in</span> root.findall(<span class="hljs-string">'filename'</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="87"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            #filename<span class="hljs-operator">=</span>str(<span class="hljs-keyword">file</span><span class="hljs-number">1</span>.find(<span class="hljs-string">'filename'</span>).text)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="88"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">file</span><span class="hljs-number">1</span>.text <span class="hljs-operator">=</span> str(a <span class="hljs-operator">+</span> <span class="hljs-string">'_'</span><span class="hljs-operator">+</span> str(angle)<span class="hljs-operator">+</span><span class="hljs-string">'.jpg'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="89"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="90"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">for</span> box <span class="hljs-keyword">in</span> root.iter(<span class="hljs-string">'bndbox'</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="91"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            xmin <span class="hljs-operator">=</span> float(box.find(<span class="hljs-string">'xmin'</span>).text)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="92"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            ymin <span class="hljs-operator">=</span> float(box.find(<span class="hljs-string">'ymin'</span>).text)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="93"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            xmax <span class="hljs-operator">=</span> float(box.find(<span class="hljs-string">'xmax'</span>).text)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="94"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            ymax <span class="hljs-operator">=</span> float(box.find(<span class="hljs-string">'ymax'</span>).text)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="95"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            x, y, w, h <span class="hljs-operator">=</span> rotate_xml(img, xmin, ymin, xmax, ymax, angle)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="96"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            cv<span class="hljs-number">2</span>.rectangle(rotated_img, (x, y), (x<span class="hljs-operator">+</span>w, y<span class="hljs-operator">+</span>h), [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>], <span class="hljs-number">2</span>)   #可在该步骤测试新画的框位置是否正确</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="97"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            # cv<span class="hljs-number">2</span>.imshow(<span class="hljs-string">'xmlbnd'</span>,rotated_img)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="98"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            # cv<span class="hljs-number">2</span>.waitKey(<span class="hljs-number">200</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="99"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            box.find(<span class="hljs-string">'xmin'</span>).text <span class="hljs-operator">=</span> str(x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="100"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            box.find(<span class="hljs-string">'ymin'</span>).text <span class="hljs-operator">=</span> str(y)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="101"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            box.find(<span class="hljs-string">'xmax'</span>).text <span class="hljs-operator">=</span> str(x<span class="hljs-operator">+</span>w)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="102"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            box.find(<span class="hljs-string">'ymax'</span>).text <span class="hljs-operator">=</span> str(y<span class="hljs-operator">+</span>h)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="103"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        #cv<span class="hljs-number">2</span>.imwrite(<span class="hljs-string">"E:/test/VOC07/3/"</span> <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">"_"</span> <span class="hljs-operator">+</span> str(angle) <span class="hljs-operator">+</span><span class="hljs-string">".jpg"</span>,rotated_img)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="104"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        tree.<span class="hljs-keyword">write</span>(rotated_xmlpath <span class="hljs-operator">+</span> a <span class="hljs-operator">+</span> <span class="hljs-string">'_'</span><span class="hljs-operator">+</span> str(angle) <span class="hljs-operator">+</span><span class="hljs-string">'.xml'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="105"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        print (str(a) <span class="hljs-operator">+</span> <span class="hljs-string">'.xml has been rotated for '</span><span class="hljs-operator">+</span> str(angle)<span class="hljs-operator">+</span><span class="hljs-string">'°'</span>)</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<p></p>
                </div><div data-report-view="{&quot;mod&quot;:&quot;1585297308_001&quot;,&quot;spm&quot;:&quot;1001.2101.3001.6548&quot;,&quot;dest&quot;:&quot;https://cv2023.blog.csdn.net/article/details/130896875&quot;,&quot;extend1&quot;:&quot;pc&quot;,&quot;ab&quot;:&quot;new&quot;}"><div></div></div>
        </div>