<div id="article_content" class="article_content clearfix">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/kdoc_html_views-1a98987dfd.css">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-dc4a025e85.css">
                <div id="content_views" class="htmledit_views">
                    <p>&nbsp;💡💡💡<strong>本文改进：<span style="color:#fe2c24;">SlideLoss_IOU，困难样本的困难程度（如小目标遮挡物）动态调整，创新度十足</span></strong></p> 
<p><span style="color:#a2e043;"><strong>SlideLoss_IOU | &nbsp; 亲测在多个数据集能够实现涨点，对小目标、遮挡物性能提升也能够助力涨点。</strong></span></p> 
<p>🚀🚀🚀<strong>YOLOv8改进专栏：</strong><a href="http://t.csdnimg.cn/hGhVK" title="http://t.csdnimg.cn/hGhVK">http://t.csdnimg.cn/hGhVK</a></p> 
<p>💡💡💡Yolov8魔术师，独家首发创新（原创），适用于Yolov5、Yolov7、Yolov8等各个Yolo系列，专栏文章提供每一步步骤和源码，轻松带你上手魔改网络</p> 
<p>💡💡💡重点：通过本专栏的阅读，后续你也可以自己魔改网络，在网络不同位置（Backbone、head、detect、loss等）进行魔改，实现创新！！！</p> 
<p>专栏介绍：</p> 
<p>https://blog.csdn.net/m0_63774211/category_12289773.html</p> 
<p>✨✨✨原创魔改网络、复现前沿论文，组合优化创新</p> 
<p>🚀🚀🚀小目标、遮挡物、难样本性能提升</p> 
<p>🍉🍉🍉持续更新中，定期更新不同<a href="https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E9%9B%86&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E9%9B%86&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;数据集\&quot;}&quot;}" data-tit="数据集" data-pretit="数据集">数据集</a>涨点情况</p> 
<p></p> 
<h2 id="1.SlideLoss%E4%BB%8B%E7%BB%8D"><a name="t0"></a>1.SlideLoss介绍</h2> 
<p><img alt="" height="520" src="https://img-blog.csdnimg.cn/1ff53ff05f604dea9611295046959da5.png" width="1200">&nbsp;论文：<a href="https://arxiv.org/pdf/2208.02019.pdf" title="https://arxiv.org/pdf/2208.02019.pdf">https://arxiv.org/pdf/2208.02019.pdf</a></p> 
<p></p> 
<p><img alt="" height="171" src="https://img-blog.csdnimg.cn/c0033f9f24db4159883bd09e5792c6ab.png" width="927"></p> 
<p>图 4：我们提出了一种新的损失，称为“滑动损失”，它自适应地学习正样本阈值参数和负样本阈值参数 µ。 在 µ 附近设置较高的权重会增加难分类示例的相对损失，从而将更多注意力集中在难分类的错误示例上。&nbsp;</p> 
<p><img alt="" height="523" src="https://img-blog.csdnimg.cn/9f3890562c1248eaacec099664fdefe3.png" width="931"></p> 
<p>Slide损失函数的主要目的是让模型更加关注难样本。根据表格第五行的结果，Slide函数提升主要在中、难任务上。</p> 
<p><img alt="" height="372" src="https://img-blog.csdnimg.cn/6d1baf2de5414d16a7e3a594a900422b.png" width="927"></p> 
<h3><a name="t1"></a>1.1&nbsp;<strong><span style="color:#fe2c24;">SlideLoss_IOU</span></strong></h3> 
<p><span style="color:#fe2c24;"><strong>跟进iou自动调节loss</strong></span></p> 
<p>&nbsp;<img alt="" height="229" src="https://img-blog.csdnimg.cn/df514605d74947989c2552959e345692.png" width="487"></p> 
<h2 id="%C2%A02.%C2%A0Slideloss%E5%8A%A0%E5%85%A5yolov5"><a name="t2"></a>&nbsp;2.&nbsp;<strong><span style="color:#fe2c24;">SlideLoss_IOU</span></strong>加入YOLOV8</h2> 
<h3 id="2.1%20%E4%BF%AE%E6%94%B9loss.py"><a name="t3"></a>2.1 修改ultralytics/utils/loss.py</h3> 
<p>加入<strong><span style="color:#fe2c24;">SlideLoss_IOU</span></strong></p> 
<pre data-index="0" class="set-code-hide" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import math</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">class</span> SlideLoss_IOU(nn.Module):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def __init__(<span class="hljs-keyword">self</span>, loss_fcn, decay<span class="hljs-operator">=</span><span class="hljs-number">0.999</span>, tau<span class="hljs-operator">=</span><span class="hljs-number">2000</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">super</span>(SlideLoss_IOU, <span class="hljs-keyword">self</span>).__init__()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.loss_fcn <span class="hljs-operator">=</span> loss_fcn</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.reduction <span class="hljs-operator">=</span> loss_fcn.reduction</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.loss_fcn.reduction <span class="hljs-operator">=</span> <span class="hljs-string">'none'</span>  # required <span class="hljs-keyword">to</span> apply SL <span class="hljs-keyword">to</span> each element</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.decay <span class="hljs-operator">=</span> lambda x: decay <span class="hljs-operator">*</span> (<span class="hljs-number">1</span><span class="hljs-operator"> - </span>math.exp(-x <span class="hljs-operator">/</span> tau))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.<span class="hljs-keyword">is</span>_train <span class="hljs-operator">=</span> <span class="hljs-keyword">True</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.updates <span class="hljs-operator">=</span> <span class="hljs-number">0</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.iou_mean <span class="hljs-operator">=</span> <span class="hljs-number">1.0</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def __<span class="hljs-keyword">call</span>__(<span class="hljs-keyword">self</span>, pred, <span class="hljs-keyword">true</span>, auto_iou<span class="hljs-operator">=</span><span class="hljs-number">0.5</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.<span class="hljs-keyword">is</span>_train <span class="hljs-keyword">and</span> auto_iou !<span class="hljs-operator">=</span> -<span class="hljs-number">1</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.updates <span class="hljs-operator">+</span><span class="hljs-operator">=</span> <span class="hljs-number">1</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            d <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.decay(<span class="hljs-keyword">self</span>.updates)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.iou_mean <span class="hljs-operator">=</span> d <span class="hljs-operator">*</span> <span class="hljs-keyword">self</span>.iou_mean <span class="hljs-operator">+</span> (<span class="hljs-number">1</span><span class="hljs-operator"> - </span>d) <span class="hljs-operator">*</span> float(auto_iou.detach())</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        auto_iou <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.iou_mean</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        loss <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.loss_fcn(pred, <span class="hljs-keyword">true</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> auto_iou <span class="hljs-operator">&lt;</span> <span class="hljs-number">0.2</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            auto_iou <span class="hljs-operator">=</span> <span class="hljs-number">0.2</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        b<span class="hljs-number">1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">true</span> <span class="hljs-operator">&lt;=</span> auto_iou<span class="hljs-operator"> - </span><span class="hljs-number">0.1</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        a<span class="hljs-number">1</span> <span class="hljs-operator">=</span> <span class="hljs-number">1.0</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        b<span class="hljs-number">2</span> <span class="hljs-operator">=</span> (<span class="hljs-keyword">true</span> <span class="hljs-operator">&gt;</span> (auto_iou<span class="hljs-operator"> - </span><span class="hljs-number">0.1</span>)) <span class="hljs-operator">&amp;</span> (<span class="hljs-keyword">true</span> <span class="hljs-operator">&lt;</span> auto_iou)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        a<span class="hljs-number">2</span> <span class="hljs-operator">=</span> math.exp(<span class="hljs-number">1.0</span><span class="hljs-operator"> - </span>auto_iou)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        b<span class="hljs-number">3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">true</span> <span class="hljs-operator">&gt;=</span> auto_iou</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        a<span class="hljs-number">3</span> <span class="hljs-operator">=</span> torch.exp(-(<span class="hljs-keyword">true</span><span class="hljs-operator"> - </span><span class="hljs-number">1.0</span>))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        modulating_weight <span class="hljs-operator">=</span> a<span class="hljs-number">1</span> <span class="hljs-operator">*</span> b<span class="hljs-number">1</span> <span class="hljs-operator">+</span> a<span class="hljs-number">2</span> <span class="hljs-operator">*</span> b<span class="hljs-number">2</span> <span class="hljs-operator">+</span> a<span class="hljs-number">3</span> <span class="hljs-operator">*</span> b<span class="hljs-number">3</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        loss <span class="hljs-operator">*</span><span class="hljs-operator">=</span> modulating_weight</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.reduction <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-string">'mean'</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">return</span> loss.mean()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        elif <span class="hljs-keyword">self</span>.reduction <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-string">'sum'</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">return</span> loss.<span class="hljs-keyword">sum</span>()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">else</span>:  # <span class="hljs-string">'none'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">return</span> loss</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreBlack.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<p>修改class v8DetectionLoss:函数</p> 
<p><strong>1）第一处修改</strong></p> 
<p>原始</p> 
<pre data-index="1" class="set-code-show" name="code"><code class="hljs language-cobol"><span class="hljs-keyword">self</span>.bce <span class="hljs-operator">=</span> nn.BCEWithLogitsLoss(reduction<span class="hljs-operator">=</span><span class="hljs-string">'none'</span>)</code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<p>修改为</p> 
<pre data-index="2" class="set-code-show" name="code"><code class="hljs language-cobol"><span class="hljs-keyword">self</span>.bce <span class="hljs-operator">=</span> SlideLoss_IOU(nn.BCEWithLogitsLoss(reduction<span class="hljs-operator">=</span><span class="hljs-string">'none'</span>))  # SlideLoss_IOU Loss</code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<p><strong>2）第二处修改</strong></p> 
<p>&nbsp;原始</p> 
<pre data-index="3" class="set-code-show" name="code"><code class="hljs language-cobol">loss[<span class="hljs-number">1</span>] <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.bce(pred_scores, target_scores.<span class="hljs-keyword">to</span>(dtype)).<span class="hljs-keyword">sum</span>() <span class="hljs-operator">/</span> target_scores_<span class="hljs-keyword">sum</span>  # BCE</code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<p>修改为：</p> 
<pre data-index="4" class="set-code-show" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:976px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        auto_iou <span class="hljs-operator">=</span> bbox_iou(pred_bboxes[fg_mask], target_bboxes[fg_mask], xywh<span class="hljs-operator">=</span><span class="hljs-keyword">False</span>, CIoU<span class="hljs-operator">=</span><span class="hljs-keyword">True</span>).mean()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        loss[<span class="hljs-number">1</span>] <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.bce(pred_scores, target_scores.<span class="hljs-keyword">to</span>(dtype), auto_iou).<span class="hljs-keyword">sum</span>() <span class="hljs-operator">/</span> target_scores_<span class="hljs-keyword">sum</span>  # BCE</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h2><a name="t4"></a>3.报错解决</h2> 
<p>若存在如下报错：</p> 
<p></p> 
<p>修改Lib/site-packages/torch/serialization.py</p> 
<p>原始</p> 
<pre data-index="5" class="set-code-show" name="code"><code class="hljs language-haskell"><span class="hljs-keyword">import</span> pickle</code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<p>修改为：</p> 
<pre data-index="6" class="set-code-show" name="code"><code class="hljs language-haskell"><span class="hljs-keyword">import</span> dill <span class="hljs-keyword">as</span> pickle</code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<p>dill 安装方法</p> 
<pre data-index="7" class="set-code-show" name="code"><code class="hljs language-undefined">pip install  dill</code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<p></p>
                </div><div data-report-view="{&quot;mod&quot;:&quot;1585297308_001&quot;,&quot;spm&quot;:&quot;1001.2101.3001.6548&quot;,&quot;dest&quot;:&quot;https://cv2023.blog.csdn.net/article/details/133973491&quot;,&quot;extend1&quot;:&quot;pc&quot;,&quot;ab&quot;:&quot;new&quot;}"><div></div></div>
        </div>