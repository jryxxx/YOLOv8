<div id="article_content" class="article_content clearfix">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/kdoc_html_views-1a98987dfd.css">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-dc4a025e85.css">
                <div id="content_views" class="htmledit_views">
                    <p>&nbsp;ğŸ’¡ğŸ’¡ğŸ’¡<span style="color:#fe2c24;"><strong>æœ¬æ–‡ç‹¬å®¶åŸåˆ›æ”¹è¿›</strong></span>ï¼šè½»é‡çº§ <a href="https://so.csdn.net/so/search?q=ViT&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=ViT&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;ViT\&quot;}&quot;}" data-tit="ViT" data-pretit="vit">ViT</a> çš„é«˜æ•ˆæ¶æ„é€‰æ‹©ï¼Œé€æ­¥å¢å¼ºæ ‡å‡†è½»é‡çº§ CNNï¼ˆç‰¹åˆ«æ˜¯ MobileNetV3ï¼‰çš„ç§»åŠ¨å‹å¥½æ€§ã€‚ æœ€ç»ˆäº§ç”Ÿäº†<span style="color:#956fe7;">ä¸€ä¸ªæ–°çš„çº¯è½»é‡çº§ CNN ç³»åˆ—ï¼Œå³ RepViT</span></p> 
<p><span style="color:#a2e043;">RepViTBlockå³æ’å³ç”¨ï¼ŒåŠ©åŠ›æ£€æµ‹ | &nbsp; äº²æµ‹åœ¨å¤šä¸ªæ•°æ®é›†èƒ½å¤Ÿå®ç°æ¶¨ç‚¹ï¼Œå¹¶å®ç°è½»é‡åŒ–</span></p> 
<p>ğŸ’¡ğŸ’¡ğŸ’¡<span style="color:#ff9900;"><strong>Yolov8é­”æœ¯å¸ˆ</strong></span>ï¼Œç‹¬å®¶é¦–å‘åˆ›æ–°ï¼ˆåŸåˆ›ï¼‰ï¼Œé€‚ç”¨äºYolov5ã€Yolov7ã€Yolov8ç­‰å„ä¸ªYoloç³»åˆ—ï¼Œä¸“æ æ–‡ç« æä¾›æ¯ä¸€æ­¥æ­¥éª¤å’Œæºç ï¼Œè½»æ¾å¸¦ä½ ä¸Šæ‰‹é­”æ”¹ç½‘ç»œ</p> 
<p>ğŸ’¡ğŸ’¡ğŸ’¡<span style="color:#4da8ee;">é‡ç‚¹ï¼šé€šè¿‡æœ¬ä¸“æ çš„é˜…è¯»ï¼Œåç»­ä½ ä¹Ÿå¯ä»¥è‡ªå·±é­”æ”¹ç½‘ç»œï¼Œåœ¨ç½‘ç»œä¸åŒä½ç½®ï¼ˆBackboneã€headã€detectã€lossç­‰ï¼‰è¿›è¡Œé­”æ”¹ï¼Œå®ç°åˆ›æ–°ï¼ï¼ï¼</span></p> 
<p><span style="color:#fe2c24;"><strong>ä¸“æ ä»‹ç»ï¼š</strong></span></p> 
<p><a href="https://blog.csdn.net/m0_63774211/category_12289773.html" title="https://blog.csdn.net/m0_63774211/category_12289773.html">https://blog.csdn.net/m0_63774211/category_12289773.html</a></p> 
<p>âœ¨âœ¨âœ¨<span style="color:#38d8f0;">åŸåˆ›é­”æ”¹ç½‘ç»œã€å¤ç°å‰æ²¿è®ºæ–‡ï¼Œç»„åˆä¼˜åŒ–åˆ›æ–°</span></p> 
<p>ğŸš€ğŸš€ğŸš€<span style="color:#4da8ee;">å°ç›®æ ‡ã€é®æŒ¡ç‰©ã€éš¾æ ·æœ¬æ€§èƒ½æå‡</span></p> 
<p>ğŸ‰ğŸ‰ğŸ‰<span style="color:#956fe7;">æŒç»­æ›´æ–°ä¸­ï¼Œå®šæœŸæ›´æ–°ä¸åŒæ•°æ®é›†æ¶¨ç‚¹æƒ…å†µ</span></p> 
<p id="main-toc"><strong>ç›®å½•</strong></p> 
<p id="" style="margin: 0px 0px 2px; padding-left: 24px;"><a href="#t0" target="_self">1.&nbsp;RepViTä»‹ç»</a></p> 
<p id="" style="margin: 0px 0px 2px; padding-left: 24px;"><a href="#t1" target="_self">2.åŸºäºYolov8çš„RepViTBlockå®ç°</a></p> 
<p id="" style="margin: 0px 0px 2px 48px; padding-left: 24px;"><a href="#t2" target="_self">2.1 åŠ å…¥ultralytics/nn/backbone/repvit.py</a></p> 
<p id="" style="margin: 0px 0px 2px 48px; padding-left: 24px;"><a href="#t3" target="_self">2.2&nbsp;&nbsp;tasks.pyæ³¨å†Œ</a></p> 
<p id="" style="margin: 0px 0px 2px 48px; padding-left: 24px;"><a href="#t4" target="_self">2.3&nbsp;yolov8_RepViTBlock.yaml</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="1.%C2%A0RepViT%E4%BB%8B%E7%BB%8D"><a name="t0"></a>1.&nbsp;<code>RepViTä»‹ç»</code></h2> 
<p><img alt="" height="308" src="https://img-blog.csdnimg.cn/3d5f05d68e604a6c8e83beb7f09c9869.png" width="1200"></p> 
<p>è®ºæ–‡ï¼š<a href="https://arxiv.org/pdf/2307.09283.pdf" title="https://arxiv.org/pdf/2307.09283.pdf">https://arxiv.org/pdf/2307.09283.pdf</a>&nbsp;</p> 
<p>é‡ç‚¹æ¢è®¨äº†åœ¨èµ„æºæœ‰é™çš„ç§»åŠ¨è®¾å¤‡ä¸Šï¼Œé€šè¿‡é‡æ–°å®¡è§†<a href="https://so.csdn.net/so/search?q=%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;è½»é‡çº§å·ç§¯ç¥ç»ç½‘ç»œ\&quot;}&quot;}" data-tit="è½»é‡çº§å·ç§¯ç¥ç»ç½‘ç»œ" data-pretit="è½»é‡çº§å·ç§¯ç¥ç»ç½‘ç»œ">è½»é‡çº§å·ç§¯ç¥ç»ç½‘ç»œ</a>çš„è®¾è®¡ï¼Œå¹¶æ•´åˆè½»é‡çº§&nbsp;<code>ViTs</code>&nbsp;çš„æœ‰æ•ˆæ¶æ„é€‰æ‹©ï¼Œæ¥æå‡è½»é‡çº§&nbsp;<code>CNNs</code>&nbsp;çš„æ€§èƒ½ã€‚&nbsp;</p> 
<p>æœ¬æ–‡è´¡çŒ®ï¼š</p> 
<ol><li>æ–‡ä¸­æåˆ°ï¼Œè½»é‡çº§ ViTs é€šå¸¸æ¯”è½»é‡çº§ CNNs åœ¨è§†è§‰ä»»åŠ¡ä¸Šè¡¨ç°å¾—æ›´å¥½ï¼Œè¿™ä¸»è¦å½’åŠŸäºå®ƒä»¬çš„å¤šå¤´è‡ªæ³¨æ„åŠ›æ¨¡å—(<code>MSHA</code>)å¯ä»¥è®©æ¨¡å‹å­¦ä¹ <strong>å…¨å±€è¡¨ç¤º</strong>ã€‚ç„¶è€Œï¼Œè½»é‡çº§ ViTs å’Œè½»é‡çº§ CNNs ä¹‹é—´çš„æ¶æ„å·®å¼‚å°šæœªå¾—åˆ°å……åˆ†ç ”ç©¶ã€‚</li><li>åœ¨è¿™é¡¹ç ”ç©¶ä¸­ï¼Œä½œè€…ä»¬é€šè¿‡æ•´åˆè½»é‡çº§ ViTs çš„æœ‰æ•ˆæ¶æ„é€‰æ‹©ï¼Œé€æ­¥æå‡äº†æ ‡å‡†è½»é‡çº§ CNNï¼ˆç‰¹åˆ«æ˜¯&nbsp;<code>MobileNetV3</code>&nbsp;çš„ç§»åŠ¨å‹å¥½æ€§ã€‚è¿™ä¾¿è¡ç”Ÿå‡ºä¸€ä¸ªæ–°çš„çº¯è½»é‡çº§ CNN å®¶æ—çš„è¯ç”Ÿï¼Œå³<code>RepViT</code>ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡ RepViT å…·æœ‰ MetaFormer ç»“æ„ï¼Œä½†å®ƒå®Œå…¨ç”±å·ç§¯ç»„æˆã€‚</li><li>å®éªŒç»“æœè¡¨æ˜ï¼Œ<code>RepViT</code>&nbsp;è¶…è¶Šäº†ç°æœ‰çš„æœ€å…ˆè¿›çš„è½»é‡çº§ ViTsï¼Œå¹¶åœ¨å„ç§è§†è§‰ä»»åŠ¡ä¸Šæ˜¾ç¤ºå‡ºä¼˜äºç°æœ‰æœ€å…ˆè¿›è½»é‡çº§ViTsçš„æ€§èƒ½å’Œæ•ˆç‡ï¼ŒåŒ…æ‹¬ ImageNet åˆ†ç±»ã€COCO-2017 ä¸Šçš„ç›®æ ‡æ£€æµ‹å’Œå®ä¾‹åˆ†å‰²ï¼Œä»¥åŠ ADE20k ä¸Šçš„è¯­ä¹‰åˆ†å‰²ã€‚ç‰¹åˆ«åœ°ï¼Œåœ¨<code>ImageNet</code>ä¸Šï¼Œ<code>RepViT</code>&nbsp;åœ¨&nbsp;<code>iPhone 12</code>&nbsp;ä¸Šè¾¾åˆ°äº†è¿‘ä¹ 1ms çš„å»¶è¿Ÿå’Œè¶…è¿‡ 80% çš„Top-1 å‡†ç¡®ç‡ï¼Œè¿™æ˜¯è½»é‡çº§æ¨¡å‹çš„é¦–æ¬¡çªç ´ã€‚</li></ol> 
<p>&nbsp;<img alt="" height="659" src="https://img-blog.csdnimg.cn/d05f6a6a31dc440fb4b5760a3989740e.png" width="679"></p> 
<p>&nbsp;é€šè¿‡é›†æˆè½»é‡çº§ ViT çš„é«˜æ•ˆæ¶æ„é€‰æ‹©ï¼Œé€æ­¥å¢å¼ºæ ‡å‡†è½»é‡çº§ <a href="https://so.csdn.net/so/search?q=CNN&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=CNN&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;CNN\&quot;}&quot;}" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=CNN&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;CNN\&quot;}&quot;}" data-tit="CNN" data-pretit="cnn">CNN</a>ï¼ˆç‰¹åˆ«æ˜¯ MobileNetV3ï¼‰çš„ç§»åŠ¨å‹å¥½æ€§ã€‚ æœ€ç»ˆäº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„çº¯è½»é‡çº§ CNN ç³»åˆ—ï¼Œå³ RepViTã€‚<img alt="" height="718" src="https://img-blog.csdnimg.cn/7b3dacb9b81f435496eceb88ac7f5793.png" width="1200"></p> 
<p>&nbsp;RepViT é€šè¿‡é€å±‚å¾®è§‚è®¾è®¡æ¥è°ƒæ•´è½»é‡çº§ CNNï¼Œè¿™åŒ…æ‹¬é€‰æ‹©åˆé€‚çš„å·ç§¯æ ¸å¤§å°å’Œä¼˜åŒ–æŒ¤å‹-æ¿€åŠ±ï¼ˆSqueeze-and-excitationï¼Œç®€ç§°SEï¼‰å±‚çš„ä½ç½®ã€‚è¿™ä¸¤ç§æ–¹æ³•éƒ½èƒ½æ˜¾è‘—æ”¹å–„æ¨¡å‹æ€§èƒ½ã€‚</p> 
<p><img alt="" height="657" src="https://img-blog.csdnimg.cn/53c6f52184f1478f92ee543389fd21cd.png" width="643"></p> 
<p><strong>æµ…å±‚ç½‘ç»œä½¿ç”¨å·ç§¯æå–å™¨</strong>&nbsp;</p> 
<p><img alt="" height="547" src="https://img-blog.csdnimg.cn/3c98565d5d9547b98d8cf74eef7da774.png" width="795"></p> 
<p></p> 
<p>&nbsp;<img alt="" height="642" src="https://img-blog.csdnimg.cn/fa068f0d2db9467b9de036132622fbed.png" width="781"></p> 
<p><strong>æ›´æ·±çš„ä¸‹é‡‡æ ·å±‚ï¼Œ</strong>ä½œè€…ä»¬é¦–å…ˆä½¿ç”¨ä¸€ä¸ª 1x1 å·ç§¯æ¥è°ƒæ•´é€šé“ç»´åº¦ï¼Œç„¶åå°†ä¸¤ä¸ª 1x1 å·ç§¯çš„è¾“å…¥å’Œè¾“å‡ºé€šè¿‡æ®‹å·®è¿æ¥ï¼Œå½¢æˆä¸€ä¸ªå‰é¦ˆç½‘ç»œã€‚æ­¤å¤–ï¼Œä»–ä»¬è¿˜åœ¨å‰é¢å¢åŠ äº†ä¸€ä¸ª RepViT å—ä»¥è¿›ä¸€æ­¥åŠ æ·±ä¸‹é‡‡æ ·å±‚ï¼Œè¿™ä¸€æ­¥æé«˜äº† top-1 å‡†ç¡®ç‡åˆ° 75.4%ï¼ŒåŒæ—¶å»¶è¿Ÿä¸º 0.96msã€‚&nbsp;</p> 
<p><img alt="" height="556" src="https://img-blog.csdnimg.cn/156bf311655c41c388e6e0b47a42cbd2.png" width="797"></p> 
<p>&nbsp;æœ€ç»ˆï¼Œé€šè¿‡æ•´åˆä¸Šè¿°æ”¹è¿›ç­–ç•¥ï¼Œæˆ‘ä»¬ä¾¿å¾—åˆ°äº†æ¨¡å‹<code>RepViT</code>çš„æ•´ä½“æ¶æ„ï¼Œè¯¥æ¨¡å‹æœ‰å¤šä¸ªå˜ç§ï¼Œä¾‹å¦‚<code>RepViT-M1/M2/M3</code>ã€‚åŒæ ·åœ°ï¼Œä¸åŒçš„å˜ç§ä¸»è¦é€šè¿‡æ¯ä¸ªé˜¶æ®µçš„é€šé“æ•°å’Œå—æ•°æ¥åŒºåˆ†ã€‚</p> 
<p><img alt="" height="498" src="https://img-blog.csdnimg.cn/5f5477ca3ef04376bc1e11a35922c9df.png" width="581"></p> 
<h2 id="2.%E5%9F%BA%E4%BA%8EYolov8%E7%9A%84RepViTBlock%E5%AE%9E%E7%8E%B0"><a name="t1"></a>2.åŸºäºYolov8çš„RepViTBlockå®ç°</h2> 
<h3 id="2.1%20%E5%8A%A0%E5%85%A5ultralytics%2Fnn%2Fbackbone%2Frepvit.py"><a name="t2"></a>2.1 åŠ å…¥ultralytics/nn/<a href="https://so.csdn.net/so/search?q=backbone&amp;spm=1001.2101.3001.7020" title="backbone">backbone</a>/repvit.py</h3> 
<pre data-index="0" class="set-code-hide" name="code"><code class="hljs language-cobol"><ol class="hljs-ln hundred" style="width:1176px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import torch.nn <span class="hljs-keyword">as</span> nn</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import torch</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">from</span> timm.models.layers import SqueezeExcite</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">class</span> Conv<span class="hljs-number">2</span>d_BN(torch.nn.<span class="hljs-keyword">Sequential</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def __init__(<span class="hljs-keyword">self</span>, a, b, ks<span class="hljs-operator">=</span><span class="hljs-number">1</span>, stride<span class="hljs-operator">=</span><span class="hljs-number">1</span>, pad<span class="hljs-operator">=</span><span class="hljs-number">0</span>, dilation<span class="hljs-operator">=</span><span class="hljs-number">1</span>,</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                 groups<span class="hljs-operator">=</span><span class="hljs-number">1</span>, bn_weight_init<span class="hljs-operator">=</span><span class="hljs-number">1</span>, resolution<span class="hljs-operator">=</span>-<span class="hljs-number">10000</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">super</span>().__init__()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.<span class="hljs-keyword">add</span>_module(<span class="hljs-string">'c'</span>, torch.nn.Conv<span class="hljs-number">2</span>d(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            a, b, ks, stride, pad, dilation, groups, bias<span class="hljs-operator">=</span><span class="hljs-keyword">False</span>))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.<span class="hljs-keyword">add</span>_module(<span class="hljs-string">'bn'</span>, torch.nn.BatchNorm<span class="hljs-number">2</span>d(b))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        torch.nn.init.<span class="hljs-keyword">constant</span>_(<span class="hljs-keyword">self</span>.bn.weight, bn_weight_init)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        torch.nn.init.<span class="hljs-keyword">constant</span>_(<span class="hljs-keyword">self</span>.bn.bias, <span class="hljs-number">0</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    @torch.<span class="hljs-keyword">no</span>_grad()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def fuse(<span class="hljs-keyword">self</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        c, bn <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>._modules.<span class="hljs-keyword">values</span>()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        w <span class="hljs-operator">=</span> bn.weight <span class="hljs-operator">/</span> (bn.running_var <span class="hljs-operator">+</span> bn.eps)<span class="hljs-operator">**</span><span class="hljs-number">0.5</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        w <span class="hljs-operator">=</span> c.weight <span class="hljs-operator">*</span> w[:, None, None, None]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        b <span class="hljs-operator">=</span> bn.bias<span class="hljs-operator"> - </span>bn.running_mean <span class="hljs-operator">*</span> bn.weight <span class="hljs-operator">/</span> \</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            (bn.running_var <span class="hljs-operator">+</span> bn.eps)<span class="hljs-operator">**</span><span class="hljs-number">0.5</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        m <span class="hljs-operator">=</span> torch.nn.Conv<span class="hljs-number">2</span>d(w.<span class="hljs-keyword">size</span>(<span class="hljs-number">1</span>) <span class="hljs-operator">*</span> <span class="hljs-keyword">self</span>.c.groups, w.<span class="hljs-keyword">size</span>(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-number">0</span>), w.shape[<span class="hljs-number">2</span>:], stride<span class="hljs-operator">=</span><span class="hljs-keyword">self</span>.c.stride, padding<span class="hljs-operator">=</span><span class="hljs-keyword">self</span>.c.padding, dilation<span class="hljs-operator">=</span><span class="hljs-keyword">self</span>.c.dilation, groups<span class="hljs-operator">=</span><span class="hljs-keyword">self</span>.c.groups,</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            device<span class="hljs-operator">=</span>c.weight.device)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        m.weight.<span class="hljs-keyword">data</span>.<span class="hljs-keyword">copy</span>_(w)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        m.bias.<span class="hljs-keyword">data</span>.<span class="hljs-keyword">copy</span>_(b)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> m</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">class</span> Residual(torch.nn.Module):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def __init__(<span class="hljs-keyword">self</span>, m, drop<span class="hljs-operator">=</span><span class="hljs-number">0</span>.):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">super</span>().__init__()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.m <span class="hljs-operator">=</span> m</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.drop <span class="hljs-operator">=</span> drop</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def forward(<span class="hljs-keyword">self</span>, x):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.training <span class="hljs-keyword">and</span> <span class="hljs-keyword">self</span>.drop <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">return</span> x <span class="hljs-operator">+</span> <span class="hljs-keyword">self</span>.m(x) <span class="hljs-operator">*</span> torch.rand(x.<span class="hljs-keyword">size</span>(<span class="hljs-number">0</span>), <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>,</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                                              device<span class="hljs-operator">=</span>x.device).ge_(<span class="hljs-keyword">self</span>.drop).div(<span class="hljs-number">1</span><span class="hljs-operator"> - </span><span class="hljs-keyword">self</span>.drop).detach()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">else</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">return</span> x <span class="hljs-operator">+</span> <span class="hljs-keyword">self</span>.m(x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    @torch.<span class="hljs-keyword">no</span>_grad()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def fuse(<span class="hljs-keyword">self</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> isinstance(<span class="hljs-keyword">self</span>.m, Conv<span class="hljs-number">2</span>d_BN):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            m <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.m.fuse()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            assert(m.groups <span class="hljs-operator">=</span><span class="hljs-operator">=</span> m.<span class="hljs-keyword">in</span>_channels)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            identity <span class="hljs-operator">=</span> torch.ones(m.weight.shape[<span class="hljs-number">0</span>], m.weight.shape[<span class="hljs-number">1</span>], <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            identity <span class="hljs-operator">=</span> torch.nn.functional.pad(identity, [<span class="hljs-number">1,1,1,1</span>])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            m.weight <span class="hljs-operator">+</span><span class="hljs-operator">=</span> identity.<span class="hljs-keyword">to</span>(m.weight.device)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="50"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">return</span> m</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="51"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        elif isinstance(<span class="hljs-keyword">self</span>.m, torch.nn.Conv<span class="hljs-number">2</span>d):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="52"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            m <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.m</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="53"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            assert(m.groups !<span class="hljs-operator">=</span> m.<span class="hljs-keyword">in</span>_channels)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="54"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            identity <span class="hljs-operator">=</span> torch.ones(m.weight.shape[<span class="hljs-number">0</span>], m.weight.shape[<span class="hljs-number">1</span>], <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="55"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            identity <span class="hljs-operator">=</span> torch.nn.functional.pad(identity, [<span class="hljs-number">1,1,1,1</span>])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="56"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            m.weight <span class="hljs-operator">+</span><span class="hljs-operator">=</span> identity.<span class="hljs-keyword">to</span>(m.weight.device)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="57"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">return</span> m</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="58"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">else</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="59"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="60"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="61"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="62"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">class</span> RepVGGDW(torch.nn.Module):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="63"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def __init__(<span class="hljs-keyword">self</span>, ed) -<span class="hljs-operator">&gt;</span> None:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="64"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">super</span>().__init__()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="65"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.conv <span class="hljs-operator">=</span> Conv<span class="hljs-number">2</span>d_BN(ed, ed, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, groups<span class="hljs-operator">=</span>ed)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="66"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.conv<span class="hljs-number">1</span> <span class="hljs-operator">=</span> Conv<span class="hljs-number">2</span>d_BN(ed, ed, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, groups<span class="hljs-operator">=</span>ed)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="67"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.dim <span class="hljs-operator">=</span> ed</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="68"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="69"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def forward(<span class="hljs-keyword">self</span>, x):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="70"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.conv(x) <span class="hljs-operator">+</span> <span class="hljs-keyword">self</span>.conv<span class="hljs-number">1</span>(x) <span class="hljs-operator">+</span> x</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="71"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="72"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    @torch.<span class="hljs-keyword">no</span>_grad()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="73"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def fuse(<span class="hljs-keyword">self</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="74"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        conv <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.conv.fuse()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="75"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        conv<span class="hljs-number">1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.conv<span class="hljs-number">1</span>.fuse()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="76"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="77"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        conv_w <span class="hljs-operator">=</span> conv.weight</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="78"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        conv_b <span class="hljs-operator">=</span> conv.bias</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="79"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        conv<span class="hljs-number">1</span>_w <span class="hljs-operator">=</span> conv<span class="hljs-number">1</span>.weight</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="80"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        conv<span class="hljs-number">1</span>_b <span class="hljs-operator">=</span> conv<span class="hljs-number">1</span>.bias</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="81"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="82"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        conv<span class="hljs-number">1</span>_w <span class="hljs-operator">=</span> torch.nn.functional.pad(conv<span class="hljs-number">1</span>_w, [<span class="hljs-number">1,1,1,1</span>])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="83"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="84"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        identity <span class="hljs-operator">=</span> torch.nn.functional.pad(torch.ones(conv<span class="hljs-number">1</span>_w.shape[<span class="hljs-number">0</span>], conv<span class="hljs-number">1</span>_w.shape[<span class="hljs-number">1</span>], <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, device<span class="hljs-operator">=</span>conv<span class="hljs-number">1</span>_w.device), [<span class="hljs-number">1,1,1,1</span>])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="85"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="86"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">final</span>_conv_w <span class="hljs-operator">=</span> conv_w <span class="hljs-operator">+</span> conv<span class="hljs-number">1</span>_w <span class="hljs-operator">+</span> identity</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="87"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">final</span>_conv_b <span class="hljs-operator">=</span> conv_b <span class="hljs-operator">+</span> conv<span class="hljs-number">1</span>_b</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="88"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="89"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        conv.weight.<span class="hljs-keyword">data</span>.<span class="hljs-keyword">copy</span>_(<span class="hljs-keyword">final</span>_conv_w)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="90"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        conv.bias.<span class="hljs-keyword">data</span>.<span class="hljs-keyword">copy</span>_(<span class="hljs-keyword">final</span>_conv_b)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="91"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> conv</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="92"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="93"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="94"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">class</span> RepViTBlock(nn.Module):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="95"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def __init__(<span class="hljs-keyword">self</span>,<span class="hljs-keyword">in</span><span class="hljs-number">1</span>, inp, hidden_dim, oup, kernel_<span class="hljs-keyword">size</span><span class="hljs-operator">=</span><span class="hljs-number">3</span>, stride<span class="hljs-operator">=</span><span class="hljs-number">2</span>, <span class="hljs-keyword">use</span>_se<span class="hljs-operator">=</span><span class="hljs-number">0</span>, <span class="hljs-keyword">use</span>_hs<span class="hljs-operator">=</span><span class="hljs-number">0</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="96"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">super</span>(RepViTBlock, <span class="hljs-keyword">self</span>).__init__()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="97"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        assert stride <span class="hljs-keyword">in</span> [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="98"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="99"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.identity <span class="hljs-operator">=</span> stride <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> inp <span class="hljs-operator">=</span><span class="hljs-operator">=</span> oup</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="100"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        print(inp)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="101"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        print(hidden_dim)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="102"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        print(oup)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="103"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        assert(hidden_dim <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-number">2</span> <span class="hljs-operator">*</span> inp)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="104"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="105"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> stride <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-number">2</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="106"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.token_mixer <span class="hljs-operator">=</span> nn.<span class="hljs-keyword">Sequential</span>(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="107"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                Conv<span class="hljs-number">2</span>d_BN(inp, inp, kernel_<span class="hljs-keyword">size</span>, stride, (kernel_<span class="hljs-keyword">size</span><span class="hljs-operator"> - </span><span class="hljs-number">1</span>) <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-number">2</span>, groups<span class="hljs-operator">=</span>inp),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="108"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                SqueezeExcite(inp, <span class="hljs-number">0.25</span>) <span class="hljs-keyword">if</span> <span class="hljs-keyword">use</span>_se <span class="hljs-keyword">else</span> nn.Identity(),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="109"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                Conv<span class="hljs-number">2</span>d_BN(inp, oup, ks<span class="hljs-operator">=</span><span class="hljs-number">1</span>, stride<span class="hljs-operator">=</span><span class="hljs-number">1</span>, pad<span class="hljs-operator">=</span><span class="hljs-number">0</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="110"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            )</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="111"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.channel_mixer <span class="hljs-operator">=</span> Residual(nn.<span class="hljs-keyword">Sequential</span>(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="112"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    # pw</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="113"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    Conv<span class="hljs-number">2</span>d_BN(oup, <span class="hljs-number">2</span> <span class="hljs-operator">*</span> oup, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="114"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    nn.GELU() <span class="hljs-keyword">if</span> <span class="hljs-keyword">use</span>_hs <span class="hljs-keyword">else</span> nn.GELU(),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="115"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    # pw-linear</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="116"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    Conv<span class="hljs-number">2</span>d_BN(<span class="hljs-number">2</span> <span class="hljs-operator">*</span> oup, oup, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, bn_weight_init<span class="hljs-operator">=</span><span class="hljs-number">0</span>),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="117"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                ))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="118"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">else</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="119"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            assert(<span class="hljs-keyword">self</span>.identity)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="120"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.token_mixer <span class="hljs-operator">=</span> nn.<span class="hljs-keyword">Sequential</span>(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="121"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                RepVGGDW(inp),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="122"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                SqueezeExcite(inp, <span class="hljs-number">0.25</span>) <span class="hljs-keyword">if</span> <span class="hljs-keyword">use</span>_se <span class="hljs-keyword">else</span> nn.Identity(),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="123"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            )</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="124"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.channel_mixer <span class="hljs-operator">=</span> Residual(nn.<span class="hljs-keyword">Sequential</span>(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="125"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    # pw</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="126"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    Conv<span class="hljs-number">2</span>d_BN(inp, hidden_dim, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="127"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    nn.GELU() <span class="hljs-keyword">if</span> <span class="hljs-keyword">use</span>_hs <span class="hljs-keyword">else</span> nn.GELU(),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="128"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    # pw-linear</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="129"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    Conv<span class="hljs-number">2</span>d_BN(hidden_dim, oup, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, bn_weight_init<span class="hljs-operator">=</span><span class="hljs-number">0</span>),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="130"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                ))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="131"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="132"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def forward(<span class="hljs-keyword">self</span>, x):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="133"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.channel_mixer(<span class="hljs-keyword">self</span>.token_mixer(x))</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<h3 id="2.2%C2%A0%C2%A0yolo.py%E6%B3%A8%E5%86%8C"><a name="t3"></a>2.2&nbsp;&nbsp;tasks.pyæ³¨å†Œ</h3> 
<pre data-index="1"><code class="hljs language-typescript"><span class="hljs-keyword">from</span> ultralytics.<span class="hljs-property">nn</span>.<span class="hljs-property">backbone</span>.<span class="hljs-property">repvit</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">RepViTBlock</span></code><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<p>def parse_model(d, ch, verbose=True): &nbsp;# model_dict, input_channels(3)</p> 
<pre data-index="2"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:1069px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">if</span> m <span class="hljs-keyword">in</span> (Classify, Conv, ConvTranspose, GhostConv, Bottleneck, GhostBottleneck, SPP, SPPF, DWConv, Focus,</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                 BottleneckCSP, C<span class="hljs-number">1</span>, C<span class="hljs-number">2</span>, C<span class="hljs-number">2</span>f, C<span class="hljs-number">3</span>, C<span class="hljs-number">3</span>TR, C<span class="hljs-number">3</span>Ghost, nn.ConvTranspose<span class="hljs-number">2</span>d, DWConvTranspose<span class="hljs-number">2</span>d, C<span class="hljs-number">3</span>x,RepViTBlock</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                 ):</div></div></li></ol></code><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<h3 id="2.3%C2%A0yolov8_RepViTBlock.yaml"><a name="t4"></a>2.3&nbsp;yolov8_RepViTBlock.yaml</h3> 
<pre data-index="3" class="set-code-hide" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:1052px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># Ultralytics YOLO ğŸš€, GPL-<span class="hljs-number">3.0</span> license</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># YOLOv<span class="hljs-number">8</span> <span class="hljs-keyword">object</span> detection model <span class="hljs-keyword">with</span> P<span class="hljs-number">3</span>-P<span class="hljs-number">5</span> outputs. <span class="hljs-keyword">For</span> <span class="hljs-keyword">Usage</span> examples see https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>docs.ultralytics.com<span class="hljs-operator">/</span>tasks<span class="hljs-operator">/</span>detect</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># Parameters</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">nc: <span class="hljs-number">4</span>  # <span class="hljs-keyword">number</span> <span class="hljs-keyword">of</span> classes</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">scales: # model compound scaling constants, i.e. <span class="hljs-string">'model=yolov8n.yaml'</span> will <span class="hljs-keyword">call</span> yolov<span class="hljs-number">8</span>.yaml <span class="hljs-keyword">with</span> scale <span class="hljs-string">'n'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  # [depth, width, max_channels]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  n: [<span class="hljs-number">0.33</span>, <span class="hljs-number">0.25</span>, <span class="hljs-number">1024</span>]  # YOLOv<span class="hljs-number">8</span>n summary: <span class="hljs-number">225</span> layers,  <span class="hljs-number">3157200</span> parameters,  <span class="hljs-number">3157184</span> gradients,   <span class="hljs-number">8.9</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  s: [<span class="hljs-number">0.33</span>, <span class="hljs-number">0.50</span>, <span class="hljs-number">1024</span>]  # YOLOv<span class="hljs-number">8</span>s summary: <span class="hljs-number">225</span> layers, <span class="hljs-number">11166560</span> parameters, <span class="hljs-number">11166544</span> gradients,  <span class="hljs-number">28.8</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  m: [<span class="hljs-number">0.67</span>, <span class="hljs-number">0.75</span>, <span class="hljs-number">768</span>]   # YOLOv<span class="hljs-number">8</span>m summary: <span class="hljs-number">295</span> layers, <span class="hljs-number">25902640</span> parameters, <span class="hljs-number">25902624</span> gradients,  <span class="hljs-number">79.3</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  l: [<span class="hljs-number">1.00</span>, <span class="hljs-number">1.00</span>, <span class="hljs-number">512</span>]   # YOLOv<span class="hljs-number">8</span>l summary: <span class="hljs-number">365</span> layers, <span class="hljs-number">43691520</span> parameters, <span class="hljs-number">43691504</span> gradients, <span class="hljs-number">165.7</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  x: [<span class="hljs-number">1.00</span>, <span class="hljs-number">1.25</span>, <span class="hljs-number">512</span>]   # YOLOv<span class="hljs-number">8</span>x summary: <span class="hljs-number">365</span> layers, <span class="hljs-number">68229648</span> parameters, <span class="hljs-number">68229632</span> gradients, <span class="hljs-number">258.5</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># YOLOv<span class="hljs-number">8.0</span>n backbone</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">backbone:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  # [<span class="hljs-keyword">from</span>, repeats, module, args]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">64</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">0</span>-P<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">2</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">128</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">1</span>-P<span class="hljs-number">2</span><span class="hljs-operator">/</span><span class="hljs-number">4</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">128</span>, <span class="hljs-keyword">True</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">256</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">3</span>-P<span class="hljs-number">3</span><span class="hljs-operator">/</span><span class="hljs-number">8</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">256</span>, <span class="hljs-keyword">True</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">512</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">5</span>-P<span class="hljs-number">4</span><span class="hljs-operator">/</span><span class="hljs-number">16</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">512</span>, <span class="hljs-keyword">True</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">1024</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">7</span>-P<span class="hljs-number">5</span><span class="hljs-operator">/</span><span class="hljs-number">32</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">1024</span>, <span class="hljs-keyword">True</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, SPPF, [<span class="hljs-number">1024</span>, <span class="hljs-number">5</span>]]  # <span class="hljs-number">9</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># YOLOv<span class="hljs-number">8.0</span>n head</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">head:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, nn.Upsample, [None, <span class="hljs-number">2</span>, <span class="hljs-string">'nearest'</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[-<span class="hljs-number">1</span>, <span class="hljs-number">6</span>], <span class="hljs-number">1</span>, Concat, [<span class="hljs-number">1</span>]]  # cat backbone P<span class="hljs-number">4</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">512</span>]]  # <span class="hljs-number">12</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, nn.Upsample, [None, <span class="hljs-number">2</span>, <span class="hljs-string">'nearest'</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[-<span class="hljs-number">1</span>, <span class="hljs-number">4</span>], <span class="hljs-number">1</span>, Concat, [<span class="hljs-number">1</span>]]  # cat backbone P<span class="hljs-number">3</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">256</span>]]  # <span class="hljs-number">15</span> (P<span class="hljs-number">3</span><span class="hljs-operator">/</span><span class="hljs-number">8</span>-small)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">256</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[-<span class="hljs-number">1</span>, <span class="hljs-number">12</span>], <span class="hljs-number">1</span>, Concat, [<span class="hljs-number">1</span>]]  # cat head P<span class="hljs-number">4</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">512</span>]]  # <span class="hljs-number">18</span> (P<span class="hljs-number">4</span><span class="hljs-operator">/</span><span class="hljs-number">16</span>-medium)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">512</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[-<span class="hljs-number">1</span>, <span class="hljs-number">9</span>], <span class="hljs-number">1</span>, Concat, [<span class="hljs-number">1</span>]]  # cat head P<span class="hljs-number">5</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">1024</span>]]  # <span class="hljs-number">21</span> (P<span class="hljs-number">5</span><span class="hljs-operator">/</span><span class="hljs-number">32</span>-large)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, RepViTBlock, [<span class="hljs-number">1024,512,256</span>]]  # <span class="hljs-number">21</span> (P<span class="hljs-number">5</span><span class="hljs-operator">/</span><span class="hljs-number">32</span>-large)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[<span class="hljs-number">15</span>, <span class="hljs-number">18</span>, <span class="hljs-number">22</span>], <span class="hljs-number">1</span>, Detect, [nc]]  # Detect(P<span class="hljs-number">3</span>, P<span class="hljs-number">4</span>, P<span class="hljs-number">5</span>)</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<p></p>
                </div><div data-report-view="{&quot;mod&quot;:&quot;1585297308_001&quot;,&quot;spm&quot;:&quot;1001.2101.3001.6548&quot;,&quot;dest&quot;:&quot;https://cv2023.blog.csdn.net/article/details/131939062&quot;,&quot;extend1&quot;:&quot;pc&quot;,&quot;ab&quot;:&quot;new&quot;}"><div></div></div>
        </div>