<div id="article_content" class="article_content clearfix">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/kdoc_html_views-1a98987dfd.css">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-dc4a025e85.css">
                <div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p><a href="#%C2%A01.VanillaNet" target="_self">1.VanillaNet</a></p> 
<p id="" style="margin: 0px 0px 2px; padding-left: 24px;"><a href="#t0" target="_self">&nbsp;2.&nbsp;VanillaBlock引入到yolov8</a></p> 
<p id="" style="margin: 0px 0px 2px 48px; padding-left: 24px;"><a href="#t1" target="_self">2.1 加入加入ultralytics/nn/backbone/VanillaNet.py</a></p> 
<p id="" style="margin: 0px 0px 2px 48px; padding-left: 24px;"><a href="#t2" target="_self">2.2&nbsp;&nbsp;tasks.py注册</a></p> 
<p id="" style="margin: 0px 0px 2px 48px; padding-left: 24px;"><a href="#t3" target="_self">2.3&nbsp;yolov8_VanillaBlock.yaml</a></p> 
<hr id="hr-toc"> 
<h3><a name="t0"></a>&nbsp;💡💡💡💡💡<span style="color:#fe2c24;">强烈推荐：博主多个数据集亲测有效，实现暴力涨点，可快速迁移到论文创新性十足，刚新鲜出炉的论文，华为诺亚共同提出！！！</span></h3> 
<h3><a name="t1"></a>🏆🏆🏆🏆🏆🏆🏆Yolov8魔术师🏆🏆🏆🏆🏆🏆🏆<br> 🌟🌟🌟魔改网络和复现cvpr等前沿论文，组合优化<br> 🍉🍉🍉独家首创，可直接作为创新点使用<br> 🚀🚀🚀在多个数据集进行验证mAP涨点明显，尤其是小目标、遮挡物精度提升明显；<br> 🌰 🌰 🌰🌰 🌰 🌰🌰 🌰 🌰🌰 🌰 🌰🌰 🌰 🌰🌰 🌰 🌰🌰 🌰&nbsp;</h3> 
<h3 id="%E5%BC%BA%E7%83%88%E6%8E%A8%E8%8D%90%EF%BC%9A%E5%8D%9A%E4%B8%BB%E5%A4%9A%E4%B8%AA%E6%95%B0%E6%8D%AE%E9%9B%86%E4%BA%B2%E6%B5%8B%E6%9C%89%E6%95%88%EF%BC%8C%E5%AE%9E%E7%8E%B0%E6%9A%B4%E5%8A%9B%E6%B6%A8%E7%82%B9%EF%BC%8C%E5%8F%AF%E5%BF%AB%E9%80%9F%E8%BF%81%E7%A7%BB%E5%88%B0%E8%AE%BA%E6%96%87%E5%88%9B%E6%96%B0%E6%80%A7%E5%8D%81%E8%B6%B3%EF%BC%8C%E5%88%9A%E6%96%B0%E9%B2%9C%E5%87%BA%E7%82%89%E7%9A%84%E8%AE%BA%E6%96%87%EF%BC%8C%E5%8D%8E%E4%B8%BA%E8%AF%BA%E4%BA%9A%E5%85%B1%E5%90%8C%E6%8F%90%E5%87%BA%EF%BC%81%EF%BC%81%EF%BC%81"><a name="t2"></a>强烈推荐：博主多个数据集亲测有效，实现暴力涨点，可快速迁移到论文创新性十足，刚新鲜出炉的论文，华为诺亚共同提出！！！</h3> 
<h2 id="%C2%A01.VanillaNet"><a name="t3"></a>&nbsp;1.VanillaNet</h2> 
<p><img alt="" height="244" src="https://img-blog.csdnimg.cn/411aa18c9ea64385a7719af4b1a647b9.png" width="698"></p> 
<p>&nbsp;论文：<a href="https://arxiv.org/pdf/2305.12972.pdf" title="https://arxiv.org/pdf/2305.12972.pdf">https://arxiv.org/pdf/2305.12972.pdf</a></p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;来自华为诺亚、悉尼大学的研究者们提出了一种极简的<a href="https://so.csdn.net/so/search?q=%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;神经网络模型\&quot;}&quot;}" data-tit="神经网络模型" data-pretit="神经网络模型">神经网络模型</a> VanillaNet，以极简主义的设计为理念，网络中仅仅包含最简单的卷积计算，去掉了残差和注意力模块，在计算机视觉中的各种任务上都取得了不俗的效果。&nbsp;</p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VanillaNet，这是一种设计优雅的神经网络架构。 通过避免高深度、shortcuts和自注意力等复杂操作，VanillaNet 简洁明了但功能强大。&nbsp;</p> 
<p><img alt="" height="480" src="https://img-blog.csdnimg.cn/a2f203cf09d44069a1bfb70eba739617.png" width="888">​</p> 
<ul><li>对于Stem部分，采用4×4卷积进行特征变换；</li><li>对于body部分的每个stage，首先采用MaxPool进行特征下采样，然后采用一个1×1进行特征处理；</li><li>对于head部分，采用两个非线性层进行分类处理</li></ul> 
<p><img alt="" height="404" src="https://img-blog.csdnimg.cn/4273ba0278b645b988cc8b4e346096ff.png" width="873">​</p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;深度为6的网络即可取得76.36%@ImageNet的精度，深度为13的VanillaNet甚至取得了83.1%的惊人性能。&nbsp;</p> 
<p><img alt="" height="660" src="https://img-blog.csdnimg.cn/fd1c91214f6f4266b2979ae9d5d92487.png" width="646">​</p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;所提出的 VanillaNet 具有十分惊艳的速度和精度指标，例如 VanillaNet-9 仅仅使用 9 层，就在 ImageNet 上达到了接近 80% 的精度，和同精度的 ResNet-50 相比，速度提升一倍以上（2.91ms v.s. 7.64ms），而 13 层的 VanillaNet 已经可以达到 83% 的 Top-1 准确率，和相同精度的 Swin-S 网络相比速度快 1 倍以上。尽管 VanillaNet 的参数量和计算量都远高于复杂网络，但由于其极简设计带来的优势，速度反而更快。<img alt="" height="586" src="https://img-blog.csdnimg.cn/c23f5212f92a462994e283150f232e96.png" width="1020">​</p> 
<h2 id="%C2%A02.%C2%A0VanillaBlock%E5%BC%95%E5%85%A5%E5%88%B0yolov8"><a name="t4"></a>&nbsp;2.&nbsp;VanillaBlock引入到yolov8</h2> 
<h3 id="2.1%20%E5%8A%A0%E5%85%A5%E5%8A%A0%E5%85%A5ultralytics%2Fnn%2Fbackbone%2FVanillaNet.py"><a name="t5"></a>2.1 加入加入ultralytics/nn/<a href="https://so.csdn.net/so/search?q=backbone&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=backbone&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;backbone\&quot;}&quot;}" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=backbone&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;backbone\&quot;}&quot;}" data-tit="backbone" data-pretit="backbone">backbone</a>/VanillaNet.py</h3> 
<div> 
 <pre data-index="0" class="set-code-hide" name="code"><code class="hljs language-cobol"><ol class="hljs-ln hundred" style="width:1918px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">#Copyright (C) <span class="hljs-number">2023</span>. Huawei Technologies Co., Ltd. <span class="hljs-literal">All</span> rights reserved.</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">#This <span class="hljs-keyword">program</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">free</span> software; you can redistribute it <span class="hljs-keyword">and</span><span class="hljs-operator">/</span><span class="hljs-keyword">or</span> modify it under the terms <span class="hljs-keyword">of</span> the MIT License.</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">#This <span class="hljs-keyword">program</span> <span class="hljs-keyword">is</span> distributed <span class="hljs-keyword">in</span> the hope that it will be useful, but WITHOUT <span class="hljs-keyword">ANY</span> WARRANTY; without even the implied warranty <span class="hljs-keyword">of</span> MERCHANTABILITY <span class="hljs-keyword">or</span> FITNESS <span class="hljs-keyword">FOR</span> A PARTICULAR PURPOSE. See the MIT License <span class="hljs-keyword">for</span> more details.</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import torch</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import torch.nn <span class="hljs-keyword">as</span> nn</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import torch.nn.functional <span class="hljs-keyword">as</span> F</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">from</span> timm.models.layers import weight_init, DropPath</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import numpy <span class="hljs-keyword">as</span> np</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">__<span class="hljs-literal">all</span>__ <span class="hljs-operator">=</span> [<span class="hljs-string">'vanillanet_5'</span>, <span class="hljs-string">'vanillanet_6'</span>, <span class="hljs-string">'vanillanet_7'</span>, <span class="hljs-string">'vanillanet_8'</span>, <span class="hljs-string">'vanillanet_9'</span>, <span class="hljs-string">'vanillanet_10'</span>, <span class="hljs-string">'vanillanet_11'</span>, <span class="hljs-string">'vanillanet_12'</span>, <span class="hljs-string">'vanillanet_13'</span>, <span class="hljs-string">'vanillanet_13_x1_5'</span>, <span class="hljs-string">'vanillanet_13_x1_5_ada_pool'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">class</span> activation(nn.ReLU):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def __init__(<span class="hljs-keyword">self</span>, dim, act_num<span class="hljs-operator">=</span><span class="hljs-number">3</span>, deploy<span class="hljs-operator">=</span><span class="hljs-keyword">False</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">super</span>(activation, <span class="hljs-keyword">self</span>).__init__()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.deploy <span class="hljs-operator">=</span> deploy</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.weight <span class="hljs-operator">=</span> torch.nn.Parameter(torch.randn(dim, <span class="hljs-number">1</span>, act_num<span class="hljs-operator">*</span><span class="hljs-number">2</span> <span class="hljs-operator">+</span> <span class="hljs-number">1</span>, act_num<span class="hljs-operator">*</span><span class="hljs-number">2</span> <span class="hljs-operator">+</span> <span class="hljs-number">1</span>))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.bias <span class="hljs-operator">=</span> None</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.bn <span class="hljs-operator">=</span> nn.BatchNorm<span class="hljs-number">2</span>d(dim, eps<span class="hljs-operator">=</span><span class="hljs-number">1</span>e-<span class="hljs-number">6</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.dim <span class="hljs-operator">=</span> dim</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.act_num <span class="hljs-operator">=</span> act_num</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        weight_init.trunc_normal_(<span class="hljs-keyword">self</span>.weight, std<span class="hljs-operator">=</span>.<span class="hljs-number">02</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def forward(<span class="hljs-keyword">self</span>, x):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.deploy:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">return</span> torch.nn.functional.conv<span class="hljs-number">2</span>d(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-keyword">super</span>(activation, <span class="hljs-keyword">self</span>).forward(x), </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-keyword">self</span>.weight, <span class="hljs-keyword">self</span>.bias, padding<span class="hljs-operator">=</span>(<span class="hljs-keyword">self</span>.act_num<span class="hljs-operator">*</span><span class="hljs-number">2</span> <span class="hljs-operator">+</span> <span class="hljs-number">1</span>)<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-number">2</span>, groups<span class="hljs-operator">=</span><span class="hljs-keyword">self</span>.dim)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">else</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.bn(torch.nn.functional.conv<span class="hljs-number">2</span>d(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-keyword">super</span>(activation, <span class="hljs-keyword">self</span>).forward(x),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-keyword">self</span>.weight, padding<span class="hljs-operator">=</span><span class="hljs-keyword">self</span>.act_num, groups<span class="hljs-operator">=</span><span class="hljs-keyword">self</span>.dim))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def _fuse_bn_tensor(<span class="hljs-keyword">self</span>, weight, bn):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        kernel <span class="hljs-operator">=</span> weight</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        running_mean <span class="hljs-operator">=</span> bn.running_mean</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        running_var <span class="hljs-operator">=</span> bn.running_var</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        gamma <span class="hljs-operator">=</span> bn.weight</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        beta <span class="hljs-operator">=</span> bn.bias</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        eps <span class="hljs-operator">=</span> bn.eps</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        std <span class="hljs-operator">=</span> (running_var <span class="hljs-operator">+</span> eps).sqrt()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        t <span class="hljs-operator">=</span> (gamma <span class="hljs-operator">/</span> std).reshape(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> kernel <span class="hljs-operator">*</span> t, beta <span class="hljs-operator">+</span> (<span class="hljs-number">0</span><span class="hljs-operator"> - </span>running_mean) <span class="hljs-operator">*</span> gamma <span class="hljs-operator">/</span> std</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def switch_<span class="hljs-keyword">to</span>_deploy(<span class="hljs-keyword">self</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        kernel, bias <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>._fuse_bn_tensor(<span class="hljs-keyword">self</span>.weight, <span class="hljs-keyword">self</span>.bn)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.weight.<span class="hljs-keyword">data</span> <span class="hljs-operator">=</span> kernel</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="50"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.bias <span class="hljs-operator">=</span> torch.nn.Parameter(torch.<span class="hljs-literal">zeros</span>(<span class="hljs-keyword">self</span>.dim))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="51"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.bias.<span class="hljs-keyword">data</span> <span class="hljs-operator">=</span> bias</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="52"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.__delattr__(<span class="hljs-string">'bn'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="53"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.deploy <span class="hljs-operator">=</span> <span class="hljs-keyword">True</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="54"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="55"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="56"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">class</span> VanillaBlock(nn.Module):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="57"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def __init__(<span class="hljs-keyword">self</span>, dim, dim_out, act_num<span class="hljs-operator">=</span><span class="hljs-number">3</span>, stride<span class="hljs-operator">=</span><span class="hljs-number">2</span>, deploy<span class="hljs-operator">=</span><span class="hljs-keyword">False</span>, ada_pool<span class="hljs-operator">=</span>None):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="58"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">super</span>().__init__()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="59"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.act_learn <span class="hljs-operator">=</span> <span class="hljs-number">1</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="60"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.deploy <span class="hljs-operator">=</span> deploy</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="61"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.deploy:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="62"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.conv <span class="hljs-operator">=</span> nn.Conv<span class="hljs-number">2</span>d(dim, dim_out, kernel_<span class="hljs-keyword">size</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="63"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">else</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="64"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.conv<span class="hljs-number">1</span> <span class="hljs-operator">=</span> nn.<span class="hljs-keyword">Sequential</span>(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="65"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                nn.Conv<span class="hljs-number">2</span>d(dim, dim, kernel_<span class="hljs-keyword">size</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="66"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                nn.BatchNorm<span class="hljs-number">2</span>d(dim, eps<span class="hljs-operator">=</span><span class="hljs-number">1</span>e-<span class="hljs-number">6</span>),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="67"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            )</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="68"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.conv<span class="hljs-number">2</span> <span class="hljs-operator">=</span> nn.<span class="hljs-keyword">Sequential</span>(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="69"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                nn.Conv<span class="hljs-number">2</span>d(dim, dim_out, kernel_<span class="hljs-keyword">size</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="70"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                nn.BatchNorm<span class="hljs-number">2</span>d(dim_out, eps<span class="hljs-operator">=</span><span class="hljs-number">1</span>e-<span class="hljs-number">6</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="71"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            )</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="72"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="73"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ada_pool:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="74"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.pool <span class="hljs-operator">=</span> nn.Identity() <span class="hljs-keyword">if</span> stride <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> nn.MaxPool<span class="hljs-number">2</span>d(stride)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="75"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">else</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="76"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.pool <span class="hljs-operator">=</span> nn.Identity() <span class="hljs-keyword">if</span> stride <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> nn.AdaptiveMaxPool<span class="hljs-number">2</span>d((ada_pool, ada_pool))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="77"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="78"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.act <span class="hljs-operator">=</span> activation(dim_out, act_num)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="79"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="80"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def forward(<span class="hljs-keyword">self</span>, x):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="81"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.deploy:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="82"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            x <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.conv(x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="83"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">else</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="84"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            x <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.conv<span class="hljs-number">1</span>(x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="85"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            x <span class="hljs-operator">=</span> torch.nn.functional.leaky_relu(x,<span class="hljs-keyword">self</span>.act_learn)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="86"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            x <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.conv<span class="hljs-number">2</span>(x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="87"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="88"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.pool(x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="89"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.act(x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="90"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> x</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="91"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="92"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def _fuse_bn_tensor(<span class="hljs-keyword">self</span>, conv, bn):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="93"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        kernel <span class="hljs-operator">=</span> conv.weight</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="94"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        bias <span class="hljs-operator">=</span> conv.bias</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="95"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        running_mean <span class="hljs-operator">=</span> bn.running_mean</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="96"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        running_var <span class="hljs-operator">=</span> bn.running_var</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="97"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        gamma <span class="hljs-operator">=</span> bn.weight</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="98"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        beta <span class="hljs-operator">=</span> bn.bias</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="99"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        eps <span class="hljs-operator">=</span> bn.eps</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="100"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        std <span class="hljs-operator">=</span> (running_var <span class="hljs-operator">+</span> eps).sqrt()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="101"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        t <span class="hljs-operator">=</span> (gamma <span class="hljs-operator">/</span> std).reshape(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="102"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> kernel <span class="hljs-operator">*</span> t, beta <span class="hljs-operator">+</span> (bias<span class="hljs-operator"> - </span>running_mean) <span class="hljs-operator">*</span> gamma <span class="hljs-operator">/</span> std</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="103"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="104"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def switch_<span class="hljs-keyword">to</span>_deploy(<span class="hljs-keyword">self</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="105"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        kernel, bias <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>._fuse_bn_tensor(<span class="hljs-keyword">self</span>.conv<span class="hljs-number">1</span>[<span class="hljs-number">0</span>], <span class="hljs-keyword">self</span>.conv<span class="hljs-number">1</span>[<span class="hljs-number">1</span>])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="106"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.conv<span class="hljs-number">1</span>[<span class="hljs-number">0</span>].weight.<span class="hljs-keyword">data</span> <span class="hljs-operator">=</span> kernel</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="107"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.conv<span class="hljs-number">1</span>[<span class="hljs-number">0</span>].bias.<span class="hljs-keyword">data</span> <span class="hljs-operator">=</span> bias</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="108"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        # kernel, bias <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.conv<span class="hljs-number">2</span>[<span class="hljs-number">0</span>].weight.<span class="hljs-keyword">data</span>, <span class="hljs-keyword">self</span>.conv<span class="hljs-number">2</span>[<span class="hljs-number">0</span>].bias.<span class="hljs-keyword">data</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="109"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        kernel, bias <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>._fuse_bn_tensor(<span class="hljs-keyword">self</span>.conv<span class="hljs-number">2</span>[<span class="hljs-number">0</span>], <span class="hljs-keyword">self</span>.conv<span class="hljs-number">2</span>[<span class="hljs-number">1</span>])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="110"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.conv <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.conv<span class="hljs-number">2</span>[<span class="hljs-number">0</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="111"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.conv.weight.<span class="hljs-keyword">data</span> <span class="hljs-operator">=</span> torch.matmul(kernel.transpose(<span class="hljs-number">1,3</span>), <span class="hljs-keyword">self</span>.conv<span class="hljs-number">1</span>[<span class="hljs-number">0</span>].weight.<span class="hljs-keyword">data</span>.squeeze(<span class="hljs-number">3</span>).squeeze(<span class="hljs-number">2</span>)).transpose(<span class="hljs-number">1,3</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="112"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.conv.bias.<span class="hljs-keyword">data</span> <span class="hljs-operator">=</span> bias <span class="hljs-operator">+</span> (<span class="hljs-keyword">self</span>.conv<span class="hljs-number">1</span>[<span class="hljs-number">0</span>].bias.<span class="hljs-keyword">data</span>.view(<span class="hljs-number">1</span>,-<span class="hljs-number">1,1,1</span>)<span class="hljs-operator">*</span>kernel).<span class="hljs-keyword">sum</span>(<span class="hljs-number">3</span>).<span class="hljs-keyword">sum</span>(<span class="hljs-number">2</span>).<span class="hljs-keyword">sum</span>(<span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="113"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.__delattr__(<span class="hljs-string">'conv1'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="114"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.__delattr__(<span class="hljs-string">'conv2'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="115"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.act.switch_<span class="hljs-keyword">to</span>_deploy()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="116"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.deploy <span class="hljs-operator">=</span> <span class="hljs-keyword">True</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="117"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="118"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="119"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">class</span> VanillaNet(nn.Module):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="120"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def __init__(<span class="hljs-keyword">self</span>, <span class="hljs-keyword">in</span>_chans<span class="hljs-operator">=</span><span class="hljs-number">3</span>, num_classes<span class="hljs-operator">=</span><span class="hljs-number">1000</span>, dims<span class="hljs-operator">=</span>[<span class="hljs-number">96</span>, <span class="hljs-number">192</span>, <span class="hljs-number">384</span>, <span class="hljs-number">768</span>], </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="121"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                 drop_rate<span class="hljs-operator">=</span><span class="hljs-number">0</span>, act_num<span class="hljs-operator">=</span><span class="hljs-number">3</span>, strides<span class="hljs-operator">=</span>[<span class="hljs-number">2,2,2,1</span>], deploy<span class="hljs-operator">=</span><span class="hljs-keyword">False</span>, ada_pool<span class="hljs-operator">=</span>None, <span class="hljs-operator">**</span>kwargs):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="122"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">super</span>().__init__()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="123"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.deploy <span class="hljs-operator">=</span> deploy</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="124"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.deploy:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="125"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.stem <span class="hljs-operator">=</span> nn.<span class="hljs-keyword">Sequential</span>(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="126"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                nn.Conv<span class="hljs-number">2</span>d(<span class="hljs-keyword">in</span>_chans, dims[<span class="hljs-number">0</span>], kernel_<span class="hljs-keyword">size</span><span class="hljs-operator">=</span><span class="hljs-number">4</span>, stride<span class="hljs-operator">=</span><span class="hljs-number">4</span>),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="127"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                activation(dims[<span class="hljs-number">0</span>], act_num)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="128"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            )</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="129"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">else</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="130"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.stem<span class="hljs-number">1</span> <span class="hljs-operator">=</span> nn.<span class="hljs-keyword">Sequential</span>(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="131"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                nn.Conv<span class="hljs-number">2</span>d(<span class="hljs-keyword">in</span>_chans, dims[<span class="hljs-number">0</span>], kernel_<span class="hljs-keyword">size</span><span class="hljs-operator">=</span><span class="hljs-number">4</span>, stride<span class="hljs-operator">=</span><span class="hljs-number">4</span>),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="132"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                nn.BatchNorm<span class="hljs-number">2</span>d(dims[<span class="hljs-number">0</span>], eps<span class="hljs-operator">=</span><span class="hljs-number">1</span>e-<span class="hljs-number">6</span>),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="133"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            )</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="134"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.stem<span class="hljs-number">2</span> <span class="hljs-operator">=</span> nn.<span class="hljs-keyword">Sequential</span>(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="135"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                nn.Conv<span class="hljs-number">2</span>d(dims[<span class="hljs-number">0</span>], dims[<span class="hljs-number">0</span>], kernel_<span class="hljs-keyword">size</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>, stride<span class="hljs-operator">=</span><span class="hljs-number">1</span>),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="136"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                nn.BatchNorm<span class="hljs-number">2</span>d(dims[<span class="hljs-number">0</span>], eps<span class="hljs-operator">=</span><span class="hljs-number">1</span>e-<span class="hljs-number">6</span>),</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="137"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                activation(dims[<span class="hljs-number">0</span>], act_num)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="138"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            )</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="139"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="140"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.act_learn <span class="hljs-operator">=</span> <span class="hljs-number">1</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="141"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="142"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.stages <span class="hljs-operator">=</span> nn.ModuleList()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="143"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(strides)):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="144"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ada_pool:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="145"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                stage <span class="hljs-operator">=</span> VanillaBlock(dim<span class="hljs-operator">=</span>dims[i], dim_out<span class="hljs-operator">=</span>dims[i<span class="hljs-operator">+</span><span class="hljs-number">1</span>], act_num<span class="hljs-operator">=</span>act_num, stride<span class="hljs-operator">=</span>strides[i], deploy<span class="hljs-operator">=</span>deploy)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="146"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">else</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="147"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                stage <span class="hljs-operator">=</span> VanillaBlock(dim<span class="hljs-operator">=</span>dims[i], dim_out<span class="hljs-operator">=</span>dims[i<span class="hljs-operator">+</span><span class="hljs-number">1</span>], act_num<span class="hljs-operator">=</span>act_num, stride<span class="hljs-operator">=</span>strides[i], deploy<span class="hljs-operator">=</span>deploy, ada_pool<span class="hljs-operator">=</span>ada_pool[i])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="148"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.stages.append(stage)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="149"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.depth <span class="hljs-operator">=</span> len(strides)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="150"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="151"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.apply(<span class="hljs-keyword">self</span>._init_weights)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="152"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.channel <span class="hljs-operator">=</span> [i.<span class="hljs-keyword">size</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.forward(torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">640</span>, <span class="hljs-number">640</span>))]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="153"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="154"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def _init_weights(<span class="hljs-keyword">self</span>, m):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="155"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> isinstance(m, (nn.Conv<span class="hljs-number">2</span>d, nn.Linear)):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="156"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            weight_init.trunc_normal_(m.weight, std<span class="hljs-operator">=</span>.<span class="hljs-number">02</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="157"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            nn.init.<span class="hljs-keyword">constant</span>_(m.bias, <span class="hljs-number">0</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="158"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="159"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def change_act(<span class="hljs-keyword">self</span>, m):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="160"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-keyword">self</span>.depth):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="161"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.stages[i].act_learn <span class="hljs-operator">=</span> m</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="162"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.act_learn <span class="hljs-operator">=</span> m</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="163"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="164"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def forward(<span class="hljs-keyword">self</span>, x):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="165"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        res <span class="hljs-operator">=</span> []</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="166"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.deploy:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="167"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            x <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.stem(x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="168"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">else</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="169"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            x <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.stem<span class="hljs-number">1</span>(x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="170"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            x <span class="hljs-operator">=</span> torch.nn.functional.leaky_relu(x,<span class="hljs-keyword">self</span>.act_learn)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="171"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            x <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.stem<span class="hljs-number">2</span>(x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="172"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        res.append(x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="173"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-keyword">self</span>.depth):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="174"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            x <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.stages[i](x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="175"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            res.append(x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="176"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> res</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="177"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="178"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def _fuse_bn_tensor(<span class="hljs-keyword">self</span>, conv, bn):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="179"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        kernel <span class="hljs-operator">=</span> conv.weight</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="180"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        bias <span class="hljs-operator">=</span> conv.bias</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="181"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        running_mean <span class="hljs-operator">=</span> bn.running_mean</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="182"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        running_var <span class="hljs-operator">=</span> bn.running_var</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="183"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        gamma <span class="hljs-operator">=</span> bn.weight</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="184"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        beta <span class="hljs-operator">=</span> bn.bias</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="185"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        eps <span class="hljs-operator">=</span> bn.eps</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="186"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        std <span class="hljs-operator">=</span> (running_var <span class="hljs-operator">+</span> eps).sqrt()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="187"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        t <span class="hljs-operator">=</span> (gamma <span class="hljs-operator">/</span> std).reshape(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="188"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> kernel <span class="hljs-operator">*</span> t, beta <span class="hljs-operator">+</span> (bias<span class="hljs-operator"> - </span>running_mean) <span class="hljs-operator">*</span> gamma <span class="hljs-operator">/</span> std</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="189"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="190"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def switch_<span class="hljs-keyword">to</span>_deploy(<span class="hljs-keyword">self</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="191"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.stem<span class="hljs-number">2</span>[<span class="hljs-number">2</span>].switch_<span class="hljs-keyword">to</span>_deploy()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="192"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        kernel, bias <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>._fuse_bn_tensor(<span class="hljs-keyword">self</span>.stem<span class="hljs-number">1</span>[<span class="hljs-number">0</span>], <span class="hljs-keyword">self</span>.stem<span class="hljs-number">1</span>[<span class="hljs-number">1</span>])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="193"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.stem<span class="hljs-number">1</span>[<span class="hljs-number">0</span>].weight.<span class="hljs-keyword">data</span> <span class="hljs-operator">=</span> kernel</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="194"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.stem<span class="hljs-number">1</span>[<span class="hljs-number">0</span>].bias.<span class="hljs-keyword">data</span> <span class="hljs-operator">=</span> bias</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="195"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        kernel, bias <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>._fuse_bn_tensor(<span class="hljs-keyword">self</span>.stem<span class="hljs-number">2</span>[<span class="hljs-number">0</span>], <span class="hljs-keyword">self</span>.stem<span class="hljs-number">2</span>[<span class="hljs-number">1</span>])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="196"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.stem<span class="hljs-number">1</span>[<span class="hljs-number">0</span>].weight.<span class="hljs-keyword">data</span> <span class="hljs-operator">=</span> torch.einsum(<span class="hljs-string">'oi,icjk-&gt;ocjk'</span>, kernel.squeeze(<span class="hljs-number">3</span>).squeeze(<span class="hljs-number">2</span>), <span class="hljs-keyword">self</span>.stem<span class="hljs-number">1</span>[<span class="hljs-number">0</span>].weight.<span class="hljs-keyword">data</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="197"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.stem<span class="hljs-number">1</span>[<span class="hljs-number">0</span>].bias.<span class="hljs-keyword">data</span> <span class="hljs-operator">=</span> bias <span class="hljs-operator">+</span> (<span class="hljs-keyword">self</span>.stem<span class="hljs-number">1</span>[<span class="hljs-number">0</span>].bias.<span class="hljs-keyword">data</span>.view(<span class="hljs-number">1</span>,-<span class="hljs-number">1,1,1</span>)<span class="hljs-operator">*</span>kernel).<span class="hljs-keyword">sum</span>(<span class="hljs-number">3</span>).<span class="hljs-keyword">sum</span>(<span class="hljs-number">2</span>).<span class="hljs-keyword">sum</span>(<span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="198"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.stem <span class="hljs-operator">=</span> torch.nn.<span class="hljs-keyword">Sequential</span>(<span class="hljs-operator">*</span>[<span class="hljs-keyword">self</span>.stem<span class="hljs-number">1</span>[<span class="hljs-number">0</span>], <span class="hljs-keyword">self</span>.stem<span class="hljs-number">2</span>[<span class="hljs-number">2</span>]])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="199"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.__delattr__(<span class="hljs-string">'stem1'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="200"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.__delattr__(<span class="hljs-string">'stem2'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="201"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="202"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-keyword">self</span>.depth):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="203"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">self</span>.stages[i].switch_<span class="hljs-keyword">to</span>_deploy()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="204"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="205"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        kernel, bias <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>._fuse_bn_tensor(<span class="hljs-keyword">self</span>.cls<span class="hljs-number">1</span>[<span class="hljs-number">2</span>], <span class="hljs-keyword">self</span>.cls<span class="hljs-number">1</span>[<span class="hljs-number">3</span>])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="206"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.cls<span class="hljs-number">1</span>[<span class="hljs-number">2</span>].weight.<span class="hljs-keyword">data</span> <span class="hljs-operator">=</span> kernel</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="207"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.cls<span class="hljs-number">1</span>[<span class="hljs-number">2</span>].bias.<span class="hljs-keyword">data</span> <span class="hljs-operator">=</span> bias</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="208"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        kernel, bias <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.cls<span class="hljs-number">2</span>[<span class="hljs-number">0</span>].weight.<span class="hljs-keyword">data</span>, <span class="hljs-keyword">self</span>.cls<span class="hljs-number">2</span>[<span class="hljs-number">0</span>].bias.<span class="hljs-keyword">data</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="209"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.cls<span class="hljs-number">1</span>[<span class="hljs-number">2</span>].weight.<span class="hljs-keyword">data</span> <span class="hljs-operator">=</span> torch.matmul(kernel.transpose(<span class="hljs-number">1,3</span>), <span class="hljs-keyword">self</span>.cls<span class="hljs-number">1</span>[<span class="hljs-number">2</span>].weight.<span class="hljs-keyword">data</span>.squeeze(<span class="hljs-number">3</span>).squeeze(<span class="hljs-number">2</span>)).transpose(<span class="hljs-number">1,3</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="210"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.cls<span class="hljs-number">1</span>[<span class="hljs-number">2</span>].bias.<span class="hljs-keyword">data</span> <span class="hljs-operator">=</span> bias <span class="hljs-operator">+</span> (<span class="hljs-keyword">self</span>.cls<span class="hljs-number">1</span>[<span class="hljs-number">2</span>].bias.<span class="hljs-keyword">data</span>.view(<span class="hljs-number">1</span>,-<span class="hljs-number">1,1,1</span>)<span class="hljs-operator">*</span>kernel).<span class="hljs-keyword">sum</span>(<span class="hljs-number">3</span>).<span class="hljs-keyword">sum</span>(<span class="hljs-number">2</span>).<span class="hljs-keyword">sum</span>(<span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="211"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.cls <span class="hljs-operator">=</span> torch.nn.<span class="hljs-keyword">Sequential</span>(<span class="hljs-operator">*</span><span class="hljs-keyword">self</span>.cls<span class="hljs-number">1</span>[<span class="hljs-number">0</span>:<span class="hljs-number">3</span>])</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="212"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.__delattr__(<span class="hljs-string">'cls1'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="213"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.__delattr__(<span class="hljs-string">'cls2'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="214"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.deploy <span class="hljs-operator">=</span> <span class="hljs-keyword">True</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="215"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="216"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">def update_weight(model_dict, weight_dict):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="217"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    idx, temp_dict <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, {}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="218"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> weight_dict.items():</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="219"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">if</span> k <span class="hljs-keyword">in</span> model_dict.keys() <span class="hljs-keyword">and</span> np.shape(model_dict[k]) <span class="hljs-operator">=</span><span class="hljs-operator">=</span> np.shape(v):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="220"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            temp_dict[k] <span class="hljs-operator">=</span> v</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="221"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            idx <span class="hljs-operator">+</span><span class="hljs-operator">=</span> <span class="hljs-number">1</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="222"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    model_dict.update(temp_dict)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="223"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    print(f<span class="hljs-string">'loading weights... {idx}/{len(model_dict)} items'</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="224"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> model_dict</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="225"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="226"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">def vanillanet_<span class="hljs-number">5</span>(pretrained<span class="hljs-operator">=</span><span class="hljs-string">''</span>,<span class="hljs-keyword">in</span>_<span class="hljs-number">22</span>k<span class="hljs-operator">=</span><span class="hljs-keyword">False</span>, <span class="hljs-operator">**</span>kwargs):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="227"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    model <span class="hljs-operator">=</span> VanillaNet(dims<span class="hljs-operator">=</span>[<span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">256</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>], strides<span class="hljs-operator">=</span>[<span class="hljs-number">2,2,2</span>], <span class="hljs-operator">**</span>kwargs)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="228"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> pretrained:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="229"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        weights <span class="hljs-operator">=</span> torch.load(pretrained)[<span class="hljs-string">'model_ema'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="230"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        model.load_state_dict(update_weight(model.state_dict(), weights))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="231"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> model</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="232"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="233"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">def vanillanet_<span class="hljs-number">6</span>(pretrained<span class="hljs-operator">=</span><span class="hljs-string">''</span>,<span class="hljs-keyword">in</span>_<span class="hljs-number">22</span>k<span class="hljs-operator">=</span><span class="hljs-keyword">False</span>, <span class="hljs-operator">**</span>kwargs):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="234"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    model <span class="hljs-operator">=</span> VanillaNet(dims<span class="hljs-operator">=</span>[<span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">256</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>], strides<span class="hljs-operator">=</span>[<span class="hljs-number">2,2,2,1</span>], <span class="hljs-operator">**</span>kwargs)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="235"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> pretrained:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="236"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        weights <span class="hljs-operator">=</span> torch.load(pretrained)[<span class="hljs-string">'model_ema'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="237"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        model.load_state_dict(update_weight(model.state_dict(), weights))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="238"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> model</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="239"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="240"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">def vanillanet_<span class="hljs-number">7</span>(pretrained<span class="hljs-operator">=</span><span class="hljs-string">''</span>,<span class="hljs-keyword">in</span>_<span class="hljs-number">22</span>k<span class="hljs-operator">=</span><span class="hljs-keyword">False</span>, <span class="hljs-operator">**</span>kwargs):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="241"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    model <span class="hljs-operator">=</span> VanillaNet(dims<span class="hljs-operator">=</span>[<span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">256</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>], strides<span class="hljs-operator">=</span>[<span class="hljs-number">1,2,2,2,1</span>], <span class="hljs-operator">**</span>kwargs)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="242"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> pretrained:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="243"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        weights <span class="hljs-operator">=</span> torch.load(pretrained)[<span class="hljs-string">'model_ema'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="244"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        model.load_state_dict(update_weight(model.state_dict(), weights))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="245"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> model</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="246"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="247"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">def vanillanet_<span class="hljs-number">8</span>(pretrained<span class="hljs-operator">=</span><span class="hljs-string">''</span>, <span class="hljs-keyword">in</span>_<span class="hljs-number">22</span>k<span class="hljs-operator">=</span><span class="hljs-keyword">False</span>, <span class="hljs-operator">**</span>kwargs):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="248"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    model <span class="hljs-operator">=</span> VanillaNet(dims<span class="hljs-operator">=</span>[<span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">256</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>], strides<span class="hljs-operator">=</span>[<span class="hljs-number">1,2,2,1,2,1</span>], <span class="hljs-operator">**</span>kwargs)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="249"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> pretrained:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="250"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        weights <span class="hljs-operator">=</span> torch.load(pretrained)[<span class="hljs-string">'model_ema'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="251"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        model.load_state_dict(update_weight(model.state_dict(), weights))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="252"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> model</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="253"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="254"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">def vanillanet_<span class="hljs-number">9</span>(pretrained<span class="hljs-operator">=</span><span class="hljs-string">''</span>, <span class="hljs-keyword">in</span>_<span class="hljs-number">22</span>k<span class="hljs-operator">=</span><span class="hljs-keyword">False</span>, <span class="hljs-operator">**</span>kwargs):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="255"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    model <span class="hljs-operator">=</span> VanillaNet(dims<span class="hljs-operator">=</span>[<span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">256</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>], strides<span class="hljs-operator">=</span>[<span class="hljs-number">1,2,2,1,1,2,1</span>], <span class="hljs-operator">**</span>kwargs)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="256"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> pretrained:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="257"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        weights <span class="hljs-operator">=</span> torch.load(pretrained)[<span class="hljs-string">'model_ema'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="258"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        model.load_state_dict(update_weight(model.state_dict(), weights))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="259"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> model</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="260"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="261"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">def vanillanet_<span class="hljs-number">10</span>(pretrained<span class="hljs-operator">=</span><span class="hljs-string">''</span>, <span class="hljs-keyword">in</span>_<span class="hljs-number">22</span>k<span class="hljs-operator">=</span><span class="hljs-keyword">False</span>, <span class="hljs-operator">**</span>kwargs):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="262"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    model <span class="hljs-operator">=</span> VanillaNet(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="263"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        dims<span class="hljs-operator">=</span>[<span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">256</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>],</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="264"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        strides<span class="hljs-operator">=</span>[<span class="hljs-number">1,2,2,1,1,1,2,1</span>],</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="265"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-operator">**</span>kwargs)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="266"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> pretrained:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="267"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        weights <span class="hljs-operator">=</span> torch.load(pretrained)[<span class="hljs-string">'model_ema'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="268"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        model.load_state_dict(update_weight(model.state_dict(), weights))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="269"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> model</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="270"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="271"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">def vanillanet_<span class="hljs-number">11</span>(pretrained<span class="hljs-operator">=</span><span class="hljs-string">''</span>, <span class="hljs-keyword">in</span>_<span class="hljs-number">22</span>k<span class="hljs-operator">=</span><span class="hljs-keyword">False</span>, <span class="hljs-operator">**</span>kwargs):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="272"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    model <span class="hljs-operator">=</span> VanillaNet(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="273"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        dims<span class="hljs-operator">=</span>[<span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">256</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>],</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="274"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        strides<span class="hljs-operator">=</span>[<span class="hljs-number">1,2,2,1,1,1,1,2,1</span>],</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="275"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-operator">**</span>kwargs)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="276"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> pretrained:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="277"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        weights <span class="hljs-operator">=</span> torch.load(pretrained)[<span class="hljs-string">'model_ema'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="278"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        model.load_state_dict(update_weight(model.state_dict(), weights))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="279"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> model</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="280"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="281"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">def vanillanet_<span class="hljs-number">12</span>(pretrained<span class="hljs-operator">=</span><span class="hljs-string">''</span>, <span class="hljs-keyword">in</span>_<span class="hljs-number">22</span>k<span class="hljs-operator">=</span><span class="hljs-keyword">False</span>, <span class="hljs-operator">**</span>kwargs):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="282"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    model <span class="hljs-operator">=</span> VanillaNet(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="283"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        dims<span class="hljs-operator">=</span>[<span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">256</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>],</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="284"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        strides<span class="hljs-operator">=</span>[<span class="hljs-number">1,2,2,1,1,1,1,1,2,1</span>],</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="285"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-operator">**</span>kwargs)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="286"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> pretrained:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="287"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        weights <span class="hljs-operator">=</span> torch.load(pretrained)[<span class="hljs-string">'model_ema'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="288"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        model.load_state_dict(update_weight(model.state_dict(), weights))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="289"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> model</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="290"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="291"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">def vanillanet_<span class="hljs-number">13</span>(pretrained<span class="hljs-operator">=</span><span class="hljs-string">''</span>, <span class="hljs-keyword">in</span>_<span class="hljs-number">22</span>k<span class="hljs-operator">=</span><span class="hljs-keyword">False</span>, <span class="hljs-operator">**</span>kwargs):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="292"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    model <span class="hljs-operator">=</span> VanillaNet(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="293"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        dims<span class="hljs-operator">=</span>[<span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">256</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">4</span>],</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="294"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        strides<span class="hljs-operator">=</span>[<span class="hljs-number">1,2,2,1,1,1,1,1,1,2,1</span>],</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="295"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-operator">**</span>kwargs)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="296"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> pretrained:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="297"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        weights <span class="hljs-operator">=</span> torch.load(pretrained)[<span class="hljs-string">'model_ema'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="298"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        model.load_state_dict(update_weight(model.state_dict(), weights))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="299"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> model</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="300"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="301"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">def vanillanet_<span class="hljs-number">13</span>_x<span class="hljs-number">1</span>_<span class="hljs-number">5</span>(pretrained<span class="hljs-operator">=</span><span class="hljs-string">''</span>, <span class="hljs-keyword">in</span>_<span class="hljs-number">22</span>k<span class="hljs-operator">=</span><span class="hljs-keyword">False</span>, <span class="hljs-operator">**</span>kwargs):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="302"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    model <span class="hljs-operator">=</span> VanillaNet(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="303"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        dims<span class="hljs-operator">=</span>[<span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">256</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>],</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="304"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        strides<span class="hljs-operator">=</span>[<span class="hljs-number">1,2,2,1,1,1,1,1,1,2,1</span>],</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="305"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-operator">**</span>kwargs)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="306"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> pretrained:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="307"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        weights <span class="hljs-operator">=</span> torch.load(pretrained)[<span class="hljs-string">'model_ema'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="308"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        model.load_state_dict(update_weight(model.state_dict(), weights))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="309"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> model</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="310"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="311"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">def vanillanet_<span class="hljs-number">13</span>_x<span class="hljs-number">1</span>_<span class="hljs-number">5</span>_ada_pool(pretrained<span class="hljs-operator">=</span><span class="hljs-string">''</span>, <span class="hljs-keyword">in</span>_<span class="hljs-number">22</span>k<span class="hljs-operator">=</span><span class="hljs-keyword">False</span>, <span class="hljs-operator">**</span>kwargs):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="312"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    model <span class="hljs-operator">=</span> VanillaNet(</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="313"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        dims<span class="hljs-operator">=</span>[<span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">128</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">256</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">512</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>, <span class="hljs-number">1024</span><span class="hljs-operator">*</span><span class="hljs-number">6</span>],</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="314"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        strides<span class="hljs-operator">=</span>[<span class="hljs-number">1,2,2,1,1,1,1,1,1,2,1</span>],</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="315"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        ada_pool<span class="hljs-operator">=</span>[<span class="hljs-number">0,40,20,0,0,0,0,0,0,10,0</span>],</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="316"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-operator">**</span>kwargs)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="317"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">if</span> pretrained:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="318"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        weights <span class="hljs-operator">=</span> torch.load(pretrained)[<span class="hljs-string">'model_ema'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="319"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        model.load_state_dict(update_weight(model.state_dict(), weights))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="320"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">return</span> model</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="321"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="322"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">if</span> __name__ <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-string">'__main__'</span>:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="323"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    inputs <span class="hljs-operator">=</span> torch.randn((<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">640</span>, <span class="hljs-number">640</span>))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="324"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    model <span class="hljs-operator">=</span> vanillanet_<span class="hljs-number">5</span>()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="325"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    weights <span class="hljs-operator">=</span> torch.load(<span class="hljs-string">'vanillanet_5.pth'</span>)[<span class="hljs-string">'model_ema'</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="326"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    model.load_state_dict(update_weight(model.state_dict(), weights))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="327"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    pred <span class="hljs-operator">=</span> model(inputs)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="328"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> pred:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="329"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        print(i.<span class="hljs-keyword">size</span>())</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
</div> 
<h3 id="2.2%C2%A0%C2%A0tasks.py%E6%B3%A8%E5%86%8C"><a name="t6"></a>2.2&nbsp;&nbsp;tasks.py注册</h3> 
<div> 
 <pre data-index="1"><code class="hljs language-typescript"><span class="hljs-keyword">from</span> models.<span class="hljs-property">backbone</span>.<span class="hljs-property">VanillaNet</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">VanillaBlock</span></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
</div> 
<p>&nbsp;def parse_model(d, ch, verbose=True): &nbsp;# model_dict, input_channels(3)</p> 
<pre data-index="2"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:1086px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">if</span> m <span class="hljs-keyword">in</span> (Classify, Conv, ConvTranspose, GhostConv, Bottleneck, GhostBottleneck, SPP, SPPF, DWConv, Focus,</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                 BottleneckCSP, C<span class="hljs-number">1</span>, C<span class="hljs-number">2</span>, C<span class="hljs-number">2</span>f, C<span class="hljs-number">3</span>, C<span class="hljs-number">3</span>TR, C<span class="hljs-number">3</span>Ghost, nn.ConvTranspose<span class="hljs-number">2</span>d, DWConvTranspose<span class="hljs-number">2</span>d, C<span class="hljs-number">3</span>x, VanillaBlock</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                ):</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h3 id="2.3%C2%A0yolov8_VanillaBlock.yaml"><a name="t7"></a>2.3&nbsp;yolov8_VanillaBlock.yaml</h3> 
<pre data-index="3" class="set-code-hide" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:1052px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># Ultralytics YOLO 🚀, GPL-<span class="hljs-number">3.0</span> license</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># YOLOv<span class="hljs-number">8</span> <span class="hljs-keyword">object</span> detection model <span class="hljs-keyword">with</span> P<span class="hljs-number">3</span>-P<span class="hljs-number">5</span> outputs. <span class="hljs-keyword">For</span> <span class="hljs-keyword">Usage</span> examples see https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>docs.ultralytics.com<span class="hljs-operator">/</span>tasks<span class="hljs-operator">/</span>detect</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># Parameters</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">nc: <span class="hljs-number">1</span>  # <span class="hljs-keyword">number</span> <span class="hljs-keyword">of</span> classes</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">scales: # model compound scaling constants, i.e. <span class="hljs-string">'model=yolov8n.yaml'</span> will <span class="hljs-keyword">call</span> yolov<span class="hljs-number">8</span>.yaml <span class="hljs-keyword">with</span> scale <span class="hljs-string">'n'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  # [depth, width, max_channels]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  n: [<span class="hljs-number">0.33</span>, <span class="hljs-number">0.25</span>, <span class="hljs-number">1024</span>]  # YOLOv<span class="hljs-number">8</span>n summary: <span class="hljs-number">225</span> layers,  <span class="hljs-number">3157200</span> parameters,  <span class="hljs-number">3157184</span> gradients,   <span class="hljs-number">8.9</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  s: [<span class="hljs-number">0.33</span>, <span class="hljs-number">0.50</span>, <span class="hljs-number">1024</span>]  # YOLOv<span class="hljs-number">8</span>s summary: <span class="hljs-number">225</span> layers, <span class="hljs-number">11166560</span> parameters, <span class="hljs-number">11166544</span> gradients,  <span class="hljs-number">28.8</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  m: [<span class="hljs-number">0.67</span>, <span class="hljs-number">0.75</span>, <span class="hljs-number">768</span>]   # YOLOv<span class="hljs-number">8</span>m summary: <span class="hljs-number">295</span> layers, <span class="hljs-number">25902640</span> parameters, <span class="hljs-number">25902624</span> gradients,  <span class="hljs-number">79.3</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  l: [<span class="hljs-number">1.00</span>, <span class="hljs-number">1.00</span>, <span class="hljs-number">512</span>]   # YOLOv<span class="hljs-number">8</span>l summary: <span class="hljs-number">365</span> layers, <span class="hljs-number">43691520</span> parameters, <span class="hljs-number">43691504</span> gradients, <span class="hljs-number">165.7</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  x: [<span class="hljs-number">1.00</span>, <span class="hljs-number">1.25</span>, <span class="hljs-number">512</span>]   # YOLOv<span class="hljs-number">8</span>x summary: <span class="hljs-number">365</span> layers, <span class="hljs-number">68229648</span> parameters, <span class="hljs-number">68229632</span> gradients, <span class="hljs-number">258.5</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># YOLOv<span class="hljs-number">8.0</span>n backbone</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">backbone:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  # [<span class="hljs-keyword">from</span>, repeats, module, args]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">64</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">0</span>-P<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">2</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">128</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">1</span>-P<span class="hljs-number">2</span><span class="hljs-operator">/</span><span class="hljs-number">4</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">128</span>, <span class="hljs-keyword">True</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">256</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">3</span>-P<span class="hljs-number">3</span><span class="hljs-operator">/</span><span class="hljs-number">8</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">256</span>, <span class="hljs-keyword">True</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">512</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">5</span>-P<span class="hljs-number">4</span><span class="hljs-operator">/</span><span class="hljs-number">16</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">512</span>, <span class="hljs-keyword">True</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">1024</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">7</span>-P<span class="hljs-number">5</span><span class="hljs-operator">/</span><span class="hljs-number">32</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">1024</span>, <span class="hljs-keyword">True</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, SPPF, [<span class="hljs-number">1024</span>, <span class="hljs-number">5</span>]]  # <span class="hljs-number">9</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># YOLOv<span class="hljs-number">8.0</span>n head</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">head:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, nn.Upsample, [None, <span class="hljs-number">2</span>, <span class="hljs-string">'nearest'</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[-<span class="hljs-number">1</span>, <span class="hljs-number">6</span>], <span class="hljs-number">1</span>, Concat, [<span class="hljs-number">1</span>]]  # cat backbone P<span class="hljs-number">4</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">512</span>]]  # <span class="hljs-number">12</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, nn.Upsample, [None, <span class="hljs-number">2</span>, <span class="hljs-string">'nearest'</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[-<span class="hljs-number">1</span>, <span class="hljs-number">4</span>], <span class="hljs-number">1</span>, Concat, [<span class="hljs-number">1</span>]]  # cat backbone P<span class="hljs-number">3</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">256</span>]]  # <span class="hljs-number">15</span> (P<span class="hljs-number">3</span><span class="hljs-operator">/</span><span class="hljs-number">8</span>-small)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">256</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[-<span class="hljs-number">1</span>, <span class="hljs-number">12</span>], <span class="hljs-number">1</span>, Concat, [<span class="hljs-number">1</span>]]  # cat head P<span class="hljs-number">4</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">512</span>]]  # <span class="hljs-number">18</span> (P<span class="hljs-number">4</span><span class="hljs-operator">/</span><span class="hljs-number">16</span>-medium)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">512</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[-<span class="hljs-number">1</span>, <span class="hljs-number">9</span>], <span class="hljs-number">1</span>, Concat, [<span class="hljs-number">1</span>]]  # cat head P<span class="hljs-number">5</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">1024</span>]]  # <span class="hljs-number">21</span> (P<span class="hljs-number">5</span><span class="hljs-operator">/</span><span class="hljs-number">32</span>-large)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[<span class="hljs-number">15</span>, <span class="hljs-number">1</span> , VanillaBlock, [<span class="hljs-number">256</span>]]  # <span class="hljs-number">22</span>(P<span class="hljs-number">5</span><span class="hljs-operator">/</span><span class="hljs-number">32</span>-large)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[<span class="hljs-number">18</span>, <span class="hljs-number">1</span> , VanillaBlock, [<span class="hljs-number">512</span>]]  # <span class="hljs-number">23</span> (P<span class="hljs-number">5</span><span class="hljs-operator">/</span><span class="hljs-number">32</span>-large)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[<span class="hljs-number">21</span>, <span class="hljs-number">1</span> , VanillaBlock, [<span class="hljs-number">1024</span>]]  # <span class="hljs-number">24</span> (P<span class="hljs-number">5</span><span class="hljs-operator">/</span><span class="hljs-number">32</span>-large)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="50"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="51"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[<span class="hljs-number">22</span>, <span class="hljs-number">23</span>, <span class="hljs-number">24</span>], <span class="hljs-number">1</span>, Detect, [nc]]  # Detect(P<span class="hljs-number">3</span>, P<span class="hljs-number">4</span>, P<span class="hljs-number">5</span>)</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<p>​</p> 
<p></p>
                </div><div data-report-view="{&quot;mod&quot;:&quot;1585297308_001&quot;,&quot;spm&quot;:&quot;1001.2101.3001.6548&quot;,&quot;dest&quot;:&quot;https://cv2023.blog.csdn.net/article/details/130901017&quot;,&quot;extend1&quot;:&quot;pc&quot;,&quot;ab&quot;:&quot;new&quot;}"><div></div></div>
        </div>