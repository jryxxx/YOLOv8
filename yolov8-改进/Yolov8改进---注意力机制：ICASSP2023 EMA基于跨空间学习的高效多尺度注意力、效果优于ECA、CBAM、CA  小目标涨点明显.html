<div id="article_content" class="article_content clearfix">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/kdoc_html_views-1a98987dfd.css">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-dc4a025e85.css">
                <div id="content_views" class="htmledit_views">
                    <h2><a name="t0"></a>1.EMAä»‹ç»&nbsp;</h2> 
<p><img alt="" height="189" src="https://img-blog.csdnimg.cn/80a58086ec414878871b6c3fbecb7ebb.png" width="646"></p> 
<p>è®ºæ–‡ï¼š<a href="https://arxiv.org/abs/2305.13563v1" title="https://arxiv.org/abs/2305.13563v1">https://arxiv.org/abs/2305.13563v1</a>&nbsp;</p> 
<p>å½•ç”¨ï¼šICASSP2023</p> 
<p><img alt="" src="https://img-blog.csdnimg.cn/ee7adbaa0d8940b8a30d244c40571904.png">&nbsp;&nbsp;</p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é€šè¿‡é€šé“é™ç»´æ¥å»ºæ¨¡è·¨é€šé“å…³ç³»å¯èƒ½ä¼šç»™æå–æ·±åº¦è§†è§‰è¡¨ç¤ºå¸¦æ¥å‰¯ä½œç”¨ã€‚æœ¬æ–‡æå‡ºäº†ä¸€ç§æ–°çš„é«˜æ•ˆçš„<a href="https://so.csdn.net/so/search?q=%E5%A4%9A%E5%B0%BA%E5%BA%A6&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=%E5%A4%9A%E5%B0%BA%E5%BA%A6&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;å¤šå°ºåº¦\&quot;}&quot;}" data-tit="å¤šå°ºåº¦" data-pretit="å¤šå°ºåº¦">å¤šå°ºåº¦</a>æ³¨æ„åŠ›(EMA)æ¨¡å—ã€‚ä»¥ä¿ç•™æ¯ä¸ªé€šé“ä¸Šçš„ä¿¡æ¯å’Œé™ä½è®¡ç®—å¼€é”€ä¸ºç›®æ ‡ï¼Œå°†éƒ¨åˆ†é€šé“é‡å¡‘ä¸ºæ‰¹é‡ç»´åº¦ï¼Œå¹¶å°†é€šé“ç»´åº¦åˆ†ç»„ä¸ºå¤šä¸ªå­ç‰¹å¾ï¼Œä½¿ç©ºé—´è¯­ä¹‰ç‰¹å¾åœ¨æ¯ä¸ªç‰¹å¾ç»„ä¸­å‡åŒ€åˆ†å¸ƒã€‚&nbsp;</p> 
<p></p> 
<p>&nbsp;<img alt="" height="420" src="https://img-blog.csdnimg.cn/314cc4f560134d079a38cfac301c92da.png" width="514"></p> 
<p></p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æå‡ºäº†ä¸€ç§æ–°çš„æ— éœ€é™ç»´çš„é«˜æ•ˆå¤šå°ºåº¦<a href="https://so.csdn.net/so/search?q=%E6%B3%A8%E6%84%8F%E5%8A%9B&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=%E6%B3%A8%E6%84%8F%E5%8A%9B&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;æ³¨æ„åŠ›\&quot;}&quot;}" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=%E6%B3%A8%E6%84%8F%E5%8A%9B&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;æ³¨æ„åŠ›\&quot;}&quot;}" data-tit="æ³¨æ„åŠ›" data-pretit="æ³¨æ„åŠ›">æ³¨æ„åŠ›</a>(efficient multi-scale attention, EMA)ã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œåªæœ‰ä¸¤ä¸ªå·ç§¯æ ¸å°†åˆ†åˆ«æ”¾ç½®åœ¨å¹¶è¡Œå­ç½‘ç»œä¸­ã€‚å…¶ä¸­ä¸€ä¸ªå¹¶è¡Œå­ç½‘ç»œæ˜¯ä¸€ä¸ª1x1å·ç§¯æ ¸ï¼Œä»¥ä¸CAç›¸åŒçš„æ–¹å¼å¤„ç†ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸€ä¸ª3x3å·ç§¯æ ¸ã€‚ä¸ºäº†è¯æ˜æ‰€æå‡ºçš„EMAçš„é€šç”¨æ€§ï¼Œè¯¦ç»†çš„å®éªŒåœ¨ç¬¬4èŠ‚ä¸­ç»™å‡ºï¼ŒåŒ…æ‹¬åœ¨CIFAR-100ã€ImageNet-1kã€COCOå’ŒVisDrone2019åŸºå‡†ä¸Šçš„ç»“æœã€‚å›¾1ç»™å‡ºäº†å›¾åƒåˆ†ç±»å’Œç›®æ ‡æ£€æµ‹ä»»åŠ¡çš„å®éªŒç»“æœã€‚æˆ‘ä»¬çš„ä¸»è¦è´¡çŒ®å¦‚ä¸‹:</p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æœ¬æ–‡æå‡ºäº†ä¸€ç§æ–°çš„è·¨ç©ºé—´å­¦ä¹ æ–¹æ³•ï¼Œå¹¶è®¾è®¡äº†ä¸€ä¸ªå¤šå°ºåº¦å¹¶è¡Œå­ç½‘ç»œæ¥å»ºç«‹çŸ­å’Œé•¿ä¾èµ–å…³ç³»ã€‚<br> 1)æˆ‘ä»¬è€ƒè™‘ä¸€ç§é€šç”¨æ–¹æ³•ï¼Œå°†éƒ¨åˆ†é€šé“ç»´åº¦é‡å¡‘ä¸ºæ‰¹é‡ç»´åº¦ï¼Œä»¥é¿å…é€šè¿‡é€šç”¨å·ç§¯è¿›è¡ŒæŸç§å½¢å¼çš„é™ç»´ã€‚<br> 2)é™¤äº†åœ¨ä¸è¿›è¡Œé€šé“é™ç»´çš„æƒ…å†µä¸‹åœ¨æ¯ä¸ªå¹¶è¡Œå­ç½‘ç»œä¸­æ„å»ºå±€éƒ¨çš„è·¨é€šé“äº¤äº’å¤–ï¼Œæˆ‘ä»¬è¿˜é€šè¿‡è·¨ç©ºé—´å­¦ä¹ æ–¹æ³•èåˆä¸¤ä¸ªå¹¶è¡Œå­ç½‘ç»œçš„è¾“å‡ºç‰¹å¾å›¾ã€‚<br> 3)ä¸CBAMã€NAM[16]ã€SAã€ECAå’ŒCAç›¸æ¯”ï¼ŒEMAä¸ä»…å–å¾—äº†æ›´å¥½çš„ç»“æœï¼Œè€Œä¸”åœ¨æ‰€éœ€å‚æ•°æ–¹é¢æ•ˆç‡æ›´é«˜ã€‚</p> 
<p><img alt="" height="414" src="https://img-blog.csdnimg.cn/ae66f44eb1c64bd8b4fed7e464d3bc7a.png" width="1063"></p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CAå—é¦–å…ˆå¯ä»¥è¢«è§†ä¸ºä¸SEæ³¨æ„åŠ›æ¨¡å—ç±»ä¼¼çš„æ–¹æ³•ï¼Œå…¶ä¸­åˆ©ç”¨å…¨å±€å¹³å‡æ± åŒ–æ“ä½œå¯¹è·¨é€šé“ä¿¡æ¯è¿›è¡Œå»ºæ¨¡ã€‚é€šå¸¸ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨å…¨å±€å¹³å‡æ± åŒ–æ¥ç”Ÿæˆä¿¡é“ç»Ÿè®¡ä¿¡æ¯ï¼Œå…¶ä¸­å…¨å±€ç©ºé—´ä½ç½®ä¿¡æ¯è¢«å‹ç¼©åˆ°ä¿¡é“æè¿°ç¬¦ä¸­ã€‚ä¸SEå¾®å¦™ä¸åŒçš„æ˜¯ï¼ŒCAå°†ç©ºé—´ä½ç½®ä¿¡æ¯åµŒå…¥é€šé“æ³¨æ„å›¾ä»¥å¢å¼ºç‰¹å¾èšåˆã€‚&nbsp;</p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¹¶è¡Œå­ç»“æ„å¸®åŠ©ç½‘ç»œé¿å…æ›´å¤šçš„é¡ºåºå¤„ç†å’Œå¤§æ·±åº¦ã€‚ç»™å®šä¸Šè¿°å¹¶è¡Œå¤„ç†ç­–ç•¥ï¼Œæˆ‘ä»¬åœ¨EMAæ¨¡å—ä¸­é‡‡ç”¨å®ƒã€‚EMAçš„æ•´ä½“ç»“æ„å¦‚å›¾3 (b)æ‰€ç¤ºã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºEMAå¦‚ä½•åœ¨å·ç§¯æ“ä½œä¸­ä¸è¿›è¡Œé€šé“é™ç»´çš„æƒ…å†µä¸‹å­¦ä¹ æœ‰æ•ˆçš„é€šé“æè¿°ï¼Œå¹¶ä¸ºé«˜çº§ç‰¹å¾å›¾äº§ç”Ÿæ›´å¥½çš„åƒç´ çº§æ³¨æ„åŠ›ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬åªä»CAæ¨¡å—ä¸­æŒ‘é€‰å‡º1x1å·ç§¯çš„å…±äº«ç»„ä»¶ï¼Œåœ¨æˆ‘ä»¬çš„EMAä¸­å°†å…¶å‘½åä¸º1x1åˆ†æ”¯ã€‚ä¸ºäº†èšåˆå¤šå°ºåº¦ç©ºé—´ç»“æ„ä¿¡æ¯ï¼Œå°†3x3å†…æ ¸ä¸1x1åˆ†æ”¯å¹¶è¡Œæ”¾ç½®ä»¥å®ç°å¿«é€Ÿå“åº”ï¼Œæˆ‘ä»¬å°†å…¶å‘½åä¸º3x3åˆ†æ”¯ã€‚è€ƒè™‘åˆ°ç‰¹å¾åˆ†ç»„å’Œå¤šå°ºåº¦ç»“æ„ï¼Œæœ‰æ•ˆåœ°å»ºç«‹çŸ­æœŸå’Œé•¿ç¨‹ä¾èµ–æœ‰åˆ©äºè·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚</p> 
<p>&nbsp;<img alt="" height="475" src="https://img-blog.csdnimg.cn/86bd881c4cca43dfb46322bad3aea2c9.png" width="899"></p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨CIFAR-100æ•°æ®é›†ä¸Šç ”ç©¶äº†æ‰€æå‡ºçš„EMAï¼Œä½¿ç”¨æ ‡å‡†çš„CIFAR Top-1å’ŒTop-5ç²¾åº¦æŒ‡æ ‡æ¥è¯„ä¼°ç½‘ç»œçš„æ€§èƒ½ã€‚<br><img alt="" height="404" src="https://img-blog.csdnimg.cn/b5bb7b646d6a4a35999e5bc0d1797b93.png" width="1028"></p> 
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç”¨YOLOv5xä½œä¸ºéª¨å¹²CNNåœ¨VisDroneæ•°æ®é›†ä¸Šè¿›è¡Œç›®æ ‡æ£€æµ‹ï¼Œå…¶ä¸­CA, CBAMå’ŒEMAæ³¨æ„åŠ›åˆ†åˆ«é›†æˆåˆ°æ£€æµ‹å™¨ä¸­ã€‚ä»è¡¨2çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼ŒCA, CBAMå’ŒEMAéƒ½å¯ä»¥æé«˜ç›®æ ‡æ£€æµ‹çš„åŸºçº¿æ€§èƒ½ã€‚å¯ä»¥çœ‹åˆ°ï¼Œæ‰€æå‡ºçš„EMAæ¨¡å—åœ¨mAP(0.5)å’ŒmAP(0.5:0.95)æ–¹é¢å§‹ç»ˆä¼˜äºåŸºæœ¬çš„CAå’ŒCBAMç½‘ç»œã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒCBAMå°†YOLOv5xçš„æ€§èƒ½æå‡äº†0.11%ï¼Œé«˜äºCAï¼Œä½†ä»£ä»·æ˜¯å‚æ•°å’Œè®¡ç®—é‡æ›´å¤šã€‚å¯¹äºCAï¼Œå®ƒè·å¾—äº†ä¸åŸºçº¿å‡ ä¹ç›¸åŒçš„æ€§èƒ½ï¼Œå¹¶åœ¨mAP(0.5)æ–¹é¢è¶…è¿‡YOLOv5x 0.01%ï¼ŒåŒæ—¶CAè·å¾—äº†æ¯”EMAæ›´é«˜çš„å‚æ•°å’Œè®¡ç®—é‡(91.28M vs . 91.18Må’Œ315.2M vs . 315.0M)ã€‚å…·ä½“è€Œè¨€ï¼ŒEMAæ¯”åŸºçº¿æ–¹æ³•å¢åŠ äº†0.22Mçš„å‚æ•°ï¼Œåœ¨å‚æ•°ç•¥é«˜çš„æƒ…å†µä¸‹ï¼Œæ¯”YOLOv5xåœ¨mAP(0.5)ä¸Šæå‡äº†0.31%ï¼Œåœ¨mAP(0.5:0.95)ä¸Šæå‡äº†0.4%ã€‚è¿™äº›ç»“æœè¡¨æ˜ï¼ŒEMAæ˜¯ä¸€ç§æœ‰æ•ˆçš„ç›®æ ‡æ£€æµ‹æ¨¡å—ï¼Œè¿›ä¸€æ­¥è¯æ˜äº†EMAæ–¹æ³•çš„æœ‰æ•ˆæ€§ã€‚<br><img alt="" height="441" src="https://img-blog.csdnimg.cn/2186910ef015425ab53bf8573e78ae83.png" width="1075"></p> 
<p class="img-center"><img alt="" height="507" src="https://img-blog.csdnimg.cn/ecde41162f924dd0bcaf37fb03dc5395.png" width="503"></p> 
<h2><a name="t1"></a>&nbsp;2.EMAåŠ å…¥yolov8</h2> 
<h3><a name="t2"></a>2.1åŠ å…¥&nbsp;<strong><code>modules.py</code></strong>ä¸­</h3> 
<pre data-index="0" class="set-code-hide" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:1069px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">###################### EMA_attention  ####     <span class="hljs-keyword">START</span>   <span class="hljs-keyword">by</span>  AI<span class="hljs-operator">&amp;</span>CV  ###############################</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">import torch</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">from</span> torch import nn</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">class</span> EMA_attention(nn.Module):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def __init__(<span class="hljs-keyword">self</span>, channels, c<span class="hljs-number">2</span><span class="hljs-operator">=</span>None, factor<span class="hljs-operator">=</span><span class="hljs-number">32</span>):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">super</span>(EMA_attention, <span class="hljs-keyword">self</span>).__init__()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.groups <span class="hljs-operator">=</span> factor</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        assert channels <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">self</span>.groups <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.softmax <span class="hljs-operator">=</span> nn.Softmax(-<span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.agp <span class="hljs-operator">=</span> nn.AdaptiveAvgPool<span class="hljs-number">2</span>d((<span class="hljs-number">1</span>, <span class="hljs-number">1</span>))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.pool_h <span class="hljs-operator">=</span> nn.AdaptiveAvgPool<span class="hljs-number">2</span>d((None, <span class="hljs-number">1</span>))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.pool_w <span class="hljs-operator">=</span> nn.AdaptiveAvgPool<span class="hljs-number">2</span>d((<span class="hljs-number">1</span>, None))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.gn <span class="hljs-operator">=</span> nn.GroupNorm(channels <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">self</span>.groups, channels <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">self</span>.groups)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.conv<span class="hljs-number">1</span>x<span class="hljs-number">1</span> <span class="hljs-operator">=</span> nn.Conv<span class="hljs-number">2</span>d(channels <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">self</span>.groups, channels <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">self</span>.groups, kernel_<span class="hljs-keyword">size</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>, stride<span class="hljs-operator">=</span><span class="hljs-number">1</span>, padding<span class="hljs-operator">=</span><span class="hljs-number">0</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">self</span>.conv<span class="hljs-number">3</span>x<span class="hljs-number">3</span> <span class="hljs-operator">=</span> nn.Conv<span class="hljs-number">2</span>d(channels <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">self</span>.groups, channels <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">self</span>.groups, kernel_<span class="hljs-keyword">size</span><span class="hljs-operator">=</span><span class="hljs-number">3</span>, stride<span class="hljs-operator">=</span><span class="hljs-number">1</span>, padding<span class="hljs-operator">=</span><span class="hljs-number">1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    def forward(<span class="hljs-keyword">self</span>, x):</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        b, c, h, w <span class="hljs-operator">=</span> x.<span class="hljs-keyword">size</span>()</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">group</span>_x <span class="hljs-operator">=</span> x.reshape(b <span class="hljs-operator">*</span> <span class="hljs-keyword">self</span>.groups, -<span class="hljs-number">1</span>, h, w)  # b<span class="hljs-operator">*</span>g,c<span class="hljs-operator">/</span><span class="hljs-operator">/</span>g,h,w</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x_h <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.pool_h(<span class="hljs-keyword">group</span>_x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x_w <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.pool_w(<span class="hljs-keyword">group</span>_x).permute(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        hw <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.conv<span class="hljs-number">1</span>x<span class="hljs-number">1</span>(torch.cat([x_h, x_w], dim<span class="hljs-operator">=</span><span class="hljs-number">2</span>))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x_h, x_w <span class="hljs-operator">=</span> torch.split(hw, [h, w], dim<span class="hljs-operator">=</span><span class="hljs-number">2</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x<span class="hljs-number">1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.gn(<span class="hljs-keyword">group</span>_x <span class="hljs-operator">*</span> x_h.sigmoid() <span class="hljs-operator">*</span> x_w.permute(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>).sigmoid())</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x<span class="hljs-number">2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.conv<span class="hljs-number">3</span>x<span class="hljs-number">3</span>(<span class="hljs-keyword">group</span>_x)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x<span class="hljs-number">11</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.softmax(<span class="hljs-keyword">self</span>.agp(x<span class="hljs-number">1</span>).reshape(b <span class="hljs-operator">*</span> <span class="hljs-keyword">self</span>.groups, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).permute(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x<span class="hljs-number">12</span> <span class="hljs-operator">=</span> x<span class="hljs-number">2</span>.reshape(b <span class="hljs-operator">*</span> <span class="hljs-keyword">self</span>.groups, c <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">self</span>.groups, -<span class="hljs-number">1</span>)  # b<span class="hljs-operator">*</span>g, c<span class="hljs-operator">/</span><span class="hljs-operator">/</span>g, hw</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x<span class="hljs-number">21</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.softmax(<span class="hljs-keyword">self</span>.agp(x<span class="hljs-number">2</span>).reshape(b <span class="hljs-operator">*</span> <span class="hljs-keyword">self</span>.groups, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).permute(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>))</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        x<span class="hljs-number">22</span> <span class="hljs-operator">=</span> x<span class="hljs-number">1</span>.reshape(b <span class="hljs-operator">*</span> <span class="hljs-keyword">self</span>.groups, c <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">self</span>.groups, -<span class="hljs-number">1</span>)  # b<span class="hljs-operator">*</span>g, c<span class="hljs-operator">/</span><span class="hljs-operator">/</span>g, hw</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        weights <span class="hljs-operator">=</span> (torch.matmul(x<span class="hljs-number">11</span>, x<span class="hljs-number">12</span>) <span class="hljs-operator">+</span> torch.matmul(x<span class="hljs-number">21</span>, x<span class="hljs-number">22</span>)).reshape(b <span class="hljs-operator">*</span> <span class="hljs-keyword">self</span>.groups, <span class="hljs-number">1</span>, h, w)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">group</span>_x <span class="hljs-operator">*</span> weights.sigmoid()).reshape(b, c, h, w)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">###################### EMA_attention  ####     <span class="hljs-keyword">END</span>   <span class="hljs-keyword">by</span>  AI<span class="hljs-operator">&amp;</span>CV  ###############################</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<h3><a name="t3"></a>&nbsp;2.2&nbsp;åŠ å…¥tasks.pyä¸­ï¼š</h3> 
<pre data-index="1"><code class="hljs language-haskell"><ol class="hljs-ln" style="width:1086px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-title">from</span> ultralytics.nn.modules <span class="hljs-keyword">import</span> (<span class="hljs-type">C1</span>, <span class="hljs-type">C2</span>, <span class="hljs-type">C3</span>, <span class="hljs-type">C3TR</span>, <span class="hljs-type">SPP</span>, <span class="hljs-type">SPPF</span>, <span class="hljs-type">Bottleneck</span>, <span class="hljs-type">BottleneckCSP</span>, <span class="hljs-type">C2f</span>, <span class="hljs-type">C3Ghost</span>, <span class="hljs-type">C3x</span>, <span class="hljs-type">Classify</span>,</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                                    <span class="hljs-type">Concat</span>, <span class="hljs-type">Conv</span>, <span class="hljs-type">ConvTranspose</span>, <span class="hljs-type">Detect</span>, <span class="hljs-type">DWConv</span>, <span class="hljs-type">DWConvTranspose2d</span>, <span class="hljs-type">Ensemble</span>, <span class="hljs-type">Focus</span>,</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                                  <span class="hljs-type">EMA_attention</span>)</div></div></li></ol></code><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<p>def parse_model(d, ch, verbose=True):&nbsp; åŠ å…¥ä»¥ä¸‹ä»£ç </p> 
<pre data-index="2"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:1111px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">if</span> m <span class="hljs-keyword">in</span> (Classify, Conv, ConvTranspose, GhostConv, Bottleneck, GhostBottleneck, SPP, SPPF, DWConv, Focus,</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                 BottleneckCSP, C<span class="hljs-number">1</span>, C<span class="hljs-number">2</span>, C<span class="hljs-number">2</span>f, C<span class="hljs-number">3</span>, C<span class="hljs-number">3</span>TR, C<span class="hljs-number">3</span>Ghost, nn.ConvTranspose<span class="hljs-number">2</span>d, DWConvTranspose<span class="hljs-number">2</span>d, C<span class="hljs-number">3</span>x, EMA_attention):</div></div></li></ol></code><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<h3><a name="t4"></a>2.3&nbsp;yolov8_EMA.yaml</h3> 
<pre data-index="3" class="set-code-hide" name="code"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:1052px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># Ultralytics YOLO ğŸš€, GPL-<span class="hljs-number">3.0</span> license</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># YOLOv<span class="hljs-number">8</span> <span class="hljs-keyword">object</span> detection model <span class="hljs-keyword">with</span> P<span class="hljs-number">3</span>-P<span class="hljs-number">5</span> outputs. <span class="hljs-keyword">For</span> <span class="hljs-keyword">Usage</span> examples see https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>docs.ultralytics.com<span class="hljs-operator">/</span>tasks<span class="hljs-operator">/</span>detect</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># Parameters</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">nc: <span class="hljs-number">1</span>  # <span class="hljs-keyword">number</span> <span class="hljs-keyword">of</span> classes</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">scales: # model compound scaling constants, i.e. <span class="hljs-string">'model=yolov8n.yaml'</span> will <span class="hljs-keyword">call</span> yolov<span class="hljs-number">8</span>.yaml <span class="hljs-keyword">with</span> scale <span class="hljs-string">'n'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  # [depth, width, max_channels]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  n: [<span class="hljs-number">0.33</span>, <span class="hljs-number">0.25</span>, <span class="hljs-number">1024</span>]  # YOLOv<span class="hljs-number">8</span>n summary: <span class="hljs-number">225</span> layers,  <span class="hljs-number">3157200</span> parameters,  <span class="hljs-number">3157184</span> gradients,   <span class="hljs-number">8.9</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  s: [<span class="hljs-number">0.33</span>, <span class="hljs-number">0.50</span>, <span class="hljs-number">1024</span>]  # YOLOv<span class="hljs-number">8</span>s summary: <span class="hljs-number">225</span> layers, <span class="hljs-number">11166560</span> parameters, <span class="hljs-number">11166544</span> gradients,  <span class="hljs-number">28.8</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  m: [<span class="hljs-number">0.67</span>, <span class="hljs-number">0.75</span>, <span class="hljs-number">768</span>]   # YOLOv<span class="hljs-number">8</span>m summary: <span class="hljs-number">295</span> layers, <span class="hljs-number">25902640</span> parameters, <span class="hljs-number">25902624</span> gradients,  <span class="hljs-number">79.3</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  l: [<span class="hljs-number">1.00</span>, <span class="hljs-number">1.00</span>, <span class="hljs-number">512</span>]   # YOLOv<span class="hljs-number">8</span>l summary: <span class="hljs-number">365</span> layers, <span class="hljs-number">43691520</span> parameters, <span class="hljs-number">43691504</span> gradients, <span class="hljs-number">165.7</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  x: [<span class="hljs-number">1.00</span>, <span class="hljs-number">1.25</span>, <span class="hljs-number">512</span>]   # YOLOv<span class="hljs-number">8</span>x summary: <span class="hljs-number">365</span> layers, <span class="hljs-number">68229648</span> parameters, <span class="hljs-number">68229632</span> gradients, <span class="hljs-number">258.5</span> GFLOPs</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># YOLOv<span class="hljs-number">8.0</span>n backbone</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">backbone:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  # [<span class="hljs-keyword">from</span>, repeats, module, args]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">64</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">0</span>-P<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">2</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">128</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">1</span>-P<span class="hljs-number">2</span><span class="hljs-operator">/</span><span class="hljs-number">4</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">128</span>, <span class="hljs-keyword">True</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">256</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">3</span>-P<span class="hljs-number">3</span><span class="hljs-operator">/</span><span class="hljs-number">8</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">256</span>, <span class="hljs-keyword">True</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">512</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">5</span>-P<span class="hljs-number">4</span><span class="hljs-operator">/</span><span class="hljs-number">16</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">512</span>, <span class="hljs-keyword">True</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">1024</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]  # <span class="hljs-number">7</span>-P<span class="hljs-number">5</span><span class="hljs-operator">/</span><span class="hljs-number">32</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">1024</span>, <span class="hljs-keyword">True</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, SPPF, [<span class="hljs-number">1024</span>, <span class="hljs-number">5</span>]]  # <span class="hljs-number">9</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># YOLOv<span class="hljs-number">8.0</span>n head</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">head:</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, nn.Upsample, [None, <span class="hljs-number">2</span>, <span class="hljs-string">'nearest'</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[-<span class="hljs-number">1</span>, <span class="hljs-number">6</span>], <span class="hljs-number">1</span>, Concat, [<span class="hljs-number">1</span>]]  # cat backbone P<span class="hljs-number">4</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">512</span>]]  # <span class="hljs-number">12</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, nn.Upsample, [None, <span class="hljs-number">2</span>, <span class="hljs-string">'nearest'</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[-<span class="hljs-number">1</span>, <span class="hljs-number">4</span>], <span class="hljs-number">1</span>, Concat, [<span class="hljs-number">1</span>]]  # cat backbone P<span class="hljs-number">3</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">256</span>]]  # <span class="hljs-number">15</span> (P<span class="hljs-number">3</span><span class="hljs-operator">/</span><span class="hljs-number">8</span>-small)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, EMA_attention, [<span class="hljs-number">256</span>]]  # <span class="hljs-number">16</span> (P<span class="hljs-number">5</span><span class="hljs-operator">/</span><span class="hljs-number">32</span>-large)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">256</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[-<span class="hljs-number">1</span>, <span class="hljs-number">12</span>], <span class="hljs-number">1</span>, Concat, [<span class="hljs-number">1</span>]]  # cat head P<span class="hljs-number">4</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">512</span>]]  # <span class="hljs-number">19</span> (P<span class="hljs-number">4</span><span class="hljs-operator">/</span><span class="hljs-number">16</span>-medium)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, EMA_attention, [<span class="hljs-number">512</span>]]  # <span class="hljs-number">20</span> (P<span class="hljs-number">5</span><span class="hljs-operator">/</span><span class="hljs-number">32</span>-large)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, Conv, [<span class="hljs-number">512</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[-<span class="hljs-number">1</span>, <span class="hljs-number">9</span>], <span class="hljs-number">1</span>, Concat, [<span class="hljs-number">1</span>]]  # cat head P<span class="hljs-number">5</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="46"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, C<span class="hljs-number">2</span>f, [<span class="hljs-number">1024</span>]]  # <span class="hljs-number">23</span> (P<span class="hljs-number">5</span><span class="hljs-operator">/</span><span class="hljs-number">32</span>-large)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="47"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, EMA_attention, [<span class="hljs-number">1024</span>]]  # <span class="hljs-number">24</span> (P<span class="hljs-number">5</span><span class="hljs-operator">/</span><span class="hljs-number">32</span>-large)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="48"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="49"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-operator"> - </span>[[<span class="hljs-number">16</span>, <span class="hljs-number">20</span>, <span class="hljs-number">24</span>], <span class="hljs-number">1</span>, Detect, [nc]]  # Detect(P<span class="hljs-number">3</span>, P<span class="hljs-number">4</span>, P<span class="hljs-number">5</span>)</div></div></li></ol></code><div class="hide-preCode-box"><span class="hide-preCode-bt" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7365&quot;}"><img class="look-more-preCode contentImg-no-view" src="https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png" alt="" title=""></span></div><div class="hljs-button {2}" data-title="å¤åˆ¶" onclick="hljs.copyCode(event)"></div></pre> 
<p></p>
                </div><div data-report-view="{&quot;mod&quot;:&quot;1585297308_001&quot;,&quot;spm&quot;:&quot;1001.2101.3001.6548&quot;,&quot;dest&quot;:&quot;https://cv2023.blog.csdn.net/article/details/131370577&quot;,&quot;extend1&quot;:&quot;pc&quot;,&quot;ab&quot;:&quot;new&quot;}"><div></div></div>
        </div>